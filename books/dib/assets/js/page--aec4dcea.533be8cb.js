(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{483:function(s,t,a){"use strict";a.r(t);var n=a(1),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("本章从整体视角介绍 Babel 生态的全貌，并非详细地介绍其中的每一个细节，如希望了解详细的介绍，可根据需要查看本书其他章节。")]),s._v(" "),a("h2",{attrs:{id:"_1-babel-简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-babel-简介"}},[s._v("#")]),s._v(" 1 Babel 简介")]),s._v(" "),a("h3",{attrs:{id:"_1-1-babel-是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-babel-是什么"}},[s._v("#")]),s._v(" 1.1 Babel 是什么？")]),s._v(" "),a("p",[s._v("Babel 是 JavaScript 转译器，通过 Babel，开发者可以自由使用下一代 ECMAScript 语法。高版本 ECMAScript 语法将被转译为低版本语法，以便顺利运行在各类环境，如低版本浏览器、低版本 Node.js 等。")]),s._v(" "),a("blockquote",[a("p",[s._v("Babel 是转译器，不是编译器。下面是转译和编译的区别:")])]),s._v(" "),a("blockquote",[a("p",[s._v("编译，一般指将一种语言转换为另一种语法和抽象程度等都不同的语言，常见的比如 gcc 编译器。\n转译，一般指将一种语言转换为不同版本或者抽象程度相同的语言，比如 Babel 可以把 ECMAScript 6 语法转译为 ECMAScript 5 语法。")])]),s._v(" "),a("p",[s._v("利用 Babel，开发者可以使用 ECMAScript 的各种新特性进行开发，同时花极少的精力关注浏览器或其他JS运行环境对新特性的支持。甚至，开发者可以根据自身需要，创造属于自己的 JavaScript 语法。")]),s._v(" "),a("p",[s._v("Babel 在转译的时候，会对源码进行以下处理: 语法转译(Syntax)和添加 API Polyfill。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/5757051/155267231-132a2ee7-828f-4a7e-bb32-eb85a288b7d7.png",alt:"Babel概述/Babel转换过程.png"}})]),s._v(" "),a("ul",[a("li",[a("p",[s._v("语法(Syntax)部分")]),s._v(" "),a("p",[s._v("Babel 支持识别高版本语法，并通过插件将源码从高版本语法转译为低版本语法，如:")]),s._v(" "),a("ul",[a("li",[s._v("箭头函数 "),a("code",[s._v("() => {}")]),s._v(" 转为普通函数 "),a("code",[s._v("function() {}")]),s._v("。")]),s._v(" "),a("li",[a("code",[s._v("const / let")]),s._v(" 转译为 "),a("code",[s._v("var")])])])]),s._v(" "),a("li",[a("p",[s._v("API Polyfill")]),s._v(" "),a("p",[s._v("有些运行时相关的 API，语法转译无法解决它们对低版本浏览器等环境的兼容性问题，因此 Babel 通过与 core-js 等工具的配合，实现 API 部分对目标环境(通常是低版本浏览器等)的兼容。")]),s._v(" "),a("p",[s._v("例如"),a("code",[s._v("[1, 2, 3].include")]),s._v("、"),a("code",[s._v("Promise")]),s._v("等 API，Babel 在处理时，如果目标环节可能不支持原生的 "),a("code",[s._v("include / Promise")]),s._v(" 的话，Babel 会在转译结果中嵌入 "),a("code",[s._v("include / Promise")]),s._v(" 的自定义实现。")])])]),s._v(" "),a("p",[s._v("有多种方式可以使用 Babel，如: 命令行(babel-cli、babel-node)、浏览器（babel-standalone）、API调用(babel-core)、webpack loader(babel-loader)等。")]),s._v(" "),a("h3",{attrs:{id:"_1-2-转译过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-转译过程"}},[s._v("#")]),s._v(" 1.2 转译过程")]),s._v(" "),a("p",[s._v("和多数转译器相同，Babel 运行的生命周期主要是 3 个阶段: 解析、转换、代码生成。")]),s._v(" "),a("p",[s._v("这个过程涉及抽象语法树:")]),s._v(" "),a("p",[s._v("抽象语法树(Abstract Syntax Tree，AST)，或简称语法树(Syntax tree)，是源代码语法结构的一种抽象表示。")]),s._v(" "),a("p",[s._v("AST 是树形对象，以结构化的形式表示编程语言的语法结构，树上的每个节点都表示源代码中的一种结构。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/5757051/155267412-62ddab76-91e5-4b4c-b3d9-439ecee5a3cd.png",alt:"Babel概述/AST-demo.png"}})]),s._v(" "),a("p",[s._v("源码字符串需要经转译器生成 AST，转译器有很多种，不同转译器，生成的AST对象格式细节可能有差异，但共同点为: 都是树形对象、该树形对象描述了节点特征、各节点之间的关系（兄弟、父子等）。")]),s._v(" "),a("p",[s._v("以下是 Babel 生命周期的三个过程:")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("解析(Parsing): Code1 ==> 抽象语法树1")]),s._v(" "),a("p",[s._v("解析过程包括2个环节:词法解析、语法解析，最终生成抽象语法树。")]),s._v(" "),a("p",[s._v("词法解析阶段，代码字符串被解析为 token 令牌数组，数组项是一个对象，包括:代码字符碎片的值、位置、类型等信息。")]),s._v(" "),a("p",[s._v("token 数组是平铺式的数组，没有嵌套的结构信息，它是为语法解析阶段做准备的。")]),s._v(" "),a("p",[s._v("语法解析阶段，token 令牌数组被解析为结构化的抽放语法树对象(AST)。")]),s._v(" "),a("p",[s._v("babel-parser 完成该阶段的主要功能。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/5757051/155267543-453c1f37-fc91-47f1-b19b-63d1376f7c02.png",alt:"Babel概述/AST-tokens"}})])]),s._v(" "),a("li",[a("p",[s._v("转换(Transformation): AST1 ==> AST2")]),s._v(" "),a("p",[s._v("Babel 生成 AST 后，会对 AST 进行遍历，遍历过程中，各类插件对原 AST 对象进行增删改查等操作，AST 结构被修改。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/5757051/155267607-f2be330e-43e5-4b8d-a994-1a1e341c4506.png",alt:"Babel概述/AST-转换"}})])]),s._v(" "),a("li",[a("p",[s._v("代码生成(Generation): AST2 ==> Code2")]),s._v(" "),a("p",[s._v("Babel 将修改后的 AST 对象转目标代码字符串。")]),s._v(" "),a("p",[s._v("babel-generator 完成该阶段的主要功能。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/5757051/155267712-05cac9d1-0158-4bb6-b6fe-a6b20d531d31.png",alt:"Babel概述/AST-生成代码"}})])])]),s._v(" "),a("h2",{attrs:{id:"_2-babel-模块拆解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-babel-模块拆解"}},[s._v("#")]),s._v(" 2 Babel 模块拆解")]),s._v(" "),a("h3",{attrs:{id:"_2-1-微内核架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-微内核架构"}},[s._v("#")]),s._v(" 2.1 微内核架构")]),s._v(" "),a("p",[s._v("Babel采用微内核架构，其内核保留核心功能，其余功能利用外部工具和插件机制实现，也体现了“开放-封闭”的设计原则。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/5757051/155268039-82423cb1-7d31-47de-a4c0-62b72e6b7f67.jpg",alt:"Babel概述/微内核架构"}})]),s._v(" "),a("p",[s._v("除了微内核设计架构，Babel 的模块设计也可以做如下分类:")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/5757051/155267994-ff62fe98-4a9d-453e-8e97-8877969dc4d6.png",alt:"Babel概述/模块分层"}})]),s._v(" "),a("h3",{attrs:{id:"_2-2-转译模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-转译模块"}},[s._v("#")]),s._v(" 2.2 转译模块")]),s._v(" "),a("p",[s._v('转译模块位于 Babel 微内核架构的“微内核”部分，该部分主要负责代码转译，也就是上面提到的"解析-转换-代码生成"过程。')]),s._v(" "),a("p",[s._v("该模块主要包括: babel-parser、babel-traverse、babel-generator。")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("babel-parser")]),s._v(" "),a("p",[s._v("负责将代码字符串转为 AST 对象。")]),s._v(" "),a("p",[s._v("有 2 点值得一提:")]),s._v(" "),a("ul",[a("li",[s._v("babel-parser 本身并不会对 AST 做转换操作，只是负责解析出 AST。AST 转换部分交由各类 plugins 和 presets 处理。")]),s._v(" "),a("li",[s._v("babel-parser 内置了对 ESNext/TypeScript/JSX/Flow 最新版本语法的支持，目前没有开放插件机制扩展新语法。")])])]),s._v(" "),a("li",[a("p",[s._v("babel-traverse")]),s._v(" "),a("p",[s._v("在转译过程中，babel-traverse 负责遍历 AST 节点，并根据配置的 plugins/presets，在遍历过程中，对各个 AST 节点进行增删改查的操作。")]),s._v(" "),a("p",[s._v("AST 是一个树形对象，遍历 AST 对象的过程也是一个深度优先遍历的过程。")])]),s._v(" "),a("li",[a("p",[s._v("babel-generator")]),s._v(" "),a("p",[s._v("负责将 AST 节点，转为代码字符串，同时也可以生成 source-map。")])])]),s._v(" "),a("h3",{attrs:{id:"_2-3-插件模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-插件模块"}},[s._v("#")]),s._v(" 2.3 插件模块")]),s._v(" "),a("p",[s._v("插件模块包括 plugins、presets。")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("plugins")]),s._v(" "),a("p",[s._v("丰富的插件，帮助 Babel 成为一个非常成功的转译工具。")]),s._v(" "),a("p",[s._v("对 AST 的遍历、转换是 Babel 转译的核心功能，但 Babel 本身并不参与该过程，将这些功能作为插件引入到运行时。")]),s._v(" "),a("p",[s._v("具体来说，babel-core 作为核心工具，不提供对 AST 的修改逻辑，通过调用各类插件，实现对 AST 的修改。")]),s._v(" "),a("p",[s._v("Babel的插件分为语法插件和转换插件。")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("语法插件")]),s._v(" "),a("p",[s._v("值得注意的是，babel-parser 负责将 JavaScript 代码解析出抽象语法树(AST)，它支持全面识别 ESNext/TypeScript/JSX/Flow 等语法，目前由 Babel 团队开发维护，不支持插件化。")]),s._v(" "),a("p",[s._v('Babel 插件生态中的语法插件，其功能就是作为"开关"，配置是否开启 babel-parser 的某些语法转译功能。')]),s._v(" "),a("p",[s._v("语法插件在 Babel 源码中，以 "),a("code",[s._v("babel-plugin-syntax")]),s._v(" 开头。")]),s._v(" "),a("p",[s._v("举个例子:")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("babel-plugin-syntax-decorators")])]),s._v(" "),a("p",[s._v("负责开启 babel-parser 对装饰器的语法支持。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("babel-plugin-syntax-dynamic-import")])]),s._v(" "),a("p",[s._v("负责开启 babel-parser 对 "),a("code",[s._v("import")]),s._v(" 语句的语法支持。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("babel-plugin-syntax-jsx")])]),s._v(" "),a("p",[s._v("负责开启 babel-parser 对 jsx 语法的支持。")])])])]),s._v(" "),a("li",[a("p",[s._v("转换插件")]),s._v(" "),a("p",[s._v("转换插件就是社区里常说的 Babel 插件，负责转换 AST 节点。")]),s._v(" "),a("p",[s._v('在介绍 babel-traverse 时提到，它负责遍历 AST 对象，每个 AST 节点会被访问到，等待转换，转换的部分，由"转换插件"负责。')]),s._v(" "),a("p",[s._v('转换插件会提供一个叫做"Visitor"的对象，该对象的 Key 为节点名称，Value 部分提供进入该节点时、离开该节点时的回调函数，在回调函数里，可以对该节点进行一系列操作。')]),s._v(" "),a("p",[s._v('"Visitor"又称为"访问者模式"。')]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// plugin 提供 visitor，在 visitor 中对 AST 节点操作")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" visitor "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("Program")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("enter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("exit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("CallExpression")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("enter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("exit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("NumberLiteral")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("enter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("exit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("traverse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ast"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" visitor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[s._v("转换插件在 Babel 源码中，以 "),a("code",[s._v("babel-plugin-transform")]),s._v(" 开头。")]),s._v(" "),a("p",[s._v("举个例子:")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("babel-plugin-transform-strict-mode")]),s._v(" "),a("p",[s._v("该插件拦截 "),a("code",[s._v("Program")]),s._v(" 节点，也就是整个程序的根节点，添加 "),a("code",[s._v('"use strict"')]),s._v(" 指令。")]),s._v(" "),a("p",[s._v("visitor 节点值为函数时，是 enter 回调的快捷方式。")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"transform-strict-mode"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("visitor")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Program")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" node "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" directive "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("of")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("directives"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Array"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Object"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("directive"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("value "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"use strict"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("unshiftContainer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"directives"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("directive")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("directiveLiteral")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"use strict"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("babel-plugin-transform-object-assign")]),s._v(" "),a("p",[s._v("该插件负责拦截函数调用表达式节点 "),a("code",[s._v("CallExpression")]),s._v("，将 "),a("code",[s._v("Object.assign")]),s._v(" 转为 "),a("code",[s._v("extends")]),s._v(" 写法。")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"transform-object-assign"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("visitor")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("CallExpression")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"callee"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("matchesPattern")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Object.assign"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("callee "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("addHelper")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"extends"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])])])])])])]),s._v(" "),a("li",[a("p",[s._v("presets")]),s._v(" "),a("p",[s._v("Babel 插件的功能是细粒度的，大部分插件承担了单一功能。")]),s._v(" "),a("p",[s._v("而在实际开发过程中，往往需要支持对各类语法的支持。此时，有两种做法:")]),s._v(" "),a("ol",[a("li",[s._v("需要支持哪些特性，就分别引入支持该特性的插件")]),s._v(" "),a("li",[s._v("直接引入一个插件集合，涵盖所需的各类插件功能")])]),s._v(" "),a("p",[s._v("很显然，第一种做法是相对麻烦的。针对第二种做法，Babel 提供了插件集 preset。")]),s._v(" "),a("p",[s._v("preset 在 Babel 源码中，以 "),a("code",[s._v("babel-preset")]),s._v(" 开头。")]),s._v(" "),a("p",[s._v("例如，Babel 已经提供了几种常用的 preset 供开发者使用:")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("babel-preset-env")])]),s._v(" "),a("li",[a("code",[s._v("babel-preset-react")])]),s._v(" "),a("li",[a("code",[s._v("babel-preset-flow")])]),s._v(" "),a("li",[a("code",[s._v("babel-preset-typescript")])])])]),s._v(" "),a("li",[a("p",[s._v("插件运行顺序")]),s._v(" "),a("p",[s._v("Babel 配置项中，plugins 和 presets 均以数组的形式配置，执行时有先后顺序。")]),s._v(" "),a("ul",[a("li",[s._v("plugins 在 presets之前运行")]),s._v(" "),a("li",[s._v("plugins 按照数组正序执行")]),s._v(" "),a("li",[s._v("presets 按照数组倒序执行")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/5757051/155268224-00fe6902-8ab8-4054-828f-85197e97ffc3.png",alt:"Babel概述/插件运行顺序"}})])])]),s._v(" "),a("h3",{attrs:{id:"_2-4-工具模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-工具模块"}},[s._v("#")]),s._v(" 2.4 工具模块")]),s._v(" "),a("p",[s._v("工具模块提供 Babel 相关模块所需的各类工具，以下一一简要介绍:")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("babel-core")]),s._v(" "),a("p",[s._v("babel-core 对外提供了 Babel 多项功能的 API，如转译文件、转译代码、创建/获取配置等，在 Babel 官方文档介绍的比较详细，不再赘述。")]),s._v(" "),a("p",[s._v("值得注意的是，转译类的 API 均提供了同步和异步版本，如"),a("code",[s._v("transformSync/transfomAsync")]),s._v("、"),a("code",[s._v("parseSync/parseAsync")]),s._v("。")])]),s._v(" "),a("li",[a("p",[s._v("babel-cli")]),s._v(" "),a("p",[s._v("Babel的命令行工具，可以直接转译文件夹/文件，它也提供了很多配置项做其他工作，官方文档介绍的比较详细，感兴趣的同学可以去 Babel 官网查看详细配置。")])]),s._v(" "),a("li",[a("p",[s._v("babel-standalone")]),s._v(" "),a("p",[s._v("Babel 对外服务的很多包是基于 node 环境下使用的，babel-standalone 提供了浏览器下转译的方案。")]),s._v(" "),a("p",[s._v("babel-standalone 内置了所有 Babel 插件，所以体积还是比较大的，而且在浏览器端转译需要时间，比较适合开发、学习使用，不适合在生产环境使用。")]),s._v(" "),a("p",[s._v("举个例子:")]),s._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token doctype"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<!")]),a("span",{pre:!0,attrs:{class:"token doctype-tag"}},[s._v("DOCTYPE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token name"}},[s._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("meta")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("charset")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("utf-8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("title")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("test babel-standalone"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("title")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("https://unpkg.com/@babel/standalone/babel.min.js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("text/babel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[s._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" arr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),s._v("arr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    ")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("在浏览器运行该 html，可以看到，页面结构变成了:")]),s._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token doctype"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<!")]),a("span",{pre:!0,attrs:{class:"token doctype-tag"}},[s._v("DOCTYPE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token name"}},[s._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("meta")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("charset")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("utf-8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("title")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("test babel-standalone"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("title")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("https://unpkg.com/@babel/standalone/babel.min.js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("text/babel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[s._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" arr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),s._v("arr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    ")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"use strict"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" _console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" arr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_console "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apply")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" arr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//# sourceMappingURL=data:application/json;charset=utf-8;base64...")]),s._v("\n    ")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("babel-node")]),s._v(" "),a("p",[s._v("提供在命令行执行高级语法的环境。")]),s._v(" "),a("p",[s._v("例如:")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// index.js 里可以使用高级语法")]),s._v("\nbabel"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("e index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("index.js 文件以及被其引入的其他文件均可以使用高级语法了。")]),s._v(" "),a("p",[s._v("和 babel-cli 不同的是，babel-cli 只负责转换，不在 node 运行时执行；babel-node 会在 node 运行时执行转换，不适合生产环境使用。")])]),s._v(" "),a("li",[a("p",[s._v("babel-register")]),s._v(" "),a("p",[s._v("在源文件中，引入"),a("code",[s._v("babel-register")]),s._v("，如 index.js:")]),s._v(" "),a("p",[s._v("index.js")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'babel-register'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./run'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("run.js")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" fs "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'fs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("执行 "),a("code",[s._v("node index")]),s._v(" 时，run.js 就不需要被转码了。")]),s._v(" "),a("p",[s._v("babel-register 通过拦截 node require 方法，为 node 运行时引入了 Babel 的转译能力。")])]),s._v(" "),a("li",[a("p",[s._v("babel-loader")]),s._v(" "),a("p",[s._v("babel-loader 并不是 Babel 官方提供的对外服务工具，它是独立的另一个项目，利用 babel-core 的 API 封装的 webpack loader，用于 webpack 构建过程。")])]),s._v(" "),a("li",[a("p",[s._v("babel-types")]),s._v(" "),a("p",[s._v("babel-types 是一个非常强大的工具集合，它集成了节点校验、增删改查等功能，是 Babel 核心模块开发、插件开发等场景下不可或缺的工具。")]),s._v(" "),a("p",[s._v("例如:")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" t "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@babel/types'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" binaryExpression "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("binaryExpression")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'+'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("numericLiteral")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("numericLiteral")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("babel-template")]),s._v(" "),a("p",[s._v("模板引擎，负责将代码字符串转为 AST 节点对象。")]),s._v(" "),a("div",{staticClass:"language-typescript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" smart "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" template "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@babel/template'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" generate "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@babel/generator'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" t "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@babel/types'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" buildRequire "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\n  var %%importName%% = require(%%source%%);\n")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" ast "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("buildRequire")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    importName"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("identifier")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'myModule'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    source"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("stringLiteral")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-module"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" code "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("generate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ast"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("code\n\n"),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("console")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("运行结果:")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" myModule "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-module"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("babel-code-frame")]),s._v(" "),a("p",[s._v("负责打印出错的代码位置，例如:")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" codeFrameColumns "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@babel/code-frame'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" testCode "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\nclass Run {\n    constructor() {}\n}\n")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" location "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("start")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("line")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("column")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" result "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("codeFrameColumns")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("testCode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" location"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" class Run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("constructor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  ^\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("babel-highlight")]),s._v(" "),a("p",[s._v("向控制台输出有颜色的代码片段。该工具可以识别 JavaScript 中的操作符号、标识符、保留字等类型的词法单元，并在终端环境下显示不同的颜色。")])])]),s._v(" "),a("h3",{attrs:{id:"_2-5-运行时相关模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-运行时相关模块"}},[s._v("#")]),s._v(" 2.5 运行时相关模块")]),s._v(" "),a("p",[s._v("Babel配合其插件可以对静态代码进行转译，但有一些遗漏点:")]),s._v(" "),a("ul",[a("li",[s._v("对于运行时涉及的一些高版本 API，并没有转译为更低版本的 API")]),s._v(" "),a("li",[s._v("转译产物代码可能有些臃肿")])]),s._v(" "),a("p",[s._v("为此，运行时模块(runtime)关注的是转译产物的运行时环境，对运行时提供 API polyfill、代码优化等，该模块涉及几个子包:")]),s._v(" "),a("ul",[a("li",[s._v("babel-preset-env")]),s._v(" "),a("li",[s._v("babel-plugin-transform-runtime")]),s._v(" "),a("li",[s._v("babel-runtime")]),s._v(" "),a("li",[s._v("babel-runtime-corejs2/3")]),s._v(" "),a("li",[s._v("core-js")])]),s._v(" "),a("p",[s._v("接下来以案例解释 runtime 模块的作用。")]),s._v(" "),a("p",[s._v("源码文件 index.js 的内容:")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// const 为语法部分")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Base")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// class 为语法部分")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Promise")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Promise 为 API 部分")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("这段源码包含了语法和 API 部分:")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("const")]),s._v("、"),a("code",[s._v("class")]),s._v(" 为语法部分")]),s._v(" "),a("li",[a("code",[s._v("Promise")]),s._v("为 API 部分")])]),s._v(" "),a("p",[s._v("如果希望这段源码转为 ES5 版本，使构建产物可以运行在不支持 ES6 和 Promise 的环境里，该怎么做呢？")]),s._v(" "),a("p",[s._v("用 babel 命令行执行转译，其中源文件为 index.js，转译产物文件为 index-compiled.js。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("npx babel index.js --out-file index-compiled.js\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("blockquote",[a("p",[s._v("安装 node 或 npm 后，可直接使用 npx 唤起各类命令行执行")])]),s._v(" "),a("p",[s._v("需要配置 "),a("code",[s._v(".babelrc")]),s._v(" 帮助 Babel 完成语法和 API 部分的转译:")]),s._v(" "),a("p",[a("code",[s._v(".babelrc")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"presets"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" \n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@babel/preset-env"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"plugins"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@babel/plugin-transform-runtime"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"corejs"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("简要解释下该配置的原理:")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("babel-preset-env 可以完成语法部分转译，即 "),a("code",[s._v("const")]),s._v(" 转译为"),a("code",[s._v("var")])]),s._v(" "),a("p",[s._v("但构建产物中，有些辅助代码如 "),a("code",[s._v("_classCallCheck")]),s._v(" 是以硬编码的形式直接写入转译产物的:")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"use strict"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("_classCallCheck")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("instance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Constructor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("instance "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("instanceof")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Constructor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TypeError")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Cannot call a class as a function"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("Base")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Base")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("_classCallCheck")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Base"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Promise")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("这样的后果就是构建产物比较臃肿。")])]),s._v(" "),a("li",[a("p",[s._v("babel-plugin-transform-runtime 可以将上述 "),a("code",[s._v("_classCallCheck")]),s._v(" 置于通用包中，以引用的形式写入转译产物:")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"use strict"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" _interopRequireDefault "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@babel/runtime/helpers/interopRequireDefault"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" _classCallCheck2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("_interopRequireDefault")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@babel/runtime/helpers/classCallCheck"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("Base")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Base")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" _classCallCheck2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Base"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Promise")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("babel-plugin-transform-runtime 的配置参数 "),a("code",[s._v("corejs")]),s._v(" 用于转译 API 部分，如 "),a("code",[s._v("Promsie")])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"use strict"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" _interopRequireDefault "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@babel/runtime-corejs3/helpers/interopRequireDefault"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" _promise "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("_interopRequireDefault")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@babel/runtime-corejs3/core-js-stable/promise"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" _classCallCheck2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("_interopRequireDefault")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@babel/runtime-corejs3/helpers/classCallCheck"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("Base")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Base")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" _classCallCheck2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Base"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("_promise")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])])])]),s._v(" "),a("p",[s._v('Babel 转译过程的运行时优化是一个繁琐的过程，为此将单独用一章讲解运行时优化，感兴趣的同学可以直接阅读 "Babel Runtime" 章节详细了解。')]),s._v(" "),a("h2",{attrs:{id:"_3-使用-babel"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-使用-babel"}},[s._v("#")]),s._v(" 3 使用 Babel")]),s._v(" "),a("h3",{attrs:{id:"_3-1-对外工具集"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-对外工具集"}},[s._v("#")]),s._v(" 3.1 对外工具集")]),s._v(" "),a("p",[s._v("在介绍 Babel 微内核架构时，面向用户使用的工具，有这些:")]),s._v(" "),a("ul",[a("li",[s._v("babel-cli")]),s._v(" "),a("li",[s._v("babel-node")]),s._v(" "),a("li",[s._v("babel-register")]),s._v(" "),a("li",[s._v("babel-standalone")]),s._v(" "),a("li",[s._v("babel-parser")]),s._v(" "),a("li",[s._v("babel-loader")])]),s._v(" "),a("p",[s._v("由此看出，Babel 官方和社区提供了众多工具以满足开发者在不同场景下使用 Babel 的需要，下图是 Babel 可以使用的场景分类:")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/5757051/155268321-a4fd97d5-4914-4494-a3d3-95c0aaf0222f.png",alt:"Babel概述/对外工具集"}})]),s._v(" "),a("h3",{attrs:{id:"_3-2-配置-babel"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-配置-babel"}},[s._v("#")]),s._v(" 3.2 配置 Babel")]),s._v(" "),a("h3",{attrs:{id:"多种配置方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#多种配置方式"}},[s._v("#")]),s._v(" 多种配置方式")]),s._v(" "),a("p",[s._v("Babel 支持多种配置方式。")]),s._v(" "),a("h4",{attrs:{id:"文件式配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件式配置"}},[s._v("#")]),s._v(" 文件式配置")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("配置文件列表")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("babel.config.")]),s._v(" 为前缀的文件")]),s._v(" "),a("ul",[a("li",[s._v("babel.config.json")]),s._v(" "),a("li",[s._v("babel.config.js")]),s._v(" "),a("li",[s._v("babel.config.cjs")]),s._v(" "),a("li",[s._v("babel.config.mjs")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v(".babelrc")]),s._v(" 为前缀的文件")]),s._v(" "),a("ul",[a("li",[s._v(".babelrc.json")]),s._v(" "),a("li",[s._v(".babelrc.js")]),s._v(" "),a("li",[s._v(".babelrc.cjs")]),s._v(" "),a("li",[s._v(".babelrc.mjs")])]),s._v(" "),a("p",[s._v("其他工具如 ESLint、Prettier 也有类似的配置文件: .eslintrc、.prettierrc。")])]),s._v(" "),a("li",[a("p",[s._v("package.json 中")]),s._v(" "),a("p",[s._v('package.json 中的 "babel" 字段。')])])])]),s._v(" "),a("li",[a("p",[s._v("配置文件格式")]),s._v(" "),a("p",[s._v("不同后缀名的配置文件，其配置内容需遵循不同的格式规范。")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v(".cjs")]),s._v(" 文件，内容是 CommonJS 规范")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" presets "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" plugins "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" presets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" plugins "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v(".mjs")]),s._v(" 文件，内容是 ECMAScript modules 格式")]),s._v(" "),a("p",[s._v("可以在 Node.js 13.2 及以上版本试用，也可以在较老版本 Node.js 的 "),a("code",[s._v("--experimental-modules")]),s._v(" 标记下使用。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v(".js")]),s._v(" 文件内容，可以是 CommonJS 规范，也可以是 ECMAScript modules 格式")]),s._v(" "),a("p",[s._v("如果在 package.json 中指定 "),a("code",[s._v('"type": "module"')]),s._v("，"),a("code",[s._v("babel.config.js")]),s._v(" 和 "),a("code",[s._v(".babelrc.js")]),s._v(" 文件即可使用 ECMAScript modules。")]),s._v(" "),a("p",[s._v("否则，"),a("code",[s._v("babel.config.js")]),s._v(" 和 "),a("code",[s._v(".babelrc.js")]),s._v(" 文件需要使用 CommonJS 规范。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v(".json")]),s._v(" 文件，内容可以是: JSON5 规范、CommonJS 规范")]),s._v(" "),a("p",[s._v("JSON5 规范的写法:")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-package"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.0.0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"babel"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"presets"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" ... "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"plugins"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" ... "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])])])])])]),s._v(" "),a("h4",{attrs:{id:"命令行式配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#命令行式配置"}},[s._v("#")]),s._v(" 命令行式配置")]),s._v(" "),a("p",[s._v("Babel 支持执行 "),a("code",[s._v("babel")]),s._v(" 命令行时指定配置。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("babel --plugins @babel/plugin-transform-arrow-functions script.js\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"api式配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#api式配置"}},[s._v("#")]),s._v(" API式配置")]),s._v(" "),a("p",[s._v("通过调用 Babel 提供的 API，并为其传参。")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@babel/core"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("transformSync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("plugins")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@babel/plugin-transform-arrow-functions"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"项目级配置与局部配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#项目级配置与局部配置"}},[s._v("#")]),s._v(" 项目级配置与局部配置")]),s._v(" "),a("p",[s._v("Babel7 新增了项目级配置和局部配置的概念，其配置文件有两种作用范围: 完整的项目范围、子项目范围。")]),s._v(" "),a("p",[a("code",[s._v("babel.config.")]),s._v(" 系列的配置文件，影响范围是整个项目。")]),s._v(" "),a("p",[a("code",[s._v(".babelrc")]),s._v(" 系列的配置文件，影响范围是子项目。")]),s._v(" "),a("p",[s._v("官方文档对此有详细的描述，以下是笔者整理后的配置文件作用范围描述:")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("项目级配置文件（"),a("code",[s._v("babel.config.")]),s._v(" 系列）")])]),s._v(" "),a("li",[a("p",[s._v("局部配置文件（"),a("code",[s._v(".babelrc")]),s._v(" 系列）")]),s._v(" "),a("p",[s._v("对于当前正在被转译的文件，Babel 会逐级向上查找 "),a("code",[s._v(".babelrc")]),s._v(" 系列的配置文件，直到第一个有 "),a("code",[s._v("package.json")]),s._v(" 的目录、或当前项目的 "),a("code",[s._v("root")]),s._v(" 目录。")]),s._v(" "),a("p",[s._v("找到局部配置文件后，会将其内容和 "),a("code",[s._v("babel.config.json")]),s._v(" 之类的配置内容合并。")])])]),s._v(" "),a("h3",{attrs:{id:"配置项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置项"}},[s._v("#")]),s._v(" 配置项")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Primary options")]),s._v(" "),a("p",[s._v("这些配置在 API 中使用，相对于文件形式（"),a("code",[s._v(".babelrc")]),s._v(" 等）的配置，它们的优先级更高些，因此成为 "),a("code",[s._v("Primary options")]),s._v("。")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("cwd: string")])]),s._v(" "),a("p",[s._v("默认值是: "),a("code",[s._v("process.cwd()")])]),s._v(" "),a("p",[s._v("Babel 运行过程中，所有子路径的相对地址，应用于 API 调用时。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("caller: CallerData")])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CallerData")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    supportsStaticESM"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" boolean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    supportsDynamicImport"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" boolean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    supportsTopLevelAwait"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" boolean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    supportsExportNamespaceFrom"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" boolean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("提供给 Babel 自身配置项、"),a("code",[s._v("plugins")]),s._v("、"),a("code",[s._v("presets")]),s._v(" 的一些快捷灵活配置项。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("filename: string")])]),s._v(" "),a("p",[s._v("这是个非必填项。可用于 API 调用时，一些其他配置项依赖 "),a("code",[s._v("filename")]),s._v(" 的配置。")]),s._v(" "),a("p",[s._v("这里有一些场景可能需要配置 "),a("code",[s._v("filename")]),s._v(":")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("filename")]),s._v(" 的值可以暴露给插件做进一步处理")]),s._v(" "),a("li",[a("code",[s._v("test")]),s._v("、"),a("code",[s._v("exclude")]),s._v("、"),a("code",[s._v("ignore")]),s._v(" 等配置项需要 "),a("code",[s._v("filename")]),s._v(" 有值用于匹配")]),s._v(" "),a("li",[s._v("不提供 "),a("code",[s._v("filename")]),s._v(" 的情况下，查找 "),a("code",[s._v(".babelrc.json")]),s._v("、"),a("code",[s._v(".babelrc")]),s._v(" 这些配置文件时，会相对于被转译的目标文件；如果提供了 "),a("code",[s._v("filename")]),s._v("，会默认执行 "),a("code",[s._v("babelrc: false")]),s._v(" 的逻辑")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("filenameRelative: string")])]),s._v(" "),a("p",[s._v("默认值: "),a("code",[s._v("path.relative(opts.cwd, opts.filename)")]),s._v("。")]),s._v(" "),a("p",[a("code",[s._v("filenameRelative")]),s._v(" 的值会是配置项 "),a("code",[s._v("sourceFileName")]),s._v(" 的默认值。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("code: boolean")])]),s._v(" "),a("p",[s._v("默认是 "),a("code",[s._v("true")]),s._v("。")]),s._v(" "),a("p",[s._v("默认情况下，api 如 "),a("code",[s._v("transformSync")]),s._v(" 在转译后会返回转译后的代码，也就是 "),a("code",[s._v("code")]),s._v("。但可能存在不需要 "),a("code",[s._v("code")]),s._v(" 的时候，比如在多级转译时，前后逻辑仅需要 AST 传递即可。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("ast: boolean")])]),s._v(" "),a("p",[s._v("默认是 "),a("code",[s._v("false")]),s._v("，api 如 "),a("code",[s._v("transformSync")]),s._v(" 并不会返回转移后代码的 AST 对象，也是出于性能考虑，因为 Babel 会优先为转译结果添加本地缓存文件，而 AST 对象需要占用挺大空间的。")]),s._v(" "),a("p",[s._v("如果需要在多级转译时，利用中间过程产生的 AST 对象，就可以设置为 "),a("code",[s._v("true")]),s._v(" 了:")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" filename "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"example.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" source "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("readFileSync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("filename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"utf8"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Load and compile file normally, but skip code generation.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ast "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" babel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("transformSync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    filename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("ast")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("code")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Minify the file in a second pass and generate the output code here.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" map "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" babel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("transformFromAstSync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ast"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    filename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("presets")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"minify"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("babelrc")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("configFile")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("cloneInputAst: boolean")])]),s._v(" "),a("p",[s._v("默认值是 "),a("code",[s._v("true")]),s._v("。")]),s._v(" "),a("p",[s._v("例如:")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" map "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" babel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("transformFromAstSync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ast"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    filename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("presets")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"minify"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("babelrc")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("configFile")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("code",[s._v("babel.transformFromAstSync")]),s._v(" 会接受一个 ast 对象进行各种操作，内部会复制一个新的 ast 对象避免修改传入的 ast 对象。当然开发者可以决定是否需要复制，毕竟复制的开销是比较大的。")])])])]),s._v(" "),a("li",[a("p",[s._v("Config Loading options")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("root")])]),s._v(" "),a("p",[s._v("仅用于 API 调用环境。类型是 "),a("code",[s._v("string")]),s._v("，默认值是 "),a("code",[s._v("opts.cwd")]),s._v(" 的值，"),a("code",[s._v("opts.cwd")]),s._v(" 的默认值是 "),a("code",[s._v("process.cwd()")]),s._v("。")]),s._v(" "),a("p",[s._v("这是一个基准路径，与 "),a("code",[s._v("rootMode")]),s._v(" 配合使用，它决定了当前 Babel 作用项目的根路径（root folder）是什么。")]),s._v(" "),a("p",[s._v("这个基准值可以用来:")]),s._v(" "),a("ul",[a("li",[s._v("作为查找 "),a("code",[s._v("configFile")]),s._v(" 配置项的基准路径")]),s._v(" "),a("li",[s._v("作为 "),a("code",[s._v("babelrcRoots")]),s._v(" 配置项的默认值")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("rootMode")])]),s._v(" "),a("p",[s._v("仅用于 API 调用环境。类型是 "),a("code",[s._v('"root" | "upward" | "upward-optional"')]),s._v("。默认值是 "),a("code",[s._v('"root"')]),s._v("。")]),s._v(" "),a("p",[a("code",[s._v("rootMode")]),s._v(" 与 "),a("code",[s._v("root")]),s._v(" 配合使用，它决定了当前 Babel 作用项目的根路径。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v('"root"')]),s._v(": 和默认值一样，描述当前 Babel 作用项目的根路径")]),s._v(" "),a("li",[a("code",[s._v('"upward"')]),s._v(": 沿着 "),a("code",[s._v("root")]),s._v(" 配置项持续向上查找，发现 "),a("code",[s._v("babel.config.json")]),s._v(" 文件后停止向上遍历，否则会一直遍历到系统根目录")]),s._v(" "),a("li",[a("code",[s._v('"upward-optional"')]),s._v(": 和 "),a("code",[s._v('"upward"')]),s._v(" 一样，但如果遍历到系统根目录也没有发现 "),a("code",[s._v("babel.config.json")]),s._v(" 文件，会退回到 "),a("code",[s._v('"root"')]),s._v(" 值")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("envName")])]),s._v(" "),a("p",[s._v("仅用于 API 调用环境。类型是 "),a("code",[s._v("string")]),s._v("。默认值是 "),a("code",[s._v('process.env.BABEL_ENV || process.env.NODE_ENV || "development"')]),s._v("。")]),s._v(" "),a("p",[s._v("可以在配置文件的 "),a("code",[s._v('"env"')]),s._v(" 配置项里，或 "),a("code",[s._v("api.env()")]),s._v(" 方法使用。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("configFile")])]),s._v(" "),a("p",[s._v("仅用于 API 调用环境。类型是 "),a("code",[s._v("string | boolean")]),s._v("。默认值是 "),a("code",[s._v('path.resolve(opts.root, "babel.config.json")')]),s._v("，但内部会判断该路径的文件是否存在，如果不存在，值会被调整为 "),a("code",[s._v("false")]),s._v("。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("babelrc")])]),s._v(" "),a("p",[s._v("仅用于 API 调用环境。类型是 "),a("code",[s._v("boolean")]),s._v("。默认值是 "),a("code",[s._v("true")]),s._v("。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("babelrcRoots")])])])])]),s._v(" "),a("li",[a("p",[s._v("Plugin and Preset options")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("plugins/presets")])]),s._v(" "),a("p",[a("code",[s._v("plugin/preset")]),s._v(" 配置规范相同。")]),s._v(" "),a("p",[s._v("对于 "),a("code",[s._v("plugin/preset")]),s._v("，如下配置方式的含义是一致的:")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"plugins"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pluginA"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pluginA"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pluginA"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[a("code",[s._v('[ "pluginA", {} ]')]),s._v(" 这种写法可以为 plugin/preset 描述更具体的配置，如:")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"plugins"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"transform-async-to-module-method"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"module"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bluebird"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"method"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"coroutine"')]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"presets"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"env"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"loose"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"modules"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("passPerPreset")])])])])]),s._v(" "),a("li",[a("p",[s._v("Output targets")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("targets")])]),s._v(" "),a("p",[s._v("类型 "),a("code",[s._v("string | Array<string> | { [string]: string }")]),s._v("。默认值 "),a("code",[s._v("{}")]),s._v("。")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("举例")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"targets"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"> 0.25%, not dead"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("要适配的目标环境的最小版本:")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"targets"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"chrome"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"58"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"ie"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"11"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("目标环境可以是: "),a("code",[s._v("chrome")]),s._v(", "),a("code",[s._v("opera")]),s._v(", "),a("code",[s._v("edge")]),s._v(", "),a("code",[s._v("firefox")]),s._v(", "),a("code",[s._v("safari")]),s._v(", "),a("code",[s._v("ie")]),s._v(", "),a("code",[s._v("ios")]),s._v(", "),a("code",[s._v("android")]),s._v(", "),a("code",[s._v("node")]),s._v(", "),a("code",[s._v("electron")]),s._v("。")])]),s._v(" "),a("li",[a("p",[s._v("没有设置 "),a("code",[s._v("targets")]),s._v(" 时")]),s._v(" "),a("p",[s._v("如果没有设置 "),a("code",[s._v("targets")]),s._v("，Babel 默认会假设你要适配最古老的浏览器版本，当然这样是不推荐的，因为转译后的文件会比较大。")]),s._v(" "),a("p",[s._v("截至本书截稿时，如果使用者没有指定 "),a("code",[s._v("targets")]),s._v(" 的值，Babel 也不会像 browserslist 那样提供一个 "),a("code",[s._v('"defaults"')]),s._v(" 的默认值。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("targets.esmodules")])]),s._v(" "),a("p",[s._v("类型 "),a("code",[s._v("boolean")]),s._v("。默认值 ??")]),s._v(" "),a("p",[s._v("可以指定支持 esmodules 的目标浏览器。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("targets.node")])]),s._v(" "),a("p",[s._v("类型 "),a("code",[s._v('string | "current" | true')]),s._v("。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("targets.safari")])]),s._v(" "),a("p",[s._v("类型 "),a("code",[s._v('string | "tp"')]),s._v("。")]),s._v(" "),a("p",[s._v("可以通过设置为 "),a("code",[s._v('"tp"')]),s._v(" 来指定 safari 的 "),a("code",[s._v("technology preview")]),s._v(" 版本。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("targets.browsers")])]),s._v(" "),a("p",[s._v("类型 "),a("code",[s._v("string | Array<string>")]),s._v("。它的语法是 browserslist 的查询语法。")])])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("browserslistConfigFile")])]),s._v(" "),a("p",[s._v("类型 "),a("code",[s._v("boolean")]),s._v("。默认值是 "),a("code",[s._v("true")]),s._v("。用于 browserslist 查询配置用。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("browserslistEnv")])]),s._v(" "),a("p",[s._v("类型是 "),a("code",[s._v("string")]),s._v("。默认 "),a("code",[s._v("undefined")]),s._v("。")])])])]),s._v(" "),a("li",[a("p",[s._v("Config Merging options")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("extends")])]),s._v(" "),a("p",[s._v("类型是 "),a("code",[s._v("string")]),s._v("。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("env")])]),s._v(" "),a("p",[s._v("类型是 "),a("code",[s._v("{ [envKey: string]: Options }")]),s._v("。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("overrides")])]),s._v(" "),a("p",[s._v("类型是 "),a("code",[s._v("Array<Options>")]),s._v("。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("test")])]),s._v(" "),a("p",[s._v("类型是 "),a("code",[s._v("MatchPattern | Array<MatchPattern>")]),s._v("。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("include")])]),s._v(" "),a("p",[s._v("类型是 "),a("code",[s._v("MatchPattern | Array<MatchPattern>")]),s._v("。")]),s._v(" "),a("p",[s._v("同 "),a("code",[s._v("test")]),s._v("。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("exclude")])]),s._v(" "),a("p",[s._v("类型是 "),a("code",[s._v("MatchPattern | Array<MatchPattern>")]),s._v("。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("ignore")])]),s._v(" "),a("p",[s._v("类型 "),a("code",[s._v("Array<MatchPattern>")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("ignore")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./lib"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("only")])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("only")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./src"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])])]),s._v(" "),a("li",[a("p",[s._v("Source Map options")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("inputSourceMap")])]),s._v(" "),a("p",[s._v("类型 "),a("code",[s._v("boolean | SourceMap")]),s._v("。默认值 "),a("code",[s._v("true")]),s._v("。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("true")]),s._v(": 如果存在注释 "),a("code",[s._v("//# sourceMappingURL=...")]),s._v("，会尝试在 Babel 要转译的文件中寻找 sourceMap 的信息，如果加载失败的话就忽略")]),s._v(" "),a("li",[a("code",[s._v("SourceMap")]),s._v(": 也可以传入一个 sourceMap 对象")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("sourceMaps")])]),s._v(" "),a("p",[s._v("类型 "),a("code",[s._v('boolean | "inline" | "both"')]),s._v("。默认值 "),a("code",[s._v("false")]),s._v("。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("true")]),s._v(": 转译时会生成 sourceMap，并在转译结果对象中添加 sourceMap 结果对象")]),s._v(" "),a("li",[a("code",[s._v('"inline"')]),s._v(": 转译时会生成 sourceMap，并在转译结果代码中添加以 "),a("code",[s._v("data")]),s._v(" 开头的 sourceMap 代码")]),s._v(" "),a("li",[a("code",[s._v('"both"')]),s._v(": 综合了 "),a("code",[s._v("true")]),s._v(" 和 "),a("code",[s._v('"inline"')])])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("sourceMap")])]),s._v(" "),a("p",[s._v("同 "),a("code",[s._v("sourceMaps")]),s._v(" 配置项，推荐使用 "),a("code",[s._v("sourceMaps")]),s._v("。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("sourceFileName")])]),s._v(" "),a("p",[s._v("类型 "),a("code",[s._v("string")]),s._v("。默认值 "),a("code",[s._v("path.basename(opts.filenameRelative)")]),s._v("，如果不可用，会被重置为 "),a("code",[s._v("unknown")]),s._v("。")]),s._v(" "),a("p",[s._v("用于 sourceMap 对象内部。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("sourceRoot")])]),s._v(" "),a("p",[s._v("类型 "),a("code",[s._v("string")]),s._v("。")]),s._v(" "),a("p",[s._v("设置生成的 sourceMap 中的 "),a("code",[s._v("sourceRoot")]),s._v(" 字段。")])])])]),s._v(" "),a("li",[a("p",[s._v("Misc options")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("sourceType")])]),s._v(" "),a("p",[s._v("类型 "),a("code",[s._v('"script" | "module" | "unambiguous"')]),s._v("。默认 "),a("code",[s._v('"module"')]),s._v("。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v('"script"')]),s._v(": 使用 ECMAScript Script 语法转译。不允许出现 "),a("code",[s._v("import/export")]),s._v(" 语句的写法。")]),s._v(" "),a("li",[a("code",[s._v('"module"')]),s._v(": 使用 ECMAScript Module 语法转译。允许出现 "),a("code",[s._v("import/export")]),s._v(" 语句的写法，并默认转译为严格模式。")]),s._v(" "),a("li",[a("code",[s._v('"unambiguous"')]),s._v(": 自动化判断，如果源码中出现了 "),a("code",[s._v("import/export")]),s._v(" 语句，就用 "),a("code",[s._v('"module"')]),s._v(" 模式，否则用 "),a("code",[s._v('"script"')]),s._v(" 模式。")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("assumptions")])]),s._v(" "),a("p",[s._v("类型 "),a("code",[s._v("{ [assumption: string]: boolean }")]),s._v("。默认 "),a("code",[s._v("{}")]),s._v("。")]),s._v(" "),a("p",[s._v("允许使用在 API 使用、配置文件、"),a("code",[s._v("presets")]),s._v(" 中。")]),s._v(" "),a("p",[s._v("它可以用来减少转译结果大小。")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"assumptions"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"iterableIsArray"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"presets"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@babel/preset-env"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("highlightCode")])]),s._v(" "),a("p",[s._v("类型 "),a("code",[s._v("boolean")]),s._v("。默认 "),a("code",[s._v("true")]),s._v("。")]),s._v(" "),a("p",[s._v("在错误提示里对源码高亮展示。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("wrapPluginVisitorMethod")])]),s._v(" "),a("p",[s._v("类型 "),a("code",[s._v("(key: string, nodeType: string, fn: Function) => Function")]),s._v("。")]),s._v(" "),a("p",[s._v("该方法可用于 AST 节点被内部访问等处理时，开发者做拦截处理。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("key")]),s._v(": ??")]),s._v(" "),a("li",[a("code",[s._v("nodeType")]),s._v(": AST 节点类型")]),s._v(" "),a("li",[a("code",[s._v("fn")]),s._v(": AST 节点内部处理函数")])]),s._v(" "),a("p",[s._v("开发者需要返回一个新的函数，并在新函数里执行旧的处理函数 "),a("code",[s._v("fn")]),s._v("。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("parserOpts")])]),s._v(" "),a("p",[s._v("类型 "),a("code",[s._v("{}")]),s._v("。用于给 babel-parser 提供配置项。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("generatorOpts")])]),s._v(" "),a("p",[s._v("类型 "),a("code",[s._v("{}")]),s._v("。用于给 babel-generator 提供配置项。")])])])]),s._v(" "),a("li",[a("p",[s._v("Code Generator options")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("retainLines")])]),s._v(" "),a("p",[s._v("类型 "),a("code",[s._v("boolean")]),s._v("。默认值 "),a("code",[s._v("false")]),s._v("。")]),s._v(" "),a("p",[s._v("？？")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("compact")])]),s._v(" "),a("p",[s._v("类型 "),a("code",[s._v('boolean | "auto"')]),s._v("。默认值 "),a("code",[s._v('"auto"')]),s._v("。")]),s._v(" "),a("p",[s._v("？？")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("minified")])]),s._v(" "),a("p",[s._v("类型 "),a("code",[s._v("boolean")]),s._v("。默认值 "),a("code",[s._v("false")]),s._v("。")]),s._v(" "),a("p",[s._v("如果设置为 "),a("code",[s._v("true")]),s._v("，会省略块级代码结尾的分号、省略 "),a("code",[s._v("new Foo()")]),s._v(" 中的 "),a("code",[s._v("()")]),s._v("、生成更短形式的字面量描述方式等。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("auxiliaryCommentBefore")])]),s._v(" "),a("p",[s._v("类型 "),a("code",[s._v("string")]),s._v("。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("auxiliaryCommentAfter")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("comments")])]),s._v(" "),a("p",[s._v("类型 "),a("code",[s._v("boolean")]),s._v("。默认 "),a("code",[s._v("true")]),s._v("。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("shouldPrintComment")])]),s._v(" "),a("p",[s._v("类型 "),a("code",[s._v("(value: string) => boolean")]),s._v("。")]),s._v(" "),a("p",[s._v("如果同时设置了 "),a("code",[s._v("minified")]),s._v("，那么其默认值是 "),a("code",[s._v("(val) => opts.comments || /@license|@preserve/.test(val)")]),s._v("。")]),s._v(" "),a("p",[s._v("如果没有设置 "),a("code",[s._v("minified")]),s._v("，那么其默认值是 "),a("code",[s._v("() => opts.comments")]),s._v("。")]),s._v(" "),a("p",[s._v("用于决定哪些注释可以在最终输出的转译结果中保留（通常注释是会被删除的）。")])])])]),s._v(" "),a("li",[a("p",[s._v("AMD / UMD / SystemJS module options")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("moduleIds")])]),s._v(" "),a("p",[s._v("类型 "),a("code",[s._v("boolean")]),s._v("。默认 "),a("code",[s._v("!!opts.moduleId")]),s._v("。")]),s._v(" "),a("p",[s._v("是否开启 "),a("code",[s._v("module ID")]),s._v(" 的转译。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("moduleId")])]),s._v(" "),a("p",[s._v("类型 "),a("code",[s._v("string")]),s._v("。")]),s._v(" "),a("p",[s._v("用于描述当前转译的 "),a("code",[s._v("module")]),s._v(" ID，这是硬编码的。不能与 "),a("code",[s._v("getModuleId")]),s._v(" 同时使用。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("getModuleId")])]),s._v(" "),a("p",[s._v("类型 "),a("code",[s._v("(name: string) => string")]),s._v("。")]),s._v(" "),a("p",[s._v("？？")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("moduleRoot")])]),s._v(" "),a("p",[s._v("类型 "),a("code",[s._v("string")]),s._v("。")]),s._v(" "),a("p",[s._v("为生成的 module 名字上添加根路径。")])])])]),s._v(" "),a("li",[a("p",[s._v("Options Concepts")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("MatchPattern")])]),s._v(" "),a("p",[s._v("类型 "),a("code",[s._v("string | RegExp | (filename: string | void, context: { caller: { name: string } | void, envName: string, dirname: string ) => boolean")]),s._v("。")])])])])]),s._v(" "),a("h3",{attrs:{id:"配置合并规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置合并规则"}},[s._v("#")]),s._v(" 配置合并规则")]),s._v(" "),a("p",[s._v("Babel配置的合并遵循以下方式:")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("Array#concat")])]),s._v(" "),a("p",[s._v("针对 "),a("code",[s._v("plugins/presets")]),s._v("，用 "),a("code",[s._v("Array#concat")]),s._v(" 合并，因为它们均为数组。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("Object.assign")])]),s._v(" "),a("p",[a("code",[s._v("plugins/presets")]),s._v(" 之外的配置，使用 "),a("code",[s._v("Object.assign")]),s._v(" 做覆盖式合并。")])])]),s._v(" "),a("p",[s._v("下面是官方文档的案例:")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" config "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("plugins")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"plugin-1a"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("loose")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"plugin-1b"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("presets")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"preset-1a"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("sourceType")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"script"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" newConfigItem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("plugins")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"plugin-1a"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("loose")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"plugin-2b"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("presets")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"preset-1a"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"preset-2a"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("sourceType")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"module"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("BabelConfigMerge")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" newConfigItem"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// returns")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("plugins")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"plugin-1a"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("loose")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"plugin-1b"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"plugin-1a"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("loose")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// concat 推入的配置")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"plugin-2b"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// concat 推入的配置")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("presets")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"preset-1a"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"preset-1a"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// concat 推入的配置")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"preset-2b"')]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// concat 推入的配置")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("sourceType")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"module"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// sourceType: "script" 值被新值覆盖')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br")])]),a("h3",{attrs:{id:"plugins-presets-配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#plugins-presets-配置"}},[s._v("#")]),s._v(" Plugins/Presets 配置")]),s._v(" "),a("p",[s._v("Babel 支持对 Plugins 和 Presets 多种形式的配置，可配置的方式有:")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("EntryTarget")])]),s._v(" "),a("li",[a("code",[s._v("[EntryTarget, EntryOptions]")])]),s._v(" "),a("li",[a("code",[s._v("[EntryTarget, EntryOptions, string]")])]),s._v(" "),a("li",[a("code",[s._v("ConfigItem")])])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("plugins")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// EntryTarget")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@babel/plugin-transform-classes'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// [EntryTarget, EntryOptions]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@babel/plugin-transform-arrow-functions'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// [EntryTarget, EntryOptions, string]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@babel/plugin-transform-for-of'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("loose")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"some-name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ConfigItem")]),s._v("\n    babel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("createConfigItem")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@babel/plugin-transform-spread"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("ul",[a("li",[a("p",[a("code",[s._v("EntryTarget: string | {} | Function")])]),s._v(" "),a("ul",[a("li",[a("code",[s._v("string")]),s._v(": 要求是 Babel plugin/preset 的路径、名字（如 "),a("code",[s._v("env / @babel/preset-env")]),s._v("，会经过格式化的）。")]),s._v(" "),a("li",[a("code",[s._v("{} | Function")]),s._v(": 要求是 Babel plugin/preset 对象或函数。")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("EntryOptions: undefined | {} | false")])]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("undefined")]),s._v(": 没有设置，内部会重置为空对象 "),a("code",[s._v("{}")]),s._v("。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("false")]),s._v(": 禁用该 plugin/preset，这个可用于提升转译速度等情况下，由开发者决定是否开启。")]),s._v(" "),a("p",[s._v("但是 "),a("code",[s._v("overrides")]),s._v(" 配置项的优先级高于它:")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("plugins")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'one'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'two'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'three'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("overrides")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("test")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./src"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("plugins")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'two'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("以上配置的效果是:")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("two")]),s._v(" 会参与对 "),a("code",[s._v("./src")]),s._v(" 路径下文件的转译，其他路径不参与")]),s._v(" "),a("li",[a("code",[s._v("two")]),s._v(" 的转译依然发生在 "),a("code",[s._v("one")]),s._v(" 和 "),a("code",[s._v("three")]),s._v(" 之间")])])])])]),s._v(" "),a("li",[a("p",[s._v("对 plugin/preset 名称的格式化")]),s._v(" "),a("p",[s._v("Babel 支持多种对 plugin/preset 名称的简写，当然要遵循一定的规则:")]),s._v(" "),a("ul",[a("li",[s._v("绝对路径")]),s._v(" "),a("li",[s._v("以 "),a("code",[s._v("./")]),s._v(" 开头的相对路径")]),s._v(" "),a("li",[s._v("以 "),a("code",[s._v("moudle:")]),s._v(" 开头的名称")]),s._v(" "),a("li",[s._v("以 "),a("code",[s._v("@babel")]),s._v(" 开头的名称内，会默认为添加 "),a("code",[s._v("plugin-")]),s._v(" 和 "),a("code",[s._v("preset-")]),s._v(" 前缀，如 "),a("code",[s._v("@babel/env")]),s._v(" 会被格式化为 "),a("code",[s._v("@babel/preset-env")])])]),s._v(" "),a("p",[s._v("| 输入 | 格式化结果 | 规则 |\n| "),a("code",[s._v('"/dir/plugin.js"')]),s._v(" | "),a("code",[s._v('"/dir/plugin.js"')]),s._v(" | 绝对路径不处理 |\n| "),a("code",[s._v('"./dir/plugin.js"')]),s._v(" | "),a("code",[s._v('"./dir/plugin.js"')]),s._v(" | 相对路径不处理 |\n| "),a("code",[s._v('"mod"')]),s._v(" | "),a("code",[s._v('"babel-plugin-mod"')]),s._v(" | 未声明命名空间 "),a("code",[s._v("@babel")]),s._v("，且没有前缀的，会新增 "),a("code",[s._v("babel-plugin")]),s._v(" 前缀 |\n| "),a("code",[s._v('"mod/plugin"')]),s._v(" | "),a("code",[s._v('"mod/plugin"')]),s._v(" | |\n| "),a("code",[s._v('"babel-plugin-mod"')]),s._v(" | "),a("code",[s._v('"babel-plugin-mod"')]),s._v(" | 有 "),a("code",[s._v("babel-plugin")]),s._v(" 前缀，不处理 |\n| "),a("code",[s._v('"@babel/mod"')]),s._v(" | "),a("code",[s._v('"@babel/plugin-mod"')]),s._v(" | 以 "),a("code",[s._v("@babel")]),s._v(" 命名空间开头，会添加 "),a("code",[s._v("plugin")]),s._v(" 前缀 |\n| "),a("code",[s._v('"@babel/plugin-mod"')]),s._v(" | "),a("code",[s._v('"@babel/plugin-mod"')]),s._v(" | 以 "),a("code",[s._v("@babel")]),s._v(" 命名空间开头，且有 "),a("code",[s._v("plugin")]),s._v(" 前缀，不处理 |\n| "),a("code",[s._v('"@babel/mod/plugin"')]),s._v(" | "),a("code",[s._v('"@babel/mod/plugin"')]),s._v(" | |\n| "),a("code",[s._v('"@scope"')]),s._v(" | "),a("code",[s._v('"@scope/babel-plugin"')]),s._v(" | 在 "),a("code",[s._v("@")]),s._v(" 开头的某个命名空间上，添加 "),a("code",[s._v("babel-plugin")]),s._v(" 前缀 |\n| "),a("code",[s._v('"@scope/babel-plugin"')]),s._v(" | "),a("code",[s._v('"@scope/babel-plugin"')]),s._v(" | |\n| "),a("code",[s._v('"@scope/mod"')]),s._v(" | "),a("code",[s._v('"@scope/babel-plugin-mod"')]),s._v(" | 在 "),a("code",[s._v("@")]),s._v(" 开头的某个命名空间上，添加 "),a("code",[s._v("babel-plugin")]),s._v(" 前缀 |\n| "),a("code",[s._v('"@scope/babel-plugin-mod"')]),s._v(" | "),a("code",[s._v('"@scope/babel-plugin-mod"')]),s._v(" | |\n| "),a("code",[s._v('"@scope/prefix-babel-plugin-mod"')]),s._v(" | "),a("code",[s._v('"@scope/prefix-babel-plugin-mod"')]),s._v(" | |\n| "),a("code",[s._v('"@scope/mod/plugin"')]),s._v(" | "),a("code",[s._v('"@scope/mod/plugin"')]),s._v(" | |\n| "),a("code",[s._v('"module:foo"')]),s._v(" | "),a("code",[s._v('"foo"')]),s._v(" | 以 "),a("code",[s._v("module:")]),s._v(" 开头，会移除 "),a("code",[s._v("module:")]),s._v(" |")])])]),s._v(" "),a("h2",{attrs:{id:"_4-babel-的项目管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-babel-的项目管理"}},[s._v("#")]),s._v(" 4 Babel 的项目管理")]),s._v(" "),a("h3",{attrs:{id:"_4-1-monorepo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-monorepo"}},[s._v("#")]),s._v(" 4.1 monorepo")]),s._v(" "),a("p",[s._v("如果一个大型项目由多个子工程组成，该如何管理呢？")]),s._v(" "),a("p",[s._v("通常来说，有以下方式:")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("monorepo")]),s._v(" "),a("p",[s._v("monorepo 指的是，该项目所有工程统一在一个仓库中，维护、发布等操作统一进行。")]),s._v(" "),a("p",[s._v("目前 Babel、React、Angular 等均采用该方式。")]),s._v(" "),a("p",[s._v("monorepo 的代码结构为:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("├── packages\n|   ├── pkg1\n|   |   ├── package.json\n|   ├── pkg2\n|   |   ├── package.json\n├── package.json\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("multirepo")]),s._v(" "),a("p",[s._v("和 monorepo 相反，该项目的每个子工程独立运行，每个子工程相互独立，自由选择构建工具，独立发布。")]),s._v(" "),a("p",[s._v("multirepo 的代码结构为:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("├── project1\n|   ├── package.json\n├── project2\n|   ├── package.json\n├── project3\n|   ├── package.json\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("submodules")]),s._v(" "),a("p",[s._v("submodules 是借助 git 的实现，在 "),a("code",[s._v(".gitmodules")]),s._v(" 中写明引用的仓库，在主仓库中只保留必要的索引。")])])]),s._v(" "),a("p",[s._v("在此主要关注 monorepo 和 multirepo。二者对比如下:")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("monorepo")]),s._v(" "),a("th",[s._v("multirepo")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("所有项目在同一个分支内开发")]),s._v(" "),a("td",[s._v("所有项目独立开发")])]),s._v(" "),a("tr",[a("td",[s._v("统一的 issue 管理")]),s._v(" "),a("td",[s._v("分散的 issue 管理")])]),s._v(" "),a("tr",[a("td",[s._v("统一的开发环境")]),s._v(" "),a("td",[s._v("分散的开发环境")])]),s._v(" "),a("tr",[a("td",[s._v("统一管理所有项目的版本")]),s._v(" "),a("td",[s._v("各项目难以统一版本")])]),s._v(" "),a("tr",[a("td",[s._v("项目所需存储空间大")]),s._v(" "),a("td",[s._v("项目分散，存储空间较小")])])])]),s._v(" "),a("p",[s._v("Babel 项目涉及的子工程很多，其采用了 monorepo 方式开发，并且沉淀出了自动化工具 lerna。")]),s._v(" "),a("h3",{attrs:{id:"_4-2-lerna"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-lerna"}},[s._v("#")]),s._v(" 4.2 lerna")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("两种模式")]),s._v(" "),a("p",[s._v("monorepo 有两种模式: "),a("code",[s._v("fixed")]),s._v(" 和 "),a("code",[s._v("independent")]),s._v("，默认为 "),a("code",[s._v("fixed")]),s._v(" 模式。")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("fixed")]),s._v(" 模式")]),s._v(" "),a("p",[s._v("该模式强制所有的包都使用在根目录 lerna.json 中指定的版本号。")]),s._v(" "),a("p",[s._v("lerna 默认使用该模式。")]),s._v(" "),a("p",[s._v('该模式下，每个 package 呈现"黑盒"状态，所有包统一迭代。')])]),s._v(" "),a("li",[a("p",[a("code",[s._v("independent")]),s._v("模式")]),s._v(" "),a("p",[s._v("该模式允许各个包独立指定自己的版本号。")]),s._v(" "),a("p",[s._v("可以使用 "),a("code",[s._v("lerna init --independent")]),s._v(" 声明该模式，也可以将 "),a("code",[s._v("lerna.json")]),s._v(" 的 "),a("code",[s._v("version")]),s._v(" 字段指定为 "),a("code",[s._v("independent")]),s._v("。")]),s._v(" "),a("p",[s._v("对于需要暴露内部细节、或者迭代频率显著不一致的包，比较适合该模式。")])])])]),s._v(" "),a("li",[a("p",[s._v("命令集")]),s._v(" "),a("p",[s._v("以下是 lerna 的部分命令及功能:")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("lerna init")]),s._v(": 初始化一个项目")]),s._v(" "),a("li",[a("code",[s._v("lerna create")]),s._v(": 创建一个子 package")]),s._v(" "),a("li",[a("code",[s._v("lerna import")]),s._v(": 将已有项目导入为子 package")]),s._v(" "),a("li",[a("code",[s._v("lerna list")]),s._v(": 列举当前项目所有子 package")]),s._v(" "),a("li",[a("code",[s._v("lerna add")]),s._v(": 添加公共依赖")]),s._v(" "),a("li",[a("code",[s._v("lerna clean")]),s._v(": 删除子 package 的 node_modules")]),s._v(" "),a("li",[a("code",[s._v("lerna bootstrap")]),s._v(": 安装依赖、创建子 package 间的 symlink")]),s._v(" "),a("li",[a("code",[s._v("lerna diff")]),s._v(": 类似 git diff")]),s._v(" "),a("li",[a("code",[s._v("lerna changed")]),s._v(": 列出子 package 的所有变更")]),s._v(" "),a("li",[a("code",[s._v("lerna exec")]),s._v(": 在所有子 package 下执行 shell")]),s._v(" "),a("li",[a("code",[s._v("lerna run")]),s._v(": 在所有子 package 下执行 npm scripts 命令")]),s._v(" "),a("li",[a("code",[s._v("lerna link")]),s._v(": 将彼此依赖的子 package 关联起来")]),s._v(" "),a("li",[a("code",[s._v("lerna publish")]),s._v(": 发布子 package")]),s._v(" "),a("li",[a("code",[s._v("lerna version")]),s._v(": 确认发布的版本号")])]),s._v(" "),a("p",[s._v("后面的章节对 lerna 有更详细的介绍。")])])]),s._v(" "),a("h2",{attrs:{id:"_5-标准化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-标准化"}},[s._v("#")]),s._v(" 5 标准化")]),s._v(" "),a("p",[s._v("Babel 生态涉及的一些标准化组织。无论是 JavaScript、HTML、DOM、URL 等领域，均需要统一的标准，才能在不同的运行环境下有统一的表现。Babel 转译也需要遵循这些标准，包括 ECMAScript、web 标准等。")]),s._v(" "),a("p",[s._v("// JavaScript 20年: https://cn.history.js.org/part-2.html")]),s._v(" "),a("p",[s._v("https://zhuanlan.zhihu.com/p/22557749")]),s._v(" "),a("h3",{attrs:{id:"_5-1-ecmascript"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-ecmascript"}},[s._v("#")]),s._v(" 5.1 ECMAScript")]),s._v(" "),a("h3",{attrs:{id:"javascript诞生"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#javascript诞生"}},[s._v("#")]),s._v(" JavaScript诞生")]),s._v(" "),a("p",[s._v("1995 年，JavaScript 的第一个版本发布。用时间线的方式描述 JavaScript 的诞生过程会更清晰:")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/5757051/155268504-5bf461c5-bb96-433d-b47b-9c78451f68d9.png",alt:"标准化/JavaScript诞生"}})]),s._v(" "),a("h3",{attrs:{id:"ecmascript发布"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ecmascript发布"}},[s._v("#")]),s._v(" ECMAScript发布")]),s._v(" "),a("p",[s._v("1996 年，微软模仿 JavaScript 实现了 JScript 并内置在 IE3.0，随后，Netscape 公司着手推动 JavaScript 标准化。")]),s._v(" "),a("p",[s._v("这里涉及几个组织:")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Ecma International")]),s._v(" "),a("p",[s._v("Ecma International 是一家国际性会员制度的信息和电信标准组织。1994年之前，名为欧洲计算机制造商协会（European Computer Manufacturers Association）。因为计算机的国际化，组织的标准牵涉到很多其他国家，因此组织决定改名表明其国际性。")]),s._v(" "),a("p",[s._v("Ecma International 的任务包括与有关组织合作开发通信技术和消费电子标准、鼓励准确的标准落实、和标准文件与相关技术报告的出版。")]),s._v(" "),a("p",[s._v("Ecma International 负责多个国际标准的制定:")]),s._v(" "),a("ul",[a("li",[s._v("CD-ROM 格式（之后被国际标准化组织批准为ISO 9660）")]),s._v(" "),a("li",[s._v("C# 语言规范")]),s._v(" "),a("li",[s._v("C++/CLI 语言规范")]),s._v(" "),a("li",[s._v("通用语言架构（CLI）")]),s._v(" "),a("li",[s._v("Eiffel 语言")]),s._v(" "),a("li",[s._v("电子产品环境化设计要素")]),s._v(" "),a("li",[s._v("Universal 3D 标准")]),s._v(" "),a("li",[s._v("OOXML")]),s._v(" "),a("li",[s._v("Dart 语言规范")]),s._v(" "),a("li",[s._v("ECMAScript 语言规范（以 JavaScript 为基础）ECMA-262")])]),s._v(" "),a("p",[s._v("其中就包括 JavaScript 标准语言规范 ECMAScript。")]),s._v(" "),a("p",[s._v("Ecma International 拥有 ECMAScript 的商标。")])]),s._v(" "),a("li",[a("p",[s._v("ECMA TC39")]),s._v(" "),a("p",[s._v("「TC39」全称「Technical Committee 39」译为「第 39 号技术委员会」，是 Ecma International 组织架构中的一部分。")]),s._v(" "),a("p",[s._v("TC39 负责迭代和发展 ECMAScript，它的成员由各个主流浏览器厂商的代表组成，通常每年召开约 6 次会议来讨论未决提案的进展情况，会议的每一项决议必须得到大部分人的赞同，并且没有人强烈反对才可以通过。")]),s._v(" "),a("p",[s._v("TC39 负责:")]),s._v(" "),a("ul",[a("li",[s._v("维护和更新 ECMAScript 语言标准")]),s._v(" "),a("li",[s._v("识别、开发、维护 ECMAScript 的扩展功能库")]),s._v(" "),a("li",[s._v("开发测试套件")]),s._v(" "),a("li",[s._v("为 ISO/IEC JTC 1 提供标准")]),s._v(" "),a("li",[s._v("评估和考虑新添加的标准")])])]),s._v(" "),a("li",[a("p",[s._v("ISO")]),s._v(" "),a("p",[s._v("国际标准化组织（英语: International Organization for Standardization，简称: ISO）成立于 1947 年 2 月 23 日，制定全世界工商业国际标准的国际标准建立机构。")]),s._v(" "),a("p",[s._v("ISO 总部设于瑞士日内瓦，现有 164 个会员国。该组织定义为非政府组织，官方语言是英语、法语和俄语。参加者包括各会员国的国家标准机构和主要公司。")]),s._v(" "),a("p",[s._v('ISO 的国际标准以数字表示，例如: "ISO 11180:1993" 的 "11180" 是标准号码，而 "1993" 是出版年份。')]),s._v(" "),a("p",[s._v("ISO/IEC JTC 1 是国际标准化组织和国际电工委员会联合技术委员会。其目的是开发、维护和促进信息技术以及信息和通信技术领域的标准。JTC 1 负责了许多关键的 IT 标准，从 MPEG 视频格式到 C++ 編程語言。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/5757051/155268629-aa87a838-6e2d-4fd1-925c-aac33f0cb85a.png",alt:"标准化/ECMA-ISO"}})])]),s._v(" "),a("li",[a("p",[s._v("ECMAScript 发展过程中的关键节点")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/5757051/155268798-1e6d3585-fe7a-42ab-b770-aa0cd1653a21.png",alt:"标准化/JavaScript标准化"}})])])]),s._v(" "),a("h3",{attrs:{id:"ecmascript-各版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ecmascript-各版本"}},[s._v("#")]),s._v(" ECMAScript 各版本")]),s._v(" "),a("p",[s._v("ECMAScript 经历了多个版本，每个版本有自己的特点，简单列举如下:")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/5757051/155269036-57f82a7e-69f4-4ff1-bdbc-653e39efef47.jpg",alt:"标准化/ECMA版本"}})]),s._v(" "),a("h3",{attrs:{id:"ecmascript-迭代过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ecmascript-迭代过程"}},[s._v("#")]),s._v(" ECMAScript 迭代过程")]),s._v(" "),a("p",[s._v("https://erasermeng.github.io/2017/07/12/ECMAScript%E6%B5%81%E7%A8%8B%E8%A7%84%E8%8C%83%E7%AE%80%E4%BB%8B/")]),s._v(" "),a("p",[s._v("一个 ECMAScript 标准的制作过程，包含了 Stage 0 到 Stage 4 共 5 个阶段，每个阶段提交至下一阶段都需要 TC39 审批通过。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/5757051/155269169-c455f590-7486-4fc8-a19c-ed5668b84f80.jpg",alt:"标准化/ECMA迭代流程"}})]),s._v(" "),a("p",[s._v("特性进入 Stage-4 后，才有可能被加入标准中，还需要 ECMA General Assembly 表决通过才能进入下一次的 ECMAScript 标准中。")]),s._v(" "),a("h3",{attrs:{id:"_5-2-如何阅读-ecmascript"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-如何阅读-ecmascript"}},[s._v("#")]),s._v(" 5.2 如何阅读 ECMAScript")]),s._v(" "),a("h3",{attrs:{id:"ecmascript-文档结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ecmascript-文档结构"}},[s._v("#")]),s._v(" ECMAScript 文档结构")]),s._v(" "),a("p",[s._v("https://timothygu.me/es-howto/")]),s._v(" "),a("p",[s._v("http://www.ruanyifeng.com/blog/2015/11/ecmascript-specification.html")]),s._v(" "),a("p",[s._v("ECMAScript 的规格，可以在 ECMA 国际标准组织的官方网站免费下载和在线阅读。ECMAScript 不同版本的规格有独立的网址，网址格式为: www.ecma-international.org/ecma-262/{version}/。比如 ECMAScript 6.0 版本的网址为 "),a("code",[s._v("www.ecma-international.org/ecma-262/6.0/")]),s._v("。截止本书截稿时，官方网站支持的版本有: "),a("code",[s._v("6.0/7.0/8.0/9.0/10.0/11.0")]),s._v("。")]),s._v(" "),a("p",[a("code",[s._v("ECMAScript 6.0")]),s._v("、"),a("code",[s._v("ECMAScript 7.0")]),s._v(" 有 26 章，之后的版本有 27 章，虽然章节数量不同，规格章节的分布是保持一定规律的，以 "),a("code",[s._v("ECMAScript 11.0")]),s._v(" 版本为例:")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Introduction: 介绍部分")]),s._v(" "),a("p",[s._v("该章节简要描述了: JavaScript 和 ECMAScript 的发展历史、不同 ECMAScript 规格的主要更新内容。")])]),s._v(" "),a("li",[a("p",[s._v("第 1 章到第 3 章: 描述了规格文件本身，而非语言")]),s._v(" "),a("p",[s._v("第 1 章用一句话描述了该规格的描述范围。")]),s._v(" "),a("p",[s._v('第 2 章描述了基于规格的"实现"的一致性要求:')]),s._v(" "),a("ul",[a("li",[s._v('"实现"必须支持规格中描述的所有类型、值、对象、属性、函数以及程序的语法和语义')]),s._v(" "),a("li",[s._v('"实现"必须按照 Unicode 标准和 ISO/IEC 10646 的最新版本处理文本输入')]),s._v(" "),a("li",[s._v('"实现"如果提供了应用程序编程接口（API），那么该 API 需要适应不同的人文语言和国家差异，且必须实现最新版本的 ECMA-402 所定义的与本规范相兼容的接口')]),s._v(" "),a("li",[s._v('"实现"可以支持该规格中没有提及的类型、值、对象、属性、函数、正则表达式语法以及其他编程写法')]),s._v(" "),a("li",[s._v('"实现"不能实现该规格中禁止的写法')])]),s._v(" "),a("p",[s._v("第 3 章描述了该规格的一些参考资料:")]),s._v(" "),a("ul",[a("li",[s._v("ISO/IEC 10646")]),s._v(" "),a("li",[s._v("ECMA-402")]),s._v(" "),a("li",[s._v("EMCA-404 JSON 数据交换格式规范")])])]),s._v(" "),a("li",[a("p",[s._v("第 4 章: 对这门语言总体设计的描述。")])]),s._v(" "),a("li",[a("p",[s._v("第 5 章到第 8 章: 语言宏观层面的描述。")]),s._v(" "),a("p",[s._v("第 5 章是规格的名词解释和写法的介绍。")]),s._v(" "),a("p",[s._v("第 6 章介绍数据类型。")]),s._v(" "),a("p",[s._v("第 7 章介绍语言内部用到的抽象操作。")]),s._v(" "),a("p",[s._v("第 8 章介绍代码如何运行。")])]),s._v(" "),a("li",[a("p",[s._v("第 9 章到第 27 章: 介绍具体的语法。")])])]),s._v(" "),a("p",[s._v("一般而言，除非写编译器，开发者无需阅读 ECMAScript 的规格，规格的内容非常多，如无必要也无需通读。只是在遇到一些奇怪的问题时，阅读官方规格，是最稳妥的办法。")]),s._v(" "),a("h3",{attrs:{id:"通过阅读规格解决一些问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过阅读规格解决一些问题"}},[s._v("#")]),s._v(" 通过阅读规格解决一些问题")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("识别关键词和保留字，并高亮")]),s._v(" "),a("p",[s._v("Babel 工具集中的 babel-highlight，可以实现在终端对代码块中的目标字符单元显示不同的颜色。这里需要识别不同字符单元的类型，如关键字、保留字、标识符、数字、字符串等。")]),s._v(" "),a("p",[s._v("标识符、数字、字符串都很好理解和识别，但哪些字符应该被识别为关键字、保留字，而不是标识符呢？")]),s._v(" "),a("p",[s._v("此时可以阅读 ECMAScript 规格了，ECMAScript 11.0 规格的 11.6.2 节介绍了关键词和保留字列表。")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("关键词（keywords）")]),s._v(" "),a("p",[s._v("关键词首先是标识符，同时有语义，包括 "),a("code",[s._v("if、while、async、await...")]),s._v("，个别关键词是可以用作变量名的。")])]),s._v(" "),a("li",[a("p",[s._v("保留字（reserved word）")]),s._v(" "),a("p",[s._v("保留字首先是标识符，但不能用作变量名。")]),s._v(" "),a("p",[s._v("部分关键词是保留字，但部分不是: "),a("code",[s._v("if、while")]),s._v(" 是保留字；"),a("code",[s._v("await")]),s._v(" 只有在 "),a("code",[s._v("async")]),s._v(" 方法和模块中才是保留字；"),a("code",[s._v("async")]),s._v(" 不是保留字，它可以作为普通的变量名使用。")])]),s._v(" "),a("li",[a("p",[s._v("保留字列表")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("await")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("case")]),s._v(" catch "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("continue")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("debugger")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delete")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("enum")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("false")]),s._v(" finally "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("instanceof")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" returns uper "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("switch")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("typeof")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("yield")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])]),s._v(" "),a("p",[s._v("读完上述规格，也就知道哪些字符单元是需要识别为保留字与关键词，并高亮的了。")])]),s._v(" "),a("li",[a("p",[s._v("识别全局对象，并高亮")]),s._v(" "),a("p",[s._v("继续使用 babel-highlight 实现代码块中的全局对象高亮，那么，我们需要知道哪些是规格中描述的全局变量。")]),s._v(" "),a("p",[s._v("规格的 18 章介绍了全局对象，通过该章的描述，可以知道:")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("全局属性")]),s._v(" "),a("p",[s._v("全局属性有: "),a("code",[s._v("globalThis")]),s._v("、"),a("code",[s._v("Infinity")]),s._v("、"),a("code",[s._v("NaN")]),s._v("、"),a("code",[s._v("undefined")]),s._v("。")])]),s._v(" "),a("li",[a("p",[s._v("全局方法")]),s._v(" "),a("p",[s._v("全局方法有: "),a("code",[s._v("eval(x)")]),s._v("、"),a("code",[s._v("isFinite")]),s._v("、"),a("code",[s._v("isNaN")]),s._v("、"),a("code",[s._v("parseFloat")]),s._v("、"),a("code",[s._v("parseInt")]),s._v("、"),a("code",[s._v("decodeURIComponent")]),s._v("、"),a("code",[s._v("encodeURIComponent")]),s._v(" 等。")])]),s._v(" "),a("li",[a("p",[s._v("全局构造函数")]),s._v(" "),a("p",[s._v("全局的构造函数有: "),a("code",[s._v("Array")]),s._v("、"),a("code",[s._v("ArrayBuffer")]),s._v("、"),a("code",[s._v("BigInt")]),s._v("、"),a("code",[s._v("BigInt64Array")]),s._v("、"),a("code",[s._v("BigUnit64Array")]),s._v("、"),a("code",[s._v("Boolean")]),s._v("、"),a("code",[s._v("DataView")]),s._v("、"),a("code",[s._v("Date")]),s._v("、"),a("code",[s._v("Error")]),s._v("、"),a("code",[s._v("EvalError")]),s._v("、"),a("code",[s._v("Float32Array")]),s._v("、"),a("code",[s._v("Float64Array")]),s._v("、"),a("code",[s._v("Function")]),s._v("、"),a("code",[s._v("Int8Array")]),s._v("、"),a("code",[s._v("Int16Array")]),s._v("、"),a("code",[s._v("Int32Array")]),s._v("、"),a("code",[s._v("Map")]),s._v("、"),a("code",[s._v("Number")]),s._v("、"),a("code",[s._v("Object")]),s._v("、"),a("code",[s._v("Promise")]),s._v("、"),a("code",[s._v("Proxy")]),s._v("、"),a("code",[s._v("RangeError")]),s._v("、"),a("code",[s._v("ReferenceError")]),s._v("、"),a("code",[s._v("RegExp")]),s._v("、"),a("code",[s._v("Set")]),s._v("、"),a("code",[s._v("SharedArrayBuffer")]),s._v("、"),a("code",[s._v("String")]),s._v("、"),a("code",[s._v("Symbol")]),s._v("、"),a("code",[s._v("SyntaxError")]),s._v("、"),a("code",[s._v("TypeError")]),s._v("、"),a("code",[s._v("Uint8Array")]),s._v("、"),a("code",[s._v("Uint8ClampedArray")]),s._v("、"),a("code",[s._v("Uint16Array")]),s._v("、"),a("code",[s._v("Uint32Array")]),s._v("、"),a("code",[s._v("URIError")]),s._v("、"),a("code",[s._v("WeakMap")]),s._v("、"),a("code",[s._v("WeakSet")]),s._v("。")])]),s._v(" "),a("li",[a("p",[s._v("其他的全局属性")]),s._v(" "),a("p",[a("code",[s._v("Atomics")]),s._v("、"),a("code",[s._v("JSON")]),s._v("、"),a("code",[s._v("Math")]),s._v("、"),a("code",[s._v("Reflect")]),s._v("。")])])]),s._v(" "),a("p",[s._v("很显然，当字符单元的名称是上述名称中的一员时，我们可以对其进行高亮处理了（若上下文中无重新定义的同名变量）。")])]),s._v(" "),a("li",[a("p",[s._v("自定义 Error")]),s._v(" "),a("p",[s._v("在介绍 Babel 工具集中的 babel-loader 时，babel-loader 自身维护了私有的 LoaderError 对象，该对象继承自原生 Error 类，并且订制了部分实例属性。代码如下:")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LoaderError")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Error")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("constructor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("err")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" codeFrame"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" hideStack "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("format")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"BabelLoaderError"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("message "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),s._v("name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v(": ")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),s._v("message"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\\n\\n")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),s._v("codeFrame"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\\n")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hideStack "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hideStack"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        Error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("captureStackTrace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("constructor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("可以看到，babel-loader 自定义了错误实例的 "),a("code",[s._v("name")]),s._v("、"),a("code",[s._v("message")]),s._v("、"),a("code",[s._v("hideStack")]),s._v(" 属性，那么，问题是，原生的 "),a("code",[s._v("Error")]),s._v(" 类有哪些属性和方法，哪些是开发者可以自定义的呢？")]),s._v(" "),a("p",[s._v("规格的 19.5 章节，详细介绍了 "),a("code",[s._v("Error")]),s._v(" 的各类规范:")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("Error")]),s._v(" 作为函数被调用时（"),a("code",[s._v("Error(...)")]),s._v("），表现和 "),a("code",[s._v("new Error(...)")]),s._v(" 一致，均会创建并返回 "),a("code",[s._v("Error")]),s._v(" 的新实例")]),s._v(" "),a("li",[a("code",[s._v("Error")]),s._v(" 可以被继承，比如通过 "),a("code",[s._v("extends")]),s._v(" 的方式，子类必须提供 "),a("code",[s._v("constructor")]),s._v(" 方法，且该方法内必须提供 "),a("code",[s._v("super()")]),s._v(" 调用")]),s._v(" "),a("li",[a("code",[s._v("Error")]),s._v(" 构造函数必须有 "),a("code",[s._v("prototype")]),s._v(" 属性")]),s._v(" "),a("li",[a("code",[s._v("Error.prototype")]),s._v(" 属性需有以下属性\n"),a("ul",[a("li",[a("code",[s._v("Error.prototype.constructor")]),s._v(": 指向构造函数")]),s._v(" "),a("li",[a("code",[s._v("Error.prototype.message")]),s._v(": 描述错误信息，默认是空字符串")]),s._v(" "),a("li",[a("code",[s._v("Error.prototype.name")]),s._v(": 描述错误名称，默认值是 "),a("code",[s._v("Error")])]),s._v(" "),a("li",[a("code",[s._v("Error.prototype.toString")]),s._v(":")])])])]),s._v(" "),a("p",[s._v("从 "),a("code",[s._v("LoaderError")]),s._v(" 的源码可以看到，"),a("code",[s._v("LoaderError")]),s._v(" 做了以下几件事情:")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("LoaderError")]),s._v(" 继承自 "),a("code",[s._v("Error")])]),s._v(" "),a("li",[s._v("实例自定义了 "),a("code",[s._v("name")]),s._v("、"),a("code",[s._v("message")]),s._v(" 属性，明确 babel-loader 的信息")]),s._v(" "),a("li",[s._v("实例自定义的 "),a("code",[s._v("hideStack")]),s._v(" 属性是非标准属性，用于 babel-loader 内部")])])])]),s._v(" "),a("h3",{attrs:{id:"_5-3-web标准"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-web标准"}},[s._v("#")]),s._v(" 5.3 web标准")]),s._v(" "),a("p",[s._v("是在解决 API Polyfil 的时候，Babel 配合使用的 core-js 除了提供 ECMAScript 标准下的 JavaScript API 实现，也提供了 DOM/URL 等实现。而 DOM/URL 所属的 web 标准，由 W3C/WHATWG 制定。")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("标准化组织")]),s._v(" "),a("th",[s._v("介绍")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("W3C")]),s._v(" "),a("td",[s._v("W3C(World Wide Web Consortium) 致力于实现所有的用户都能够对 web 加以利用（不论其文化教育背景、能力、财力以及其身体残疾）。"),a("br"),s._v("W3C 包含了众多标准，包括 HTML/CSS/DOM/WebAssembly/WebDriver/IndexedDB 等等。")])]),s._v(" "),a("tr",[a("td",[s._v("WHATWG")]),s._v(" "),a("td",[s._v("WHATWG(Web Hypertext Application Technology Working Group) 是浏览器厂商（包括苹果、谷歌、微软、Mozilla）于 2004 年组成的行业组织。"),a("br"),s._v("专注于浏览器领域的标准制定、测试等工作，如 HTML/DOM/streams/fetch/url/encoding 等标准的起草和发布。")])])])]),s._v(" "),a("p",[s._v("经过多年发展，WHATWG 和 W3C 目前是合作关系，其中，WHATWG 维护 HTML 和 DOM 标准，W3C 使用 WHATWG 存储库中的 HTML 和 DOM 标准描述，W3C 在 HTML 部分的工作集中在 XHTML/XML 上。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://user-images.githubusercontent.com/5757051/155269291-6a41c972-b3e0-4759-8b8a-f218e7097324.jpg",alt:"标准化/web标准"}})]),s._v(" "),a("h2",{attrs:{id:"_6-总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-总结"}},[s._v("#")]),s._v(" 6 总结")]),s._v(" "),a("p",[s._v("本章从整体层面介绍了 Babel 的转译过程及其生态中各个模块的作用。")]),s._v(" "),a("p",[s._v("其中涉及的部分知识点，后续章节有详细解析，读者可以根据自身需要查看相应内容。")])])}),[],!1,null,null,null);t.default=e.exports}}]);