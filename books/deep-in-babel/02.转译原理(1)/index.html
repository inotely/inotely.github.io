<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>《深入理解 Babel》 · 刘远洋</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="manifest" href="/books/deep-in-babel/manifest.webmanifest" crossorigin="use-credentials">
    <meta name="description" content="Deep In Babel">
    <meta property="og:url" content="/books/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86(1)/">
    <meta property="og:site_name" content="《深入理解 Babel》 · 刘远洋">
    <meta property="og:description" content="Babel 的核心之一就是其转译模块，包括 babel-core、babel-parser 等。Babel 的转译过程分为&quot;解析/转换/生成&quot;三步。 转译环节 操作 功能 --- --- --- 解析 词法分析 生成标记数组（tokens） 语法分析 根据 tokens 数组生成源码的树形结构，即抽象语法树 语义分析 向抽象语法树补充源码的语义信息，如作用域">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="《深入理解 Babel》 · 刘远洋">
    <meta name="theme-color" content="#46bd87">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    
    <link rel="preload" href="/books/deep-in-babel/assets/css/0.styles.33c62197.css" as="style"><link rel="preload" href="/books/deep-in-babel/assets/js/app.8134f3c5.js" as="script"><link rel="preload" href="/books/deep-in-babel/assets/js/vendors~layout-Layout.df4812ba.js" as="script"><link rel="preload" href="/books/deep-in-babel/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.ebefd1c7.js" as="script"><link rel="preload" href="/books/deep-in-babel/assets/js/page--340e5eca.a6e344ee.js" as="script"><link rel="preload" href="/books/deep-in-babel/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.33005620.js" as="script"><link rel="prefetch" href="/books/deep-in-babel/assets/js/26.db6b8dab.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/layout-Blog.b0c6dcb7.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/layout-Layout.54347a9b.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/layout-NotFound.846facba.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/layout-Slide.88fa1023.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/page--0246c2a4.71fd7525.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/page--4fdeacc4.54b8184b.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/page--6723acaa.fdeb7f4d.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/page--67cf3cc0.1c63897e.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/page--6b62a710.3bb4dae2.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/page--8fcba694.86160d67.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/page--9bf3e428.cd5ab0a9.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/page--aec4dcea.791e332f.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/page--c3b426fa.a5024669.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/page--d99aed8e.d8d65af8.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/page-623提案特性转换插件.f47d70c8.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/page-82core-js.bd521a66.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/page-83regenerator-runtime.8faf0289.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/page-前言.e6d514e0.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/page-语法分析和语义分析.95f2ea17.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/vendors~photo-swipe.ed4bf049.js">
    <link rel="stylesheet" href="/books/deep-in-babel/assets/css/0.styles.33c62197.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/books/deep-in-babel/" class="home-link router-link-active"><!----> <!----> <span class="site-name can-hide">《深入理解 Babel》 · 刘远洋</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">Theme Color:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://notelyio.com/home" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  Notely · 撰写工具
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/hoperyy" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  Follow 作者
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/hoperyy/deep-in-babel" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  Star
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div></nav> <!----> <!----> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!----> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="https://notelyio.com/home" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  Notely · 撰写工具
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/hoperyy" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  Follow 作者
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/hoperyy/deep-in-babel" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  Star
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><a href="/books/deep-in-babel/00.%E5%89%8D%E8%A8%80/" class="sidebar-link">第 0 章 - 前言</a></li><li><a href="/books/deep-in-babel/01.%E6%A6%82%E8%BF%B0/" class="sidebar-link">第 1 章 - 概述</a></li><li><a href="/books/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86(1)/" aria-current="page" class="active sidebar-link">第 2 章 - 转译原理 (1)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/books/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86(1)/#the-super-tiny-compiler" class="sidebar-link">the-super-tiny-compiler</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/books/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86(1)/#解析目标" class="sidebar-link heading3">解析目标</a></li><li class="sidebar-sub-header"><a href="/books/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86(1)/#解析过程" class="sidebar-link heading3">解析过程</a></li></ul></li><li class="sidebar-sub-header"><a href="/books/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86(1)/#词法分析" class="sidebar-link">词法分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/books/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86(1)/#相关概念" class="sidebar-link heading3">相关概念</a></li><li class="sidebar-sub-header"><a href="/books/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86(1)/#词法分析过程" class="sidebar-link heading3">词法分析过程</a></li><li class="sidebar-sub-header"><a href="/books/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86(1)/#babel-的词法分析" class="sidebar-link heading3">Babel 的词法分析</a></li></ul></li></ul></li><li><a href="/books/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86(2)/" class="sidebar-link">第 2 章 - 转译原理 (2)</a></li><li><a href="/books/deep-in-babel/03.Babel%E8%8A%82%E7%82%B9/" class="sidebar-link">第 3 章 - Babel 节点</a></li><li><a href="/books/deep-in-babel/04.Babel%E5%B7%A5%E5%85%B7%E9%9B%86/" class="sidebar-link">第 4 章 - Babel 工具集</a></li><li><a href="/books/deep-in-babel/05.Babel%E6%8F%92%E4%BB%B6%E7%BC%96%E5%86%99/" class="sidebar-link">第 5 章 - Babel 插件编写</a></li><li><a href="/books/deep-in-babel/06.Babel%E5%86%85%E7%BD%AEPlugin(1)/" class="sidebar-link">第 6 章 - Babel 内置 Plugin (1)</a></li><li><a href="/books/deep-in-babel/06.Babel%E5%86%85%E7%BD%AEPlugin(2)/" class="sidebar-link">第 6 章 - Babel 内置 Plugin (2)</a></li><li><a href="/books/deep-in-babel/07.Babel%E5%86%85%E7%BD%AEPreset/" class="sidebar-link">第 7 章 - Babel 内置 Preset</a></li><li><a href="/books/deep-in-babel/08.runtime(1)/" class="sidebar-link">第 8 章 - runtime (1)</a></li><li><a href="/books/deep-in-babel/08.runtime(2)/" class="sidebar-link">第 8 章 - runtime (2)</a></li><li><a href="/books/deep-in-babel/08.runtime(3)/" class="sidebar-link">第 8 章 - runtime (3)</a></li><li><a href="/books/deep-in-babel/09.Babel%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/" class="sidebar-link">第 9 章 - Babel 项目管理</a></li><li><a href="/books/deep-in-babel/10.%E8%BD%AC%E8%AF%91%E5%99%A8%E5%AF%B9%E6%AF%94/" class="sidebar-link">第 10 章 - 转译器对比</a></li></ul> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb disable"><!----></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline"></span></h1> <div class="page-info"><!----> <!----><!----><span aria-label="Writing Date📅" data-balloon-pos="down" class="time-info"><svg viewBox="0 0 1030 1024" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H180.6A134.314 134.314 0 0 0 46.66 277.595v535.756A134.314 134.314 0 0 0 180.6 947.289h669.74a134.36 134.36 0 0 0 133.94-133.938V277.595a134.314 134.314 0 0 0-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 0 1-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 0 1-33.472 33.473z" fill="currentColor"></path></svg> <span property="datePublished">2022-6-2</span></span><!----><!----><span aria-label="Reading Time⌛" data-balloon-pos="down" class="reading-time-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon timer-icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z" fill="currentColor"></path></svg> <span>About 33 min</span> <meta property="timeRequired" content="PT33M"></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/books/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86(1)/#the-super-tiny-compiler" class="anchor-link heading2"><div>the-super-tiny-compiler</div></a></li><li class="anchor"><a href="/books/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86(1)/#解析目标" class="anchor-link heading3"><div>解析目标</div></a></li><li class="anchor"><a href="/books/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86(1)/#解析过程" class="anchor-link heading3"><div>解析过程</div></a></li><li class="anchor"><a href="/books/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86(1)/#词法分析" class="anchor-link heading2"><div>词法分析</div></a></li><li class="anchor"><a href="/books/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86(1)/#相关概念" class="anchor-link heading3"><div>相关概念</div></a></li><li class="anchor"><a href="/books/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86(1)/#词法分析过程" class="anchor-link heading3"><div>词法分析过程</div></a></li><li class="anchor"><a href="/books/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86(1)/#babel-的词法分析" class="anchor-link heading3"><div>Babel 的词法分析</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><p>Babel 的核心之一就是其转译模块，包括 <code>babel-core</code>、<code>babel-parser</code> 等。Babel 的转译过程分为&quot;解析/转换/生成&quot;三步。</p> <table><thead><tr><th>转译环节</th> <th>操作</th> <th>功能</th></tr></thead> <tbody><tr><td>解析</td> <td>词法分析</td> <td>生成标记数组（tokens）</td></tr> <tr><td></td> <td>语法分析</td> <td>根据 tokens 数组生成源码的树形结构，即抽象语法树</td></tr> <tr><td></td> <td>语义分析</td> <td>向抽象语法树补充源码的语义信息，如作用域、重复定义检查等</td></tr> <tr><td>转换</td> <td>借助 Babel 插件对抽象语法树进行转换</td> <td>生成目标抽象语法树</td></tr> <tr><td>生成</td> <td>根据抽象语法树对象，重新生成代码字符串</td> <td>声明目标代码字符串</td></tr></tbody></table> <p>本章主要分为两部分讲解 Babel 相关的转译原理，分别是&quot;理论知识&quot;和&quot;Babel的转译过程&quot;。阅读顺序建议先了解转译原理的理论知识。</p> <blockquote><p>《编译原理》本身是大学的计算机相关课程之一，Babel 用到的理论也是基于其中的部分原理，可惜笔者学过的知识早就还给老师了。</p></blockquote> <p>为了帮助开发者了解 Babel 的基本原理，Babel 官网推荐了一个项目: <code>the-super-tiny-compiler</code>，除去注释代码仅 200 行，可读性很好，建议阅读，作为了解 Babel 原理的前菜。</p> <h2 id="the-super-tiny-compiler"><a href="#the-super-tiny-compiler" class="header-anchor">#</a> <code>the-super-tiny-compiler</code></h2> <h3 id="解析目标"><a href="#解析目标" class="header-anchor">#</a> 解析目标</h3> <p><code>the-super-tiny-compiler</code> 项目解析的目标是将 lisp 风格的函数调用转换为 C 风格。</p> <p>假设有两个函数，<code>add</code> 和 <code>subtract</code>，那么它们的写法将会是下面这样:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>                LISP                      C

2 + 2          (add 2 2)                 add(2, 2)
4 - 2          (subtract 4 2)            subtract(4, 2)
2 + (4 - 2)    (add 2 (subtract 4 2))    add(2, subtract(4, 2))
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="解析过程"><a href="#解析过程" class="header-anchor">#</a> 解析过程</h3> <h4 id="词法单元"><a href="#词法单元" class="header-anchor">#</a> 词法单元</h4> <p><code>the-super-tiny-compiler</code> 定义了如下词法单元:</p> <table><thead><tr><th>语素</th> <th>标记类型</th></tr></thead> <tbody><tr><td><code>(</code></td> <td><code>paren</code></td></tr> <tr><td><code>)</code></td> <td><code>paren</code></td></tr> <tr><td><code>/[0-9]/</code></td> <td><code>number</code></td></tr> <tr><td><code>/[a-z]/i</code></td> <td><code>name</code></td></tr></tbody></table> <p>其中，简略起见，空格没有作为输出的 <code>tokens</code> 中的一员；<code>name</code> 也仅限于字母组成，没有覆盖 <code>add3</code> 这种含字母和数字的情况。</p> <h4 id="代码逻辑"><a href="#代码逻辑" class="header-anchor">#</a> 代码逻辑</h4> <p><code>the-super-tiny-compiler</code> 定义了方法 <code>tokenizer(input: string): Array&lt;{ type: String; value: String }&gt;</code> 作为词法分析器。</p> <p>这个方法不到 100 行，整体运行流程如下:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">tokenizer</span><span class="token punctuation">(</span><span class="token parameter">input</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// `current` 字符串扫描过程中指向当前位置的指针</span>
    <span class="token keyword">var</span> current <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">// `tokens` 数组，也是要返回的对象，数组项为各个 token 单元</span>
    <span class="token keyword">var</span> tokens <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// 首先创建一个 `while` 循环， `current` 变量会在循环中自增</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>current <span class="token operator">&lt;</span> input<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// 我们在这里储存了 `input` 中 `current` 位置的字符</span>
        <span class="token keyword">var</span> char <span class="token operator">=</span> input<span class="token punctuation">[</span>current<span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token comment">// token 类型: `paren`，左圆括号</span>
        <span class="token comment">// 检查一下是不是一个左圆括号</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>char <span class="token operator">===</span> <span class="token string">'('</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 如果是，那么我们 push 一个 type 为 `paren`，value 为左圆括号的对象。</span>
            tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'paren'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'('</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 发现了一个 token，自增 `current`</span>
            current<span class="token operator">++</span><span class="token punctuation">;</span>

            <span class="token comment">// 结束本次循环，进入下一次循环</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// token 类型: `paren`，右圆括号</span>
        <span class="token comment">// 然后我们检查是不是一个右圆括号。这里做的时候和之前一样: 检查右圆括号、加入新的 token、</span>
        <span class="token comment">// 自增 `current`，然后进入下一次循环。</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>char <span class="token operator">===</span> <span class="token string">')'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'paren'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">')'</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 发现了一个 token，自增 `current`</span>
            current<span class="token operator">++</span><span class="token punctuation">;</span>

            <span class="token comment">// 结束本次循环，进入下一次循环</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 过滤空格，空格对 token 而言是无意义的</span>
        <span class="token keyword">var</span> <span class="token constant">WHITESPACE</span> <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">WHITESPACE</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 自增 `current`</span>
            current<span class="token operator">++</span><span class="token punctuation">;</span>

            <span class="token comment">// 结束本次循环，进入下一次循环</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// token 类型: `number`，数字</span>
        <span class="token comment">// 下一个 token 的类型是数字。它和之前的一个字符的 token 不同，因为数字可以由多个数字字符组成，</span>
        <span class="token comment">// 但是只能把它们识别为一个 token。</span>
        <span class="token comment">// </span>
        <span class="token comment">//   (add 123 456)</span>
        <span class="token comment">//        ^^^ ^^^</span>
        <span class="token comment">//        这里只有两个 token</span>
        <span class="token comment">//        </span>
        <span class="token comment">// 当遇到一个数字字符时，会进入判断逻辑</span>
        <span class="token keyword">var</span> <span class="token constant">NUMBERS</span> <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[0-9]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NUMBERS</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 创建一个 `value` 字符串，记录数字字符串</span>
            <span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>

            <span class="token comment">// 进入子循环，直到遇到的字符不是数字字符为止，</span>
            <span class="token comment">// 将循环途中遇到的每个数字拼接到 `value` 字符串中，并且自增 `current`</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token constant">NUMBERS</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                value <span class="token operator">+=</span> char<span class="token punctuation">;</span>
                char <span class="token operator">=</span> input<span class="token punctuation">[</span><span class="token operator">++</span>current<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 然后将类型为 `number` 的 token 放入 `tokens` 数组中</span>
            tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'number'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">value</span><span class="token operator">:</span> value
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 结束本次循环，进入下一次循环</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// token 类型: `name`，函数名</span>
        <span class="token comment">// 最后一种类型的 token 是 `name`。它由一系列的字母组成，在 lisp 语法中代表函数。</span>
        <span class="token comment">//</span>
        <span class="token comment">//   (add 2 4)</span>
        <span class="token comment">//    ^^^</span>
        <span class="token comment">//    Name token</span>
        <span class="token comment">//</span>
        <span class="token keyword">var</span> <span class="token constant">LETTERS</span> <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[a-z]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">LETTERS</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>

            <span class="token comment">// 进入子循环，直到遇到的字符不是字母为止。注意，这里没有考虑含有非字母的函数名写法。</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token constant">LETTERS</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                value <span class="token operator">+=</span> char<span class="token punctuation">;</span>
                char <span class="token operator">=</span> input<span class="token punctuation">[</span><span class="token operator">++</span>current<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 添加一个类型为 `name` 的 token</span>
            tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'name'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">value</span><span class="token operator">:</span> value
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 结束本次循环，进入下一次循环</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 最后如果没有匹配上任何类型的 token，则抛出一个错误。</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'I dont know what this character is: '</span> <span class="token operator">+</span> char<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 词法分析器的最后返回 tokens 数组。</span>
    <span class="token keyword">return</span> tokens<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br></div></div><p><img src="https://cdn.mogonote.com/u/db66ce7d4df3fc7ee394c51573980745/1639580998478.png" alt="image.png"></p> <h2 id="词法分析"><a href="#词法分析" class="header-anchor">#</a> 词法分析</h2> <p><code>the-super-tiny-compiler</code> 项目里，用到了&quot;词法分析&quot;。</p> <p>词法分析（lexical analysis）是将字符序列转换为标记（token）的过程。进行词法分析的程序或函数叫做词法分析器（lexical analyzer，简称 lexer），也叫扫描器（scanner）。</p> <p>以英文句子 <code>&quot;today is comfortable.&quot;</code> 为例，词法分析用于这个句子中是否有不合格的&quot;单词&quot;，以及将&quot;单词&quot;进行分类，这个&quot;单词&quot;也就是标记（token）。</p> <h3 id="相关概念"><a href="#相关概念" class="header-anchor">#</a> 相关概念</h3> <h4 id="标记-token"><a href="#标记-token" class="header-anchor">#</a> 标记（token）</h4> <p>标记（<code>token</code>）是构成源码的最小单位。从输入的字符串流中生成标记的过程叫标记化（<code>tokenization</code>），在这个过程中，词法分析器也会对标记进行分类。</p> <p>标记（token）通常是一个对象，包括了&quot;种别码&quot;和&quot;属性值&quot;（<code>token&lt;种别码, 属性值&gt;</code>）。</p> <p>以 the-super-tiny-compiler 输出的 token 为例，&quot;种别码&quot;也就是 &quot;number/paren/name&quot; 等类型的描述，&quot;属性值&quot;（也就是 &quot;123&quot; 等值）。</p> <p>词法分析器通常不会关注标记之间的关系（这由语法分析器关注），比如，词法分析可以将括号识别为标记（<code>token</code>），但无法保证括号间是否匹配。</p> <p>在词法分析过程中，会将代码字符串解析为一个个扁平的不可分割的词法单元，比如:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这段代码被词法分析后，会分割为如下词法单元。</p> <table><thead><tr><th>属性值</th> <th>种别码</th></tr></thead> <tbody><tr><td><code>const</code></td> <td><code>const</code></td></tr> <tr><td><code>a</code></td> <td><code>name</code></td></tr> <tr><td><code>=</code></td> <td><code>eq</code></td></tr> <tr><td><code>1</code></td> <td><code>num</code></td></tr> <tr><td><code>;</code></td> <td><code>semi</code></td></tr></tbody></table> <blockquote><p>这里采用的是 Babel 内部定义的种别码，不是普遍标准。</p></blockquote> <p>语法分析器读取输入字符流、从中识别出语素、最后生成不同类型的标记。其间一旦发现无效标记，便会报错。</p> <p>https://tc39.es/ecma262/#prod-ReservedWord</p> <h4 id="标识符-identifier"><a href="#标识符-identifier" class="header-anchor">#</a> 标识符（Identifier）</h4> <p>标识符指的是变量、函数、属性的名字、函数的参数。</p> <p>标识符的书写规则: （规则是哪里来的？）</p> <ul><li><p>第一个字符必须是字母、下划线(<code>_</code>)或者是美元符号(<code>$</code>)，不能为数字</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>name  √
_say  √
$hi   √
3name ×
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>第一个字符之后，可以是字母、下划线(<code>_</code>)或者是美元符号(<code>$</code>)、数字</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>name1  √
n_ame  √
n$     √
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>不能将关键字、保留字用作标识符</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>name √
<span class="token keyword">function</span> ×
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>可以使用 Unicode 转义序列。例如，字符 <code>a</code> 可以使用&quot;<code>\u0061</code>&quot;表示</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>\u0061 = 1 √
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <h4 id="关键字和保留字"><a href="#关键字和保留字" class="header-anchor">#</a> 关键字和保留字</h4> <ul><li><p>关键字</p> <p>关键字是 ECMA-262 规定的 JavaScript 语言内部使用的一组名称（或称为命令）。这些名称具有特定的用途。</p> <p>关键字首先是标识名（<code>IdentifierName</code>），同时具有语义（也就是在 JavaScript 中有特殊用途），比如 <code>if/while/async/await</code> 等。</p> <p>关键字不能作为标识符（<code>Identifier</code>），比如变量、标签和函数名，以下这些写法是错误的:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token keyword">if</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> ×

<span class="token keyword">var</span> <span class="token keyword">while</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> ×

<span class="token keyword">function</span> <span class="token keyword">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> ×
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>保留字</p> <p>保留字是 ECMA-262 规定的 JavaScript 语言内部预备使用的一组名称（或称为命令）。这些名称目前还没有具体的用途，是为 JavaScript 升级版本预留备用的，建议用户不要使用。</p> <p>保留字从字面意思来看，就是&quot;未来的关键字&quot;，本身还不具有特殊含义，但将来是可能成为关键字的。</p> <p>保留字不能作为标识符（<code>Identifier</code>）。</p> <p>保留字分为无条件保留字和有条件保留字。无条件保留字指的是本身严格为保留字，没有任何条件，如 <code>if/while</code>；有条件保留字指的是在特定的上下文中才被视为保留字，比如 <code>await</code> 只是在 <code>async</code> 函数/模块中，才被视为保留字。</p></li> <li><p>关键字与保留字列举</p> <p>部分关键字同时也是保留字，部分并不是。有些关键词只在特定的上下文语义中被识别为保留字。</p> <table><thead><tr><th>名称</th> <th>是关键字</th> <th>是保留字</th></tr></thead> <tbody><tr><td><code>await</code></td> <td>×</td> <td>在 <code>async</code> 函数/模块中，才被视为保留字</td></tr> <tr><td><code>break</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>case</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>catch</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>class</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>const</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>continue</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>debugger</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>default</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>delete</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>do</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>else</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>enum</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>export</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>extends</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>false</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>finally</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>for</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>function</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>if</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>import</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>in</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>instanceof</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>new</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>null</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>return</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>super</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>switch</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>this</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>throw</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>true</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>try</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>typeof</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>var</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>void</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>while</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>with</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>yield</code></td> <td>√</td> <td>√</td></tr> <tr><td><code>async</code></td> <td>√</td> <td>×</td></tr> <tr><td><code>abstract</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>double</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>goto</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>native</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>static</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>boolean</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>implements</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>package</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>byte</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>private</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>synchronized</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>char</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>extends</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>int</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>protected</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>throws</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>final</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>interface</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>public</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>transient</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>float</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>long</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>short</code></td> <td>×</td> <td>√</td></tr> <tr><td><code>volatile</code></td> <td>×</td> <td>√</td></tr></tbody></table></li></ul> <h3 id="词法分析过程"><a href="#词法分析过程" class="header-anchor">#</a> 词法分析过程</h3> <p>总的来说，词法分析分为 2 个步骤: &quot;扫描、标记&quot;。</p> <h4 id="第-1-步-扫描识别-token"><a href="#第-1-步-扫描识别-token" class="header-anchor">#</a> 第 1 步: 扫描识别 token</h4> <p>扫描是词法分析的第一阶段。词法分析器会扫描代码字符串，将其分隔为一个个 token，同时也是边扫描边识别 token 的。</p> <p>这里涉及 2 个问题:</p> <ul><li><p>代码字符串是怎样被分隔为一个个 token 的？</p> <p>利用有限状态机。</p></li> <li><p>识别 token 的依据是什么？</p> <p>利用字符串匹配和正则表达式。</p></li></ul> <h5 id="有限状态机"><a href="#有限状态机" class="header-anchor">#</a> 有限状态机</h5> <ul><li><p>问题拆解</p> <p>有限状态机（Finite State Mechine），又称有限状态自动机，是表示有限个状态以及在这些状态之间的转移和动作等行为的数学模型。</p> <p>它有如下特征：</p> <blockquote><p>状态总数（state）是有限的。
任一时刻，只处在一种状态之中。
某种条件下，会从一种状态转变（transition）到另一种状态。</p></blockquote> <p>在词法分析中，扫描源码时，遇到不同的字符，会进入不同的&quot;状态&quot;，这个&quot;状态&quot;有标识符、操作符、数字、字符串等。整个源码的扫描过程就是不同&quot;状态&quot;的迁移过程。</p> <p>比如，待扫描的源码为: <code>height &gt;= 20</code>，我们自定义的状态转译过程:</p> <p><img src="https://cdn.mogonote.com/u/db66ce7d4df3fc7ee394c51573980745/1639462404880.png" alt="image.png"></p> <p>其中，涉及的状态有:</p> <ul><li>标识符: 标记为 <code>name</code>。第一个字符必须是字母，后面的字符可以是字母或数字</li> <li>比较操作符: 标记为 <code>largerthan</code>，就是 <code>&gt;=</code></li> <li>数字字面量: 标记为 <code>num</code>，全部由数字构成</li></ul> <p>对于 JavaScript 而言，很显然这些状态的定义不是很完整，比如&quot;数字字面量&quot;还可以包含小数点，我们自定义的状态定义里缺失了这一点，不过对于我们理解有限状态机已经足够了。</p> <p>并且，上图并不是真正的优先状态机的描述方式，正确的描述方式是:</p> <p><img src="https://cdn.mogonote.com/u/db66ce7d4df3fc7ee394c51573980745/1639462441547.png" alt="image.png"></p></li> <li><p>状态转移过程</p> <ul><li><p>空状态</p> <p>刚开始启动或从其他状态返回的默认空状态。</p></li> <li><p>标识符状态</p> <p>初始状态时，遇到的第一个字符是字母的话，会转移到&quot;标识符状态&quot;。</p> <p>然后，继续&quot;预扫描&quot;后续的字符。</p> <p>如果&quot;预扫描&quot;到的下一个字符是字母或数字，则存储该字符到 token 对象的 <code>value</code> 属性，并停留在&quot;标识符状态&quot;；</p> <p>如果&quot;预扫描&quot;到的下一个字符不是字母或数字，则回退到上一个字符（也就是&quot;回溯&quot;），记录当前 token 为&quot;标识符&quot;，并退回&quot;空状态&quot;。</p></li> <li><p>数字字面量状态</p> <p>空状态时，遇到的第一个字符是数字的话，会转译到&quot;数字字面量状态&quot;。</p> <p>然后，继续&quot;预扫描&quot;后续的字符。</p> <p>如果&quot;预扫描&quot;到的下一个字符是数字，则存储该字符到 token 对象的 <code>value</code> 属性，并停留在&quot;数字字面量状态&quot;；</p> <p>如果&quot;预扫描&quot;到的下一个字符不是数字，则回退到上一个字符（也就是&quot;回溯&quot;），记录当前 token 为&quot;数字字面量状态&quot;，并退回&quot;空状态&quot;。</p></li></ul></li> <li><p>回溯</p> <p>在描述状态转译过程时，提到了&quot;回溯&quot;。</p> <p>回溯法是一种暴力搜索法，采用“试错”的思想，它尝试分步的去解决一个问题。在分步解决问题的过程中，当它通过尝试发现，现有的分步答案不能得到有效的正确的解答的时候，它将取消上一步甚至是上几步的计算，再通过其它的可能的分步解答再次尝试寻找问题的答案。</p></li> <li><p>总结</p> <p>通过上述分析过程，可以看到，词法分析的过程，其实就是根据构造的有限状态自动机，通过回溯等方式，持续进行状态转移，从而解析出各个 <code>token</code>。</p> <p>例子中只是包含了 3 个状态的有限状态自动机，要构造一个强大的词法分析器，可以根据场景扩展状态数量。</p></li></ul> <h5 id="正则表达式"><a href="#正则表达式" class="header-anchor">#</a> 正则表达式</h5> <p>这里的&quot;正则表达式&quot;就是 JavaScript 中的正则表达式，在进行状态判断时，通常用正则表达式判断状态类型，比如上文中我们自定义的状态对应的正则如下:</p> <ul><li>标识符: <code>/[a-zA-Z]([a-zA-Z_]|[0-9])*/</code></li> <li>数字字面量: <code>/\d+/</code></li> <li>赋值操作符: <code>/=/</code></li></ul> <p>当然，也可以用字符串匹配来识别各类状态，词法分析器大量采用了正则表达式和字符串匹配进行状态识别。</p> <p>Babel 的词法分析器组合使用了正则表达式/字符串匹配（重度使用了 <code>charcodes</code> 这个 npm 包）进行状态识别，后文会详细介绍。</p> <h4 id="第2步-标记-token"><a href="#第2步-标记-token" class="header-anchor">#</a> 第2步: 标记 token</h4> <p>扫描器识别出可标记的字符序列后，会交由标记生成器处理，标记生成器处理的过程叫标记化（tokenization）。</p> <p>标记化处理时，会将输入字符串分割为标记、进而将标记进行分类。这样生成的标记会被用于语法分析。</p> <p>比如字符串: <code>The quick brown fox jumps over the lazy dog</code>。</p> <p>计算机并不知道这是以空格分隔的九个英语单词，只知道这是普通的 43 个字符构成的字符串。可以通过一定的方法（这里使用空格作为分隔符）将语素（这里即英语单词）从输入字符串中分割出来。分割后的结果用 XML 可以表示如下:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sentence</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>word</span><span class="token punctuation">&gt;</span></span>The<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>word</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>word</span><span class="token punctuation">&gt;</span></span>quick<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>word</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>word</span><span class="token punctuation">&gt;</span></span>brown<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>word</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>word</span><span class="token punctuation">&gt;</span></span>fox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>word</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>word</span><span class="token punctuation">&gt;</span></span>jumps<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>word</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>word</span><span class="token punctuation">&gt;</span></span>over<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>word</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>word</span><span class="token punctuation">&gt;</span></span>the<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>word</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>word</span><span class="token punctuation">&gt;</span></span>lazy<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>word</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>word</span><span class="token punctuation">&gt;</span></span>dog<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>word</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sentence</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>尽管在某些情况下需要手工编写词法分析器，一般情况下词法分析器都用自动化工具生成。</p> <p>TODO</p> <h3 id="babel-的词法分析"><a href="#babel-的词法分析" class="header-anchor">#</a> Babel 的词法分析</h3> <p>Babel 的词法分析模块定义在 <code>Tokenizer</code> 模块，对应的目录是 <code>babel/packages/babel-parser/src/tokenizer/</code>，并且，<code>Tokenizer</code> 会作为后续语法分析、语义分析的一个中间模块提供服务。</p> <h4 id="babel-的词法单元"><a href="#babel-的词法单元" class="header-anchor">#</a> Babel 的词法单元</h4> <p>Babel 的 <code>Tokenizer</code> 模块定义了基本的词法单元，并深度依赖了第三方模块 <code>charcodes</code> 辅助进行词法分析。</p> <ul><li><p>内置词法单元</p> <p>文件 <code>babel/packages/babel-parser/src/tokenizer/types.js</code> 列举了 Babel 支持的所有词法单元。</p> <table><thead><tr><th>语素</th> <th>Babel代码中的助记符</th> <th>简介</th> <th>分类</th></tr></thead> <tbody><tr><td><code>num</code></td> <td><code>num</code></td> <td>数字</td> <td></td></tr> <tr><td><code>bigint</code></td> <td><code>bigint</code></td> <td>用于表示大于 2^53 - 1 的整数</td> <td></td></tr> <tr><td><code>decimal</code></td> <td><code>decimal</code></td> <td>更语义化地表示数字，如 <code>1_000_000</code></td> <td></td></tr> <tr><td><code>regexp</code></td> <td><code>regexp</code></td> <td>正则</td> <td></td></tr> <tr><td><code>string</code></td> <td><code>string</code></td> <td>字符串</td> <td></td></tr> <tr><td><code>name</code></td> <td><code>name</code></td> <td>名称</td> <td></td></tr> <tr><td><code>eof</code></td> <td><code>eof</code></td> <td><code>end of file</code></td> <td></td></tr> <tr><td><code>bracketL</code></td> <td><code>bracketL</code></td> <td><code>[</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>bracketHashL</code></td> <td><code>bracketHashL</code></td> <td><code>#[</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>bracketBarL</code></td> <td><code>bracketBarL</code></td> <td><code>[\|</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>bracketR</code></td> <td><code>bracketR</code></td> <td><code>]</code>字符</td> <td>标点符号</td></tr> <tr><td><code>bracketBarR</code></td> <td><code>bracketBarR</code></td> <td><code>\|]</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>bracketR</code></td> <td><code>bracketR</code></td> <td><code>}</code>字符</td> <td>标点符号</td></tr> <tr><td><code>braceL</code></td> <td><code>braceL</code></td> <td><code>{</code>字符</td> <td>标点符号</td></tr> <tr><td><code>braceBarL</code></td> <td><code>braceBarL</code></td> <td><code>{\|</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>braceHashL</code></td> <td><code>braceHashL</code></td> <td><code>#{</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>braceR</code></td> <td><code>braceR</code></td> <td><code>}</code>字符</td> <td>标点符号</td></tr> <tr><td><code>braceBarR</code></td> <td><code>braceBarR</code></td> <td><code>\|}</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>parenL</code></td> <td><code>parenL</code></td> <td><code>(</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>parenR</code></td> <td><code>parenR</code></td> <td><code>)</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>comma</code></td> <td><code>comma</code></td> <td><code>,</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>semi</code></td> <td><code>semi</code></td> <td><code>;</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>colon</code></td> <td><code>colon</code></td> <td><code>:</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>doubleColon</code></td> <td><code>doubleColon</code></td> <td><code>::</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>dot</code></td> <td><code>dot</code></td> <td><code>.</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>question</code></td> <td><code>question</code></td> <td><code>?</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>questionDot</code></td> <td><code>questionDot</code></td> <td><code>?.</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>arrow</code></td> <td><code>arrow</code></td> <td><code>=&gt;</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>template</code></td> <td><code>template</code></td> <td><code>template</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>ellipsis</code></td> <td><code>ellipsis</code></td> <td><code>...</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>backQuote</code></td> <td><code>backQuote</code></td> <td>``` 字符</td> <td>标点符号</td></tr> <tr><td><code>dollarBraceL</code></td> <td><code>dollarBraceL</code></td> <td><code>${</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>at</code></td> <td></td> <td><code>at</code></td> <td><code>@</code> 字符</td></tr> <tr><td><code>hash</code></td> <td><code>hash</code></td> <td><code>#</code> 字符</td> <td>标点符号</td></tr> <tr><td><code>interpreterDirective</code></td> <td><code>interpreterDirective</code></td> <td><code>#!</code> 字符</td> <td></td></tr> <tr><td><code>eq</code></td> <td><code>eq</code></td> <td><code>=</code>字符</td> <td>操作符</td></tr> <tr><td><code>assign</code></td> <td><code>assign</code></td> <td><code>_=</code> 字符</td> <td>操作符</td></tr> <tr><td><code>slashAssign</code></td> <td><code>slashAssign</code></td> <td><code>_=</code> 字符</td> <td>操作符</td></tr> <tr><td><code>incDec</code></td> <td><code>incDec</code></td> <td><code>++</code> / <code>--</code> 字符</td> <td>操作符</td></tr> <tr><td><code>bang</code></td> <td><code>bang</code></td> <td><code>!</code> 字符</td> <td>操作符</td></tr> <tr><td><code>tilde</code></td> <td><code>tilde</code></td> <td><code>~</code> 字符</td> <td>操作符</td></tr> <tr><td><code>pipeline</code></td> <td><code>pipeline</code></td> <td><code>\|&gt;</code> 字符</td> <td>操作符</td></tr> <tr><td><code>nullishCoalescing</code></td> <td><code>nullishCoalescing</code></td> <td><code>??</code> 字符</td> <td>操作符</td></tr> <tr><td><code>logicalOR</code></td> <td><code>logicalOR</code></td> <td><code>\|\|</code> 字符</td> <td>操作符</td></tr> <tr><td><code>logicalAND</code></td> <td><code>logicalAND</code></td> <td><code>&amp;&amp;</code> 字符</td> <td>操作符</td></tr> <tr><td><code>bitwiseOR</code></td> <td><code>bitwiseOR</code></td> <td><code>\|</code> 字符</td> <td>操作符</td></tr> <tr><td><code>bitwiseXOR</code></td> <td><code>bitwiseXOR</code></td> <td><code>^</code> 字符</td> <td>操作符</td></tr> <tr><td><code>bitwiseAND</code></td> <td><code>bitwiseAND</code></td> <td><code>&amp;</code> 字符</td> <td>操作符</td></tr> <tr><td><code>equality</code></td> <td><code>equality</code></td> <td><code>==</code> / <code>!=</code> / <code>===</code> / <code>!==</code> 字符</td> <td>操作符</td></tr> <tr><td><code>relational</code></td> <td><code>relational</code></td> <td><code>&lt;</code> / <code>&gt;</code> / <code>&lt;=</code> / <code>&gt;=</code> 字符</td> <td>操作符</td></tr> <tr><td><code>bitShift</code></td> <td><code>bitShift</code></td> <td><code>&lt;&lt;</code> / <code>&gt;&gt;</code> / <code>&gt;&gt;&gt;</code>字符</td> <td>操作符</td></tr> <tr><td><code>plusMin</code></td> <td><code>plusMin</code></td> <td><code>+</code> / <code>-</code> 字符</td> <td>操作符</td></tr> <tr><td><code>modulo</code></td> <td><code>modulo</code></td> <td><code>%</code> 字符</td> <td>操作符</td></tr> <tr><td><code>star</code></td> <td><code>star</code></td> <td><code>*</code> 字符</td> <td>操作符</td></tr> <tr><td><code>slash</code></td> <td><code>slash</code></td> <td><code>/</code> 字符</td> <td>操作符</td></tr> <tr><td><code>exponent</code></td> <td><code>exponent</code></td> <td><code>**</code> 字符</td> <td>操作符</td></tr> <tr><td><code>break</code></td> <td><code>_break</code></td> <td><code>break</code> 字符</td> <td>关键词</td></tr> <tr><td><code>case</code></td> <td><code>_case</code></td> <td><code>case</code> 字符</td> <td>关键词</td></tr> <tr><td><code>catch</code></td> <td><code>_catch</code></td> <td><code>catch</code> 字符</td> <td>关键词</td></tr> <tr><td><code>continue</code></td> <td><code>_continue</code></td> <td><code>continue</code> 字符</td> <td>关键词</td></tr> <tr><td><code>debugger</code></td> <td><code>_debugger</code></td> <td><code>debugger</code> 字符</td> <td>关键词</td></tr> <tr><td><code>default</code></td> <td><code>_default</code></td> <td><code>default</code> 字符</td> <td>关键词</td></tr> <tr><td><code>do</code></td> <td><code>_do</code></td> <td><code>do</code>字符</td> <td>关键词</td></tr> <tr><td><code>else</code></td> <td><code>_else</code></td> <td><code>else</code>字符</td> <td>关键词</td></tr> <tr><td><code>finally</code></td> <td><code>_finally</code></td> <td><code>finally</code> 字符</td> <td>关键词</td></tr> <tr><td><code>for</code></td> <td><code>_for</code></td> <td><code>for</code>字符</td> <td>关键词</td></tr> <tr><td><code>function</code></td> <td><code>_function</code></td> <td><code>function</code> 字符</td> <td>关键词</td></tr> <tr><td><code>if</code></td> <td><code>_if</code></td> <td><code>if</code> 字符</td> <td>关键词</td></tr> <tr><td><code>return</code></td> <td><code>_return</code></td> <td><code>return</code> 字符</td> <td>关键词</td></tr> <tr><td><code>switch</code></td> <td><code>_switch</code></td> <td><code>switch</code> 字符</td> <td>关键词</td></tr> <tr><td><code>throw</code></td> <td><code>_throw</code></td> <td><code>throw</code> 字符</td> <td>关键词</td></tr> <tr><td><code>try</code></td> <td><code>_try</code></td> <td><code>try</code> 字符</td> <td>关键词</td></tr> <tr><td><code>var</code></td> <td><code>_var</code></td> <td><code>var</code> 字符</td> <td>关键词</td></tr> <tr><td><code>const</code></td> <td><code>_const</code></td> <td><code>const</code> 字符</td> <td>关键词</td></tr> <tr><td><code>while</code></td> <td><code>_while</code></td> <td><code>while</code> 字符</td> <td>关键词</td></tr> <tr><td><code>with</code></td> <td><code>_with</code></td> <td><code>with</code> 字符</td> <td>关键词</td></tr> <tr><td><code>new</code></td> <td><code>_new</code></td> <td><code>new</code> 字符</td> <td>关键词</td></tr> <tr><td><code>this</code></td> <td><code>_this</code></td> <td><code>this</code> 字符</td> <td>关键词</td></tr> <tr><td><code>super</code></td> <td><code>_super</code></td> <td><code>super</code> 字符</td> <td>关键词</td></tr> <tr><td><code>class</code></td> <td><code>_class</code></td> <td><code>class</code> 字符</td> <td>关键词</td></tr> <tr><td><code>extends</code></td> <td><code>_extends</code></td> <td><code>extends</code> 字符</td> <td>关键词</td></tr> <tr><td><code>export</code></td> <td><code>_export</code></td> <td><code>export</code> 字符</td> <td>关键词</td></tr> <tr><td><code>import</code></td> <td><code>_import</code></td> <td><code>import</code> 字符</td> <td>关键词</td></tr> <tr><td><code>null</code></td> <td><code>_null</code></td> <td><code>null</code> 字符</td> <td>关键词</td></tr> <tr><td><code>true</code></td> <td><code>_true</code></td> <td><code>true</code> 字符</td> <td>关键词</td></tr> <tr><td><code>false</code></td> <td><code>_false</code></td> <td><code>false</code> 字符</td> <td>关键词</td></tr> <tr><td><code>in</code></td> <td><code>_in</code></td> <td><code>in</code> 字符</td> <td>关键词</td></tr> <tr><td><code>instanceof</code></td> <td><code>_instanceof</code></td> <td><code>instanceof</code> 字符</td> <td>关键词</td></tr> <tr><td><code>typeof</code></td> <td><code>_typeof</code></td> <td><code>typeof</code> 字符</td> <td>关键词</td></tr> <tr><td><code>void</code></td> <td><code>_void</code></td> <td><code>void</code> 字符</td> <td>关键词</td></tr> <tr><td><code>delete</code></td> <td><code>_delete</code></td> <td><code>delete</code> 字符</td> <td>关键词</td></tr></tbody></table></li> <li><p>charcodes</p> <p>Babel 利用社区的 npm 包 <code>charcodes</code> 帮助进行词法单元的识别，<code>charcodes</code> 定义的词法单元如下:</p> <p>https://compart.com/en/unicode/U+2029</p> <table><thead><tr><th>charcodes 命名</th> <th>编码</th> <th>十进制数字</th> <th>说明</th></tr></thead> <tbody><tr><td><code>backSpace</code></td> <td><code>U+0008</code></td> <td>8</td> <td></td></tr> <tr><td><code>tab</code></td> <td><code>U+0009</code></td> <td>9</td> <td><code>\t</code></td></tr> <tr><td><code>lineFeed</code></td> <td><code>U+000A</code></td> <td>10</td> <td><code>\n</code></td></tr> <tr><td><code>carriageReturn</code></td> <td><code>U+000D</code></td> <td>13</td> <td><code>\r</code></td></tr> <tr><td><code>shiftOut</code></td> <td><code>U+000E</code></td> <td>14</td> <td></td></tr> <tr><td><code>space</code></td> <td><code>U+0020</code></td> <td>32</td> <td>空格</td></tr> <tr><td><code>exclamationMark</code></td> <td><code>U+0021</code></td> <td>33</td> <td><code>!</code></td></tr> <tr><td><code>quotationMark</code></td> <td><code>U+0022</code></td> <td>34</td> <td><code>&quot;</code></td></tr> <tr><td><code>numberSign</code></td> <td><code>U+0023</code></td> <td>35</td> <td><code>#</code></td></tr> <tr><td><code>dollarSign</code></td> <td><code>U+0024</code></td> <td>36</td> <td><code>$</code></td></tr> <tr><td><code>percentSign</code></td> <td><code>U+0025</code></td> <td>37</td> <td><code>%</code></td></tr> <tr><td><code>ampersand</code></td> <td><code>U+0026</code></td> <td>38</td> <td><code>&amp;</code></td></tr> <tr><td><code>apostrophe</code></td> <td><code>U+0027</code></td> <td>39</td> <td><code>'</code></td></tr> <tr><td><code>leftParenthesis</code></td> <td><code>U+0028</code></td> <td>40</td> <td><code>(</code></td></tr> <tr><td><code>rightParenthesis</code></td> <td><code>U+0029</code></td> <td>41</td> <td><code>)</code></td></tr> <tr><td><code>asterisk</code></td> <td><code>U+002A</code></td> <td>42</td> <td><code>*</code></td></tr> <tr><td><code>plusSign</code></td> <td><code>U+002B</code></td> <td>43</td> <td><code>+</code></td></tr> <tr><td><code>comma</code></td> <td><code>U+002C</code></td> <td>44</td> <td><code>,</code></td></tr> <tr><td><code>dash</code></td> <td><code>U+002D</code></td> <td>45</td> <td><code>-</code></td></tr> <tr><td><code>dot</code></td> <td><code>U+002E</code></td> <td>46</td> <td><code>.</code></td></tr> <tr><td><code>slash</code></td> <td><code>U+002F</code></td> <td>47</td> <td><code>/</code></td></tr> <tr><td><code>digit0</code></td> <td><code>U+0030</code></td> <td>48</td> <td><code>0</code></td></tr> <tr><td><code>digit1</code></td> <td><code>U+0031</code></td> <td>49</td> <td><code>1</code></td></tr> <tr><td><code>digit2</code></td> <td><code>U+0032</code></td> <td>50</td> <td><code>2</code></td></tr> <tr><td><code>digit3</code></td> <td><code>U+0033</code></td> <td>51</td> <td><code>3</code></td></tr> <tr><td><code>digit4</code></td> <td><code>U+0034</code></td> <td>52</td> <td><code>4</code></td></tr> <tr><td><code>digit5</code></td> <td><code>U+0035</code></td> <td>53</td> <td><code>5</code></td></tr> <tr><td><code>digit6</code></td> <td><code>U+0036</code></td> <td>54</td> <td><code>6</code></td></tr> <tr><td><code>digit7</code></td> <td><code>U+0037</code></td> <td>55</td> <td><code>7</code></td></tr> <tr><td><code>digit8</code></td> <td><code>U+0038</code></td> <td>56</td> <td><code>8</code></td></tr> <tr><td><code>digit9</code></td> <td><code>U+0039</code></td> <td>57</td> <td><code>9</code></td></tr> <tr><td><code>colon</code></td> <td><code>U+003A</code></td> <td>58</td> <td><code>:</code></td></tr> <tr><td><code>semicolon</code></td> <td><code>U+003B</code></td> <td>59</td> <td><code>\|</code></td></tr> <tr><td><code>lessThan</code></td> <td><code>U+003C</code></td> <td>60</td> <td><code>&lt;</code></td></tr> <tr><td><code>equalsTo</code></td> <td><code>U+003D</code></td> <td>61</td> <td><code>=</code></td></tr> <tr><td><code>greaterThan</code></td> <td><code>U+003E</code></td> <td>62</td> <td><code>&gt;</code></td></tr> <tr><td><code>questionMark</code></td> <td><code>U+003F</code></td> <td>63</td> <td><code>?</code></td></tr> <tr><td><code>atSign</code></td> <td><code>U+0040</code></td> <td>64</td> <td><code>@</code></td></tr> <tr><td><code>uppercaseA</code></td> <td><code>U+0041</code></td> <td>65</td> <td><code>A</code></td></tr> <tr><td><code>uppercaseB</code></td> <td><code>U+0042</code></td> <td>66</td> <td><code>B</code></td></tr> <tr><td><code>uppercaseC</code></td> <td><code>U+0043</code></td> <td>67</td> <td><code>C</code></td></tr> <tr><td><code>uppercaseD</code></td> <td><code>U+0044</code></td> <td>68</td> <td><code>D</code></td></tr> <tr><td><code>uppercaseE</code></td> <td><code>U+0045</code></td> <td>69</td> <td><code>E</code></td></tr> <tr><td><code>uppercaseF</code></td> <td><code>U+0046</code></td> <td>70</td> <td><code>F</code></td></tr> <tr><td><code>uppercaseG</code></td> <td><code>U+0047</code></td> <td>71</td> <td><code>G</code></td></tr> <tr><td><code>uppercaseH</code></td> <td><code>U+0048</code></td> <td>72</td> <td><code>H</code></td></tr> <tr><td><code>uppercaseI</code></td> <td><code>U+0049</code></td> <td>73</td> <td><code>I</code></td></tr> <tr><td><code>uppercaseJ</code></td> <td><code>U+004A</code></td> <td>74</td> <td><code>J</code></td></tr> <tr><td><code>uppercaseK</code></td> <td><code>U+004B</code></td> <td>75</td> <td><code>K</code></td></tr> <tr><td><code>uppercaseL</code></td> <td><code>U+004C</code></td> <td>76</td> <td><code>L</code></td></tr> <tr><td><code>uppercaseM</code></td> <td><code>U+004D</code></td> <td>77</td> <td><code>M</code></td></tr> <tr><td><code>uppercaseN</code></td> <td><code>U+004E</code></td> <td>78</td> <td><code>N</code></td></tr> <tr><td><code>uppercaseO</code></td> <td><code>U+004F</code></td> <td>79</td> <td><code>O</code></td></tr> <tr><td><code>uppercaseP</code></td> <td><code>U+0050</code></td> <td>80</td> <td><code>P</code></td></tr> <tr><td><code>uppercaseQ</code></td> <td><code>U+0051</code></td> <td>81</td> <td><code>Q</code></td></tr> <tr><td><code>uppercaseR</code></td> <td><code>U+0052</code></td> <td>82</td> <td><code>R</code></td></tr> <tr><td><code>uppercaseS</code></td> <td><code>U+0053</code></td> <td>83</td> <td><code>S</code></td></tr> <tr><td><code>uppercaseT</code></td> <td><code>U+0054</code></td> <td>84</td> <td><code>T</code></td></tr> <tr><td><code>uppercaseU</code></td> <td><code>U+0055</code></td> <td>85</td> <td><code>U</code></td></tr> <tr><td><code>uppercaseV</code></td> <td><code>U+0056</code></td> <td>86</td> <td><code>V</code></td></tr> <tr><td><code>uppercaseW</code></td> <td><code>U+0057</code></td> <td>87</td> <td><code>W</code></td></tr> <tr><td><code>uppercaseX</code></td> <td><code>U+0058</code></td> <td>88</td> <td><code>X</code></td></tr> <tr><td><code>uppercaseY</code></td> <td><code>U+0059</code></td> <td>89</td> <td><code>Y</code></td></tr> <tr><td><code>uppercaseZ</code></td> <td><code>U+005A</code></td> <td>90</td> <td><code>Z</code></td></tr> <tr><td><code>leftSquareBracket</code></td> <td><code>U+005B</code></td> <td>91</td> <td><code>[</code></td></tr> <tr><td><code>backslash</code></td> <td><code>U+005C</code></td> <td>92</td> <td><code>\</code></td></tr> <tr><td><code>rightSquareBracket</code></td> <td><code>U+005D</code></td> <td>93</td> <td><code>]</code></td></tr> <tr><td><code>caret</code></td> <td><code>U+005E</code></td> <td>94</td> <td><code>^</code></td></tr> <tr><td><code>underscore</code></td> <td><code>U+005F</code></td> <td>95</td> <td><code>_</code></td></tr> <tr><td><code>graveAccent</code></td> <td><code>U+0060</code></td> <td>96</td> <td>`</td></tr> <tr><td><code>lowercaseA</code></td> <td><code>U+0061</code></td> <td>97</td> <td><code>a</code></td></tr> <tr><td><code>lowercaseB</code></td> <td><code>U+0062</code></td> <td>98</td> <td><code>b</code></td></tr> <tr><td><code>lowercaseC</code></td> <td><code>U+0063</code></td> <td>99</td> <td><code>c</code></td></tr> <tr><td><code>lowercaseD</code></td> <td><code>U+0064</code></td> <td>100</td> <td><code>d</code></td></tr> <tr><td><code>lowercaseE</code></td> <td><code>U+0065</code></td> <td>101</td> <td><code>e</code></td></tr> <tr><td><code>lowercaseF</code></td> <td><code>U+0066</code></td> <td>102</td> <td><code>f</code></td></tr> <tr><td><code>lowercaseG</code></td> <td><code>U+0067</code></td> <td>103</td> <td><code>g</code></td></tr> <tr><td><code>lowercaseH</code></td> <td><code>U+0068</code></td> <td>104</td> <td><code>h</code></td></tr> <tr><td><code>lowercaseI</code></td> <td><code>U+0069</code></td> <td>105</td> <td><code>i</code></td></tr> <tr><td><code>lowercaseJ</code></td> <td><code>U+006A</code></td> <td>106</td> <td><code>j</code></td></tr> <tr><td><code>lowercaseK</code></td> <td><code>U+006B</code></td> <td>107</td> <td><code>k</code></td></tr> <tr><td><code>lowercaseL</code></td> <td><code>U+006C</code></td> <td>108</td> <td><code>l</code></td></tr> <tr><td><code>lowercaseM</code></td> <td><code>U+006D</code></td> <td>109</td> <td><code>m</code></td></tr> <tr><td><code>lowercaseN</code></td> <td><code>U+006E</code></td> <td>110</td> <td><code>n</code></td></tr> <tr><td><code>lowercaseO</code></td> <td><code>U+006F</code></td> <td>111</td> <td><code>o</code></td></tr> <tr><td><code>lowercaseP</code></td> <td><code>U+0070</code></td> <td>112</td> <td><code>p</code></td></tr> <tr><td><code>lowercaseQ</code></td> <td><code>U+0071</code></td> <td>113</td> <td><code>q</code></td></tr> <tr><td><code>lowercaseR</code></td> <td><code>U+0072</code></td> <td>114</td> <td><code>r</code></td></tr> <tr><td><code>lowercaseS</code></td> <td><code>U+0073</code></td> <td>115</td> <td><code>s</code></td></tr> <tr><td><code>lowercaseT</code></td> <td><code>U+0074</code></td> <td>116</td> <td><code>t</code></td></tr> <tr><td><code>lowercaseU</code></td> <td><code>U+0075</code></td> <td>117</td> <td><code>u</code></td></tr> <tr><td><code>lowercaseV</code></td> <td><code>U+0076</code></td> <td>118</td> <td><code>v</code></td></tr> <tr><td><code>lowercaseW</code></td> <td><code>U+0077</code></td> <td>119</td> <td><code>w</code></td></tr> <tr><td><code>lowercaseX</code></td> <td><code>U+0078</code></td> <td>120</td> <td><code>x</code></td></tr> <tr><td><code>lowercaseY</code></td> <td><code>U+0079</code></td> <td>121</td> <td><code>y</code></td></tr> <tr><td><code>lowercaseZ</code></td> <td><code>U+007A</code></td> <td>122</td> <td><code>z</code></td></tr> <tr><td><code>leftCurlyBrace</code></td> <td><code>U+007B</code></td> <td>123</td> <td><code>{</code></td></tr> <tr><td><code>verticalBar</code></td> <td><code>U+007C</code></td> <td>124</td> <td><code>\|</code></td></tr> <tr><td><code>rightCurlyBrace</code></td> <td><code>U+007D</code></td> <td>125</td> <td><code>}</code></td></tr> <tr><td><code>tilde</code></td> <td><code>U+007E</code></td> <td>126</td> <td><code>~</code></td></tr> <tr><td><code>nonBreakingSpace</code></td> <td><code>U+00A0</code></td> <td>160</td> <td>不换行空格</td></tr> <tr><td><code>oghamSpaceMark</code></td> <td><code>U+1680</code></td> <td>5760</td> <td><code></code></td></tr> <tr><td><code>lineSeparator</code></td> <td><code>U+2028</code></td> <td>8232</td> <td></td></tr> <tr><td><code>paragraphSeparator</code></td> <td><code>U+2029</code></td> <td>8233</td> <td></td></tr></tbody></table></li></ul> <h4 id="babel-tokenizer-源码解析"><a href="#babel-tokenizer-源码解析" class="header-anchor">#</a> Babel tokenizer 源码解析</h4> <h5 id="文件结构"><a href="#文件结构" class="header-anchor">#</a> 文件结构</h5> <p>Babel Tokenizer 的核心代码位于目录 <code>github/babel/packages/babel-parser/src/tokenizer/</code>，其中 <code>/tokenizer/index.js</code> 定义了 <code>Tokenizer</code> 类。</p> <p>文件结构:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>|-- babel-parser
    |-- src
        |-- tokenizer
            |-- context.js: 上下文对象 context，与 token 示例关联
            |-- index.js: 定义了 Tokenizer 类，包括各种 token 相关的处理方法和属性
            |-- state.js: 维护了当前 token 实例的状态信息
            |-- types.js: 维护了所有 token 类型
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h5 id="tokendizer-index-js-重点代码"><a href="#tokendizer-index-js-重点代码" class="header-anchor">#</a> tokendizer/index.js 重点代码</h5> <p>总体而言，tokendizer/index.js 中定义的 <code>Tokenizer</code> 类继承自 <code>PaserErrors</code> 对象，同时定义了关于 token 的各种操作方法和属性。</p> <ul><li><p><code>tokens: Array&lt;Token | N.Comment&gt; = [];</code></p> <p><code>token</code> 数组。数组项可以是 <code>Token</code> 类的实例或者是注释对象。</p></li> <li><p><code>nextToken()</code></p> <p>访问下一个 <code>token</code>。</p> <p>笔者在源码中添加了部分注释，便于理解。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">nextToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> curContext <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">curContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 如果不保留空白符和注释，则跳过它们</span>
    <span class="token comment">// 一般情况下，均认为空格是可以忽略的，不需要识别为 token。有几种类型的 token 是例外:</span>
    <span class="token comment">// 1. `template`: 模板字符串中的空格是有意义的</span>
    <span class="token comment">// 2. jsx 中的 `expr`: `&lt;tag&gt;...&lt;/tag&gt;` 标签内的空格也是有意义的</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>curContext<span class="token punctuation">.</span>preserveSpace<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">skipSpace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>start <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token punctuation">;</span>

    <span class="token comment">// 记录访问开始的位置信息</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isLookahead<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>startLoc <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">curPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 如果目标访问位置超过了源码长度，则认为进入源码文件末尾，也就是 &quot;end-of-file&quot;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishToken</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>eof<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 区分是在读取 template 语法还是非 template 语法（数字、操作符等）</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>curContext <span class="token operator">===</span> ct<span class="token punctuation">.</span>template<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">readTmplToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getTokenFromCode</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">codePointAtPos</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div></li> <li><p><code>lookahead()</code></p> <p>读取并返回下一个 <code>token</code> 对象。这里用到了简单的&quot;回溯&quot;写法，先保存当前 token 对象，再直接进入并获取下一个 token 对象，最后恢复为当前 token 对象。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">lookahead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> LookaheadState <span class="token punctuation">{</span>
    <span class="token comment">// 保留状态</span>
    <span class="token keyword">const</span> old <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>

    <span class="token comment">// 创建一个新的 token state</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createLookaheadState</span><span class="token punctuation">(</span>old<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 访问下一个 token</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>isLookahead <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">nextToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>isLookahead <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> curr <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>

    <span class="token comment">// 恢复状态</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> old<span class="token punctuation">;</span>

    <span class="token comment">// 返回下一个 token</span>
    <span class="token keyword">return</span> curr<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></li> <li><p><code>codePointAtPos()</code></p> <p>TODO</p></li></ul> <h4 id="babel-定义的-token-类型"><a href="#babel-定义的-token-类型" class="header-anchor">#</a> Babel 定义的 token 类型</h4> <p>词法文法: https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Lexical_grammar
JavaScript 参考: https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference</p> <p>在介绍词法分析时提到过一个案例：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这段代码被词法分析后，会分割为如下词法单元。</p> <table><thead><tr><th>词法单元</th> <th>token 类型</th></tr></thead> <tbody><tr><td><code>const</code></td> <td><code>const</code></td></tr> <tr><td><code>a</code></td> <td><code>name</code></td></tr> <tr><td><code>=</code></td> <td><code>eq</code></td></tr> <tr><td><code>1</code></td> <td><code>num</code></td></tr> <tr><td><code>;</code></td> <td><code>semi</code></td></tr></tbody></table> <p>很显然这些类型对 Babel 来说是不够的，笔者整理了 Babel tokendizer 中的 token 类型。</p> <h5 id="空白"><a href="#空白" class="header-anchor">#</a> &quot;空白&quot;</h5> <p>&quot;空白&quot;包括: 格式控制符、空白符、行终止符:</p> <ul><li><p>格式控制符</p> <p>用于控制对源码文本的解释，但是并不会显示出来。</p></li> <li><p>空白符</p> <p>用于提升源码的可读性，并不影响源码的功能，通常用于将标记（tokens）分开。</p></li> <li><p>行终止符</p> <p>除了&quot;空白符&quot;之外，&quot;行终止符&quot;也可以提高源码的可读性。</p> <p>不同的是，&quot;行终止符&quot;可以影响 JavaScript 代码的执行。&quot;行终止符&quot;也会影响自动分号补全的执行。在正则表达式中，&quot;行终止符&quot;会被 <code>\s</code> 匹配。</p></li></ul> <p>下表是各种&quot;空白&quot;的介绍:</p> <table><thead><tr><th>分类</th> <th>编码</th> <th>名称</th> <th>缩写</th> <th>说明</th> <th>转义序列</th></tr></thead> <tbody><tr><td>格式控制符</td> <td><code>U+200C</code></td> <td>零宽不连字</td> <td><code>&lt;ZWNJ&gt;</code></td> <td>放置在一些经常会被当成连字的字符之间，用于将它们分别以独立形式显示</td> <td></td></tr> <tr><td>格式控制符</td> <td><code>U+200D</code></td> <td>零宽连字</td> <td><code>&lt;ZWJ&gt;</code></td> <td>放置在一些通常不会被标记为连字的字符之间，用于将这些字符以连字形式显示</td> <td></td></tr> <tr><td>格式控制符</td> <td><code>U+FEFF</code></td> <td>字节流方向标识</td> <td><code>&lt;BOM&gt;</code></td> <td>在脚本开头使用，除了将脚本标记为 <code>Unicode</code> 格式以外，还用来标记文本的字节流方向</td> <td></td></tr> <tr><td>空白符</td> <td><code>U+0009</code></td> <td>制表符</td> <td><code>&lt;HT&gt;</code></td> <td>水平制表符，就是TAB</td> <td><code>\t</code></td></tr> <tr><td>空白符</td> <td><code>U+000B</code></td> <td>垂直制表符</td> <td><code>&lt;VT&gt;</code></td> <td>垂直制表符，就是垂直方向的TAB</td> <td><code>\v</code></td></tr> <tr><td>空白符</td> <td><code>U+000C</code></td> <td>分页符</td> <td><code>&lt;FF&gt;</code></td> <td>分页符</td> <td><code>\f</code></td></tr> <tr><td>空白符</td> <td><code>U+0020</code></td> <td>空格</td> <td><code>&lt;SP&gt;</code></td> <td>空格</td> <td></td></tr> <tr><td>空白符</td> <td><code>U+00A0</code></td> <td>不换行空格</td> <td><code>&lt;NBSP&gt;</code></td> <td><code>&lt;SP&gt;</code> 的变体，非换行空格，<br>在文字排版中可以避免因为空格在此处发生断行，在 HTML 中使用的 <code>&amp;nbsp</code> 会生成它</td> <td></td></tr> <tr><td>空白符</td> <td><code>Others</code></td> <td>其他 Unicode 空白</td> <td><code>&lt;USP&gt;</code></td> <td></td> <td></td></tr> <tr><td>行终止符</td> <td><code>U+000A</code></td> <td>换行符</td> <td><code>&lt;LF&gt;</code></td> <td>在 UNIX 系统中起新行</td> <td><code>\n</code></td></tr> <tr><td>行终止符</td> <td><code>U+000D</code></td> <td>回车符</td> <td><code>&lt;CR&gt;</code></td> <td>在 Commodore 和早期的 Mac 系统中起新行</td> <td><code>\r</code></td></tr> <tr><td>行终止符</td> <td><code>U+2028</code></td> <td>行分隔符</td> <td><code>&lt;LS&gt;</code></td> <td>Unicode 中的行分隔符</td> <td></td></tr> <tr><td>行终止符</td> <td><code>U+2029</code></td> <td>段分隔符</td> <td><code>&lt;PS&gt;</code></td> <td>Unicode 中的段落分隔符</td> <td></td></tr></tbody></table> <p>Babel 中，有一个单独的文件提供了&quot;空白&quot;相关的工具方法: babel/packages/babel-parser/src/util/whitespace.js。</p> <p>其核心代码如下:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> lineBreak <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\r\n?|[\n\u2028\u2029]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>

<span class="token comment">// https://tc39.github.io/ecma262/#sec-line-terminators</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">isNewLine</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">code</span><span class="token operator">:</span> number</span><span class="token punctuation">)</span><span class="token operator">:</span> boolean <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> charCodes<span class="token punctuation">.</span>lineFeed<span class="token operator">:</span> <span class="token comment">// &quot;\n&quot; &lt;LF&gt;</span>
        <span class="token keyword">case</span> charCodes<span class="token punctuation">.</span>carriageReturn<span class="token operator">:</span> <span class="token comment">// &quot;\r&quot; &lt;CR&gt;</span>
        <span class="token keyword">case</span> charCodes<span class="token punctuation">.</span>lineSeparator<span class="token operator">:</span> <span class="token comment">// 行分隔符 &lt;LS&gt;</span>
        <span class="token keyword">case</span> charCodes<span class="token punctuation">.</span>paragraphSeparator<span class="token operator">:</span> <span class="token comment">// 段分隔符 &lt;PS&gt;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// https://tc39.github.io/ecma262/#sec-white-space</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">isWhitespace</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">code</span><span class="token operator">:</span> number</span><span class="token punctuation">)</span><span class="token operator">:</span> boolean <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token number">0x0009</span><span class="token operator">:</span> <span class="token comment">// CHARACTER TABULATION</span>
        <span class="token keyword">case</span> <span class="token number">0x000b</span><span class="token operator">:</span> <span class="token comment">// LINE TABULATION</span>
        <span class="token keyword">case</span> <span class="token number">0x000c</span><span class="token operator">:</span> <span class="token comment">// FORM FEED</span>
        <span class="token keyword">case</span> charCodes<span class="token punctuation">.</span>space<span class="token operator">:</span> <span class="token comment">// 空格 &lt;SP&gt;</span>
        <span class="token keyword">case</span> charCodes<span class="token punctuation">.</span>nonBreakingSpace<span class="token operator">:</span> <span class="token comment">// 不换行空格 &lt;NBSP&gt;</span>
        <span class="token keyword">case</span> charCodes<span class="token punctuation">.</span>oghamSpaceMark<span class="token operator">:</span> <span class="token comment">// ?</span>
        <span class="token keyword">case</span> <span class="token number">0x2000</span><span class="token operator">:</span> <span class="token comment">// EN QUAD</span>
        <span class="token keyword">case</span> <span class="token number">0x2001</span><span class="token operator">:</span> <span class="token comment">// EM QUAD</span>
        <span class="token keyword">case</span> <span class="token number">0x2002</span><span class="token operator">:</span> <span class="token comment">// EN SPACE</span>
        <span class="token keyword">case</span> <span class="token number">0x2003</span><span class="token operator">:</span> <span class="token comment">// EM SPACE</span>
        <span class="token keyword">case</span> <span class="token number">0x2004</span><span class="token operator">:</span> <span class="token comment">// THREE-PER-EM SPACE</span>
        <span class="token keyword">case</span> <span class="token number">0x2005</span><span class="token operator">:</span> <span class="token comment">// FOUR-PER-EM SPACE</span>
        <span class="token keyword">case</span> <span class="token number">0x2006</span><span class="token operator">:</span> <span class="token comment">// SIX-PER-EM SPACE</span>
        <span class="token keyword">case</span> <span class="token number">0x2007</span><span class="token operator">:</span> <span class="token comment">// FIGURE SPACE</span>
        <span class="token keyword">case</span> <span class="token number">0x2008</span><span class="token operator">:</span> <span class="token comment">// PUNCTUATION SPACE</span>
        <span class="token keyword">case</span> <span class="token number">0x2009</span><span class="token operator">:</span> <span class="token comment">// THIN SPACE</span>
        <span class="token keyword">case</span> <span class="token number">0x200a</span><span class="token operator">:</span> <span class="token comment">// HAIR SPACE</span>
        <span class="token keyword">case</span> <span class="token number">0x202f</span><span class="token operator">:</span> <span class="token comment">// NARROW NO-BREAK SPACE</span>
        <span class="token keyword">case</span> <span class="token number">0x205f</span><span class="token operator">:</span> <span class="token comment">// MEDIUM MATHEMATICAL SPACE</span>
        <span class="token keyword">case</span> <span class="token number">0x3000</span><span class="token operator">:</span> <span class="token comment">// IDEOGRAPHIC SPACE</span>
        <span class="token keyword">case</span> <span class="token number">0xfeff</span><span class="token operator">:</span> <span class="token comment">// ZERO WIDTH NO-BREAK SPACE</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h5 id="注释"><a href="#注释" class="header-anchor">#</a> 注释</h5> <p>注释用来在源码中增加提示、笔记、建议、警告等信息，可以帮助阅读和理解源码。在调试时，可以用来将一段代码屏蔽掉，防止其运行。</p> <p>在 JavaScript 中，有 3 种添加注释的方法。</p> <ul><li><p>单行注释: <code>//</code> 后的文本都视为注释</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 这是单行注释</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello world!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>多行注释: <code>/* */</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/*
* 这是多行注释 1
* 这是多行注释 2
*/</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello world!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>Hashbang 注释: <code>#!</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token hashbang comment">#!/usr/bin/env node</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello world!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>JavaScript 中的 hashbang 注释模仿 Unix 中的 <code>shebangs</code>，用于指定适当的解释器运行文件，它仅在脚本或模块的绝对开头有效。</p> <p>在计算领域中，Shebang（也称为 Hashbang）是一个由井号和叹号构成的字符序列 <code>#!</code>，其出现在文本文件的第一行的前两个字符。 在文件中存在 <code>Shebang</code> 的情况下，类 Unix 操作系统的程序加载器会分析 <code>Shebang</code> 后的内容，将这些内容作为解释器指令，并调用该指令，并将载有 <code>Shebang</code> 的文件路径作为该解释器的参数。</p> <p>例如，以指令 <code>#!/bin/sh</code> 开头的文件在执行时会实际调用 <code>/bin/sh</code> 程序。</p> <p>下面列出了一些典型的 shebang 解释器指令：</p> <ul><li><code>#!/bin/sh</code> — 使用 <code>sh</code>，即 Bourne shell<code>或其它兼容</code>shell` 执行脚本</li> <li><code>#!/bin/csh</code> — 使用 <code>csh</code>，即 C shell 执行</li> <li><code>#!/usr/bin/perl -w</code> — 使用带警告的 Perl 执行</li> <li><code>#!/usr/bin/python -O</code> — 使用具有代码优化的 Python 执行</li> <li><code>#!/usr/bin/php</code> — 使用 PHP 的命令行解释器执行</li></ul></li></ul> <p>文件 babel/packages/babel-parser/src/tokenizer/index.js 中有与注释相关的处理方法，tokenizer 对注释的处理方式分为两种:</p> <ul><li><p>单行和多行注释，视为&quot;空白&quot;</p> <p><code>skipSpace()</code> 方法会识别注释并添加到 <code>commentStack</code> 数组中。</p> <p>识别时，以 <code>/</code> 为关注点，检测下一个字符是 <code>*</code> 或 <code>/</code>。</p> <p>如果下一个字符是 <code>*</code>，进入 <code>skipBlockComment()</code> 的执行流程；</p> <p>如果下一个字符是 <code>/</code>，进入<code>skipLineComment()</code> 的执行流程。</p></li> <li><p>Hashbang 注释的处理方法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">readToken_interpreter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> boolean <span class="token punctuation">{</span>
    <span class="token comment">// 如果字符起始位置不是第一个字符，就直接返回，不做处理</span>
    <span class="token comment">// 如果长度不够 2，也不做处理</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">!==</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> ch <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">!==</span> charCodes<span class="token punctuation">.</span>exclamationMark<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// !</span>

    <span class="token keyword">const</span> start <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isNewLine</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ch <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 取出 #! xxx 中的 xxx 作为 value 值</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>start <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishToken</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>interpreterDirective<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>该方法会识别并取出 <code>#! xxx</code> 中的 <code>xxx</code> 作为该 token 的值。</p></li></ul> <h5 id="标识符-name"><a href="#标识符-name" class="header-anchor">#</a> 标识符: <code>name</code></h5> <p>标识符是代码中用来标识变量、函数、或属性的字符序列。</p> <p>在 JavaScript 中，标识符只能包含字母或数字或下划线（<code>&quot;_&quot;</code>）或美元符号（<code>&quot;$&quot;</code>），且不能以数字开头。</p> <p>文件 babel/packages/babel-parser/src/tokenizer/index.js 中与标识符识别相关的方法是：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">readWord</span><span class="token punctuation">(</span>firstCode<span class="token operator">:</span> number <span class="token operator">|</span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> word <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">readWord1</span><span class="token punctuation">(</span>firstCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> type <span class="token operator">=</span> keywordTypes<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span> <span class="token operator">||</span> tt<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishToken</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> word<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function">readWord1</span><span class="token punctuation">(</span>firstCode<span class="token operator">:</span> numbder <span class="token operator">|</span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="数字直接量-num"><a href="#数字直接量-num" class="header-anchor">#</a> 数字直接量: <code>num</code></h5> <ul><li><p>JavaScript 中表示数字的方式</p> <ul><li><p>字面量</p> <p>使用字面量（literal）直接表示一个数值时，JavaScript 对整数提供四种进制的表示方法: 十进制、十六进制、八进制、二进制。</p> <ul><li><p>十进制: 没有前导 <code>0</code> 的数值。</p> <p>只有十进制可以带小数和用科学计数法表示。</p> <p>带小数时小数点前后部分都可以省略（不能同时省略），如 <code>0.1 / 1. / 2.4</code>。</p></li> <li><p>八进制: 有前缀 <code>0o</code> 或 <code>0O</code> 的数值，或者有前导 <code>0</code>、且只用到 <code>0-7</code> 的八个阿拉伯数字的数值。</p></li> <li><p>十六进制: 有前缀 <code>0x</code> 或 <code>0X</code> 的数值。</p></li> <li><p>二进制: 有前缀 <code>0b</code> 或 <code>0B</code> 的数值。</p></li></ul></li> <li><p>科学计数法</p> <p>科学计数法表示允许字母 <code>e</code> 或 <code>E</code> 的后面，跟着一个整数，表示这个数值的指数部分。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token number">123e3</span> <span class="token comment">// 123000</span>
<span class="token number">123e-3</span> <span class="token comment">// 0.123</span>
<span class="token operator">-</span><span class="token number">3.1E+12</span>
<span class="token number">.1e-23</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>特殊数值</p> <ul><li><p>正零和负零</p> <p>在 JavaScript 的 64 位浮点数中，有一个二进制位是符号位，那么，0 也是有一个对应的负值的。<code>+0</code> 和 <code>-0</code> 都指的是 <code>0</code>，只是它们的64位浮点数表示法的符号位不同。</p> <p>一般状态下，<code>+0</code> 和 <code>-0</code> 是等价的，会被当做正常的<code>0</code>:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">+</span><span class="token number">0</span> <span class="token comment">// 0</span>
<span class="token operator">-</span><span class="token number">0</span> <span class="token comment">// 0</span>
<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// '0'</span>
<span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// '0'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>只是，如果 <code>+0</code> 和 <code>-0</code> 作为分母，则有一些区别:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>因为 <code>1 / +0</code> 的结果是 <code>+Infinity</code>，<code>1 / -0</code> 的结果是 <code>-Infinity</code>。</p></li> <li><p><code>NaN</code></p></li> <li><p><code>Infinity</code></p></li></ul></li></ul></li> <li><p>文件 babel/packages/babel-parser/src/tokenizer/index.js 对数字的处理</p> <ul><li><p><code>readInt()</code></p> <p>TODO</p></li> <li><p><code>readRadixNumber()</code></p> <p>TODO</p></li> <li><p><code>readNumber()</code></p> <p>TODO</p></li></ul></li></ul> <h5 id="正则表达式直接量-regexp"><a href="#正则表达式直接量-regexp" class="header-anchor">#</a> 正则表达式直接量: <code>regexp</code></h5> <ul><li><p>正则的 <code>flag</code></p> <p>正则有如下 <code>flag</code>: <code>g/m/s/i/y/u/d</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>charCodes<span class="token punctuation">.</span>lowercaseG
charCodes<span class="token punctuation">.</span>lowercaseM
charCodes<span class="token punctuation">.</span>lowercaseS
charCodes<span class="token punctuation">.</span>lowercaseI
charCodes<span class="token punctuation">.</span>lowercaseY
charCodes<span class="token punctuation">.</span>lowercaseU
charCodes<span class="token punctuation">.</span>lowercaseD
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>tokenizer 对正则的处理</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">readRegexp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> start <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>start <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> escaped<span class="token punctuation">,</span> inClass<span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span> pos <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> <span class="token operator">++</span>pos<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pos <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">raise</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> Errors<span class="token punctuation">.</span>UnterminatedRegExp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">const</span> ch <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNewLine</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 遇到换行符，抛出错误，遇到未完结的正则表达式</span>
            <span class="token keyword">throw</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">raise</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> Errors<span class="token punctuation">.</span>UnterminatedRegExp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>escaped<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            escaped <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>leftSquareBracket<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// [</span>
                inClass <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>rightSquareBracket <span class="token operator">&amp;&amp;</span> inClass<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ]</span>
                inClass <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>slash <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>inClass<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// /</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            escaped <span class="token operator">=</span> ch <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>backslash<span class="token punctuation">;</span> <span class="token comment">// \</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 内容</span>
    <span class="token operator">++</span>pos<span class="token punctuation">;</span>

    <span class="token keyword">let</span> mods <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>pos <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> cp <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">codePointAtPos</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// It doesn't matter if cp &gt; 0xffff, the loop will either throw or break because we check on cp</span>
        <span class="token keyword">const</span> char <span class="token operator">=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>cp<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">VALID_REGEX_FLAGS</span><span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>cp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mods<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">raise</span><span class="token punctuation">(</span>pos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> Errors<span class="token punctuation">.</span>DuplicateRegExpFlags<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 重复的 flag</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isIdentifierChar</span><span class="token punctuation">(</span>cp<span class="token punctuation">)</span> <span class="token operator">||</span> cp <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>backslash<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">raise</span><span class="token punctuation">(</span>pos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> Errors<span class="token punctuation">.</span>MalformedRegExpFlags<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 非法正则</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token operator">++</span>pos<span class="token punctuation">;</span>
        mods <span class="token operator">+=</span> char<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">=</span> pos<span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishToken</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>regexp<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">pattern</span><span class="token operator">:</span> content<span class="token punctuation">,</span>
        <span class="token literal-property property">flags</span><span class="token operator">:</span> mods<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div></li></ul> <h5 id="字符串直接量-string"><a href="#字符串直接量-string" class="header-anchor">#</a> 字符串直接量: <code>string</code></h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">readString</span><span class="token punctuation">(</span>quote<span class="token operator">:</span> number<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> out <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
        chunkStart <span class="token operator">=</span> <span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">raise</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>start<span class="token punctuation">,</span> Errors<span class="token punctuation">.</span>UnterminatedString<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">const</span> ch <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">===</span> quote<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>backslash<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            out <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>chunkStart<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// $FlowFixMe</span>
            out <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">readEscapedChar</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            chunkStart <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
            ch <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>lineSeparator <span class="token operator">||</span>
            ch <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>paragraphSeparator
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token punctuation">;</span>
            <span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>curLine<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>lineStart <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNewLine</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">raise</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>start<span class="token punctuation">,</span> Errors<span class="token punctuation">.</span>UnterminatedString<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    out <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>chunkStart<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishToken</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>string<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h5 id="模板字符串-template"><a href="#模板字符串-template" class="header-anchor">#</a> 模板字符串: <code>template</code></h5> <p>模板字符串是允许嵌入表达式的字符串字面量，可以使用多行、表达式引入、标签引入功能。</p> <p>它有如下形态:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 单行</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">string text</span><span class="token template-punctuation string">`</span></span>

<span class="token comment">// 多行</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">string text line 1
string text line 2</span><span class="token template-punctuation string">`</span></span>

<span class="token comment">// 表达式引入</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">string text </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>expression<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> string text</span><span class="token template-punctuation string">`</span></span>

<span class="token comment">// 标签引入</span>
tag<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">string text </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>expression<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> string text</span><span class="token template-punctuation string">`</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>token 解析时，需要对以下情况做处理。</p> <ul><li>该代码段第一批字符是 ` 开头的话，会记录为一个 <code>tt.backQuote</code> 类型</li> <li>该代码段第一批字符是 <code>${</code> 开头的话，会记录为一个 <code>tt.dollarBraceL</code> 类型</li> <li>在扫描该代码段途中，遇到转译标志 <code>\</code>、换行 <code>\r</code> 及 <code>\n</code> 时，会继续扫描检查是否满足对目标格式的要求</li></ul> <h5 id="符号"><a href="#符号" class="header-anchor">#</a> 符号</h5> <p>JavaScript 中有如下符号:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span> <span class="token punctuation">.</span> <span class="token operator">...</span> <span class="token punctuation">;</span> <span class="token punctuation">,</span> <span class="token operator">&lt;</span> <span class="token operator">&gt;</span> <span class="token operator">&lt;=</span> <span class="token operator">&gt;=</span> <span class="token operator">==</span> <span class="token operator">!=</span> <span class="token operator">===</span> <span class="token operator">!==</span> <span class="token operator">+</span> <span class="token operator">-</span> <span class="token operator">*</span> <span class="token operator">%</span> <span class="token operator">**</span> <span class="token operator">++</span> <span class="token operator">--</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">&gt;&gt;</span> <span class="token operator">&gt;&gt;&gt;</span> <span class="token operator">&amp;</span> <span class="token operator">|</span> <span class="token operator">^</span> <span class="token operator">!</span> <span class="token operator">~</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">||</span> <span class="token operator">?</span> <span class="token operator">:</span> <span class="token operator">=</span> <span class="token operator">+=</span> <span class="token operator">-=</span> <span class="token operator">*=</span> <span class="token operator">%=</span> <span class="token operator">**=</span> <span class="token operator">&lt;&lt;=</span> <span class="token operator">&gt;&gt;=</span> <span class="token operator">&gt;&gt;&gt;=</span> <span class="token operator">&amp;=</span> <span class="token operator">|=</span> <span class="token operator">^=</span> <span class="token operator">=&gt;</span> <span class="token operator">/</span> <span class="token operator">/=</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>因需识别字符串模板，<code>{</code> 和 <code>}</code> 也被视为可能有意义的符号
因需识别除法和正则，<code>/</code> 也被视为可能有意义的符号</p></blockquote> <ul><li><p><code>.</code>: <code>dot</code></p> <p>当源码遍历过程中，遇到 <code>.</code> 字符时，会调用 <code>readToken_dot</code> 方法。</p> <p><code>.</code>开头的合法 token 的值有两种: 数字（如 <code>.123</code>）、扩展运算符（<code>...</code>）。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">readToken_dot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> next <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 识别 &quot;.123&quot;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">&gt;=</span> charCodes<span class="token punctuation">.</span>digit0 <span class="token operator">&amp;&amp;</span> next <span class="token operator">&lt;=</span> charCodes<span class="token punctuation">.</span>digit9<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">readNumber</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 识别 &quot;...&quot;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>dot <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>dot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishToken</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>ellipsis<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishToken</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>dot<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li> <li><p><code>/</code>: <code>slash</code></p> <p>当源码遍历过程中，遇到 <code>/</code> 字符时，会调用 <code>readToken_slash</code>方法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">readToken_slash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> next <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>equalsTo<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// /=</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishOp</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>slashAssign<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishOp</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>slash<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>该方法可以识别2种token: <code>/=</code>、<code>/</code>。</p></li> <li><p><code>*</code>: <code>star</code> 或 <code>%</code>: <code>modulo</code></p> <p>当源码遍历过程中，遇到 <code>*</code> 或 <code>%</code> 字符时，会调用 <code>readToken_mult_modulo</code> 方法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">readToken_mult_modulo</span><span class="token punctuation">(</span>code<span class="token operator">:</span> number<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// '%*'</span>
    <span class="token keyword">let</span> type <span class="token operator">=</span> code <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>asterisk <span class="token operator">?</span> tt<span class="token punctuation">.</span>star <span class="token operator">:</span> tt<span class="token punctuation">.</span>modulo<span class="token punctuation">;</span> <span class="token comment">// asterisk: *</span>
    <span class="token keyword">let</span> width <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> next <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Exponentiation operator **</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>asterisk <span class="token operator">&amp;&amp;</span> next <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>asterisk<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        width<span class="token operator">++</span><span class="token punctuation">;</span>
        next <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        type <span class="token operator">=</span> tt<span class="token punctuation">.</span>exponent<span class="token punctuation">;</span> <span class="token comment">// **</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>equalsTo <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>inType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        width<span class="token operator">++</span><span class="token punctuation">;</span>
        type <span class="token operator">=</span> tt<span class="token punctuation">.</span>assign<span class="token punctuation">;</span> <span class="token comment">// *= / %=</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishOp</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> width<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>该方法可以识别 3 种 token: <code>**</code>、<code>*=</code>、<code>%=</code>。</p></li> <li><p><code>|</code> 或 <code>&amp;</code></p> <p>当源码遍历过程中，遇到 <code>|</code> 或 <code>&amp;</code> 字符时，会调用 <code>readToken_pipe_amp</code> 方法。</p> <p>该方法可以识别 3 种 token: <code>||</code>、 <code>、&amp;&amp;</code>、 <code>、||=</code>、 <code>、&amp;&amp;=</code>、<code>|&gt;</code>、<code>|}</code>、<code>|]</code>。</p> <p>值得注意的是，该方法内部有对部分插件的引入要求:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// '|}'</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hasPlugin</span><span class="token punctuation">(</span><span class="token string">&quot;recordAndTuple&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> next <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>rightCurlyBrace<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 要求引入插件 babel-plugin-syntax-record-and-tuple，</span>
    <span class="token comment">// 并且插件的 syntaxType 配置项的值不能是 &quot;bar&quot;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getPluginOption</span><span class="token punctuation">(</span><span class="token string">&quot;recordAndTuple&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;syntaxType&quot;</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 没有引入插件，抛出</span>
        <span class="token keyword">throw</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">raise</span><span class="token punctuation">(</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token punctuation">,</span>
            Errors<span class="token punctuation">.</span>RecordExpressionBarIncorrectEndSyntaxType<span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li><p><code>^</code></p> <p>当源码遍历过程中，遇到 <code>^</code> 字符时，会调用 <code>readToken_caret</code> 方法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">readToken_caret</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> next <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>equalsTo<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ^=</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishOp</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>assign<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishOp</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>bitwiseXOR<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 异或运算符</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>该方法可以识别 2 种 token: <code>^=</code>、<code>^</code>。</p></li> <li><p><code>+</code> 或 <code>-</code></p> <p>当源码遍历过程中，遇到 <code>+</code> 或 <code>-</code> 字符时，会调用 <code>readToken_plus_min</code> 方法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">readToken_plus_min</span><span class="token punctuation">(</span>code<span class="token operator">:</span> number<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// '+-'</span>
    <span class="token keyword">const</span> next <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">===</span> code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishOp</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>incDec<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ++ --</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>equalsTo<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// += -=</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishOp</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>assign<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishOp</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>plusMin<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// + -</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>该方法可以识别6种token: <code>++</code>、<code>--</code>、<code>+=</code>、<code>-=</code>、<code>+</code>、<code>-</code>。</p></li> <li><p><code>&lt;</code> 或 <code>&gt;</code></p> <p>当源码遍历过程中，遇到 <code>&lt;</code> 或 <code>&gt;</code> 字符时，会调用 <code>readToken_lt_gt</code> 方法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">readToken_lt_gt</span><span class="token punctuation">(</span>code<span class="token operator">:</span> number<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// '&lt;&gt;'</span>
    <span class="token keyword">const</span> next <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> size <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">===</span> code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        size <span class="token operator">=</span>
            code <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>greaterThan <span class="token operator">&amp;&amp;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>greaterThan
            <span class="token operator">?</span> <span class="token number">3</span>
            <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+</span> size<span class="token punctuation">)</span> <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>equalsTo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishOp</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>assign<span class="token punctuation">,</span> size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishOp</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>bitShift<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;&lt; &gt;&gt;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>equalsTo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// &lt;= | &gt;=</span>
        size <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishOp</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>relational<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p><code>readToken_lt_gt</code> 方法可以识别 6 种 token: <code>&lt;&lt;</code>、<code>&gt;&gt;</code>、<code>&lt;</code>、<code>&gt;</code>、<code>&lt;=</code>、<code>&gt;=</code>。</p></li> <li><p><code>=</code> 或 <code>!</code></p> <p>当源码遍历过程中，遇到 <code>=</code> 或 <code>!</code> 时，会调用 <code>readToken_eq_excl</code> 方法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">readToken_eq_excl</span><span class="token punctuation">(</span>code<span class="token operator">:</span> number<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span> <span class="token comment">// = !</span>
    <span class="token keyword">const</span> next <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>equalsTo<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// == !=</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishOp</span><span class="token punctuation">(</span>
            tt<span class="token punctuation">.</span>equality<span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>equalsTo
            <span class="token operator">?</span> <span class="token number">3</span>
            <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// === !== == !=</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>equalsTo <span class="token operator">&amp;&amp;</span> next <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>greaterThan<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// '=&gt;'</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishToken</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>arrow<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishOp</span><span class="token punctuation">(</span>code <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>equalsTo <span class="token operator">?</span> tt<span class="token punctuation">.</span>eq <span class="token operator">:</span> tt<span class="token punctuation">.</span>bang<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><code>readToken_lt_gt</code>方法可以识别7种token: <code>=</code>、<code>!</code>、 <code>==</code>、<code>!=</code>、<code>===</code>、<code>!==</code>、<code>==&gt;</code>。</p></li> <li><p><code>?</code></p> <p>当源码遍历过程中，遇到 <code>?</code> ，会调用 <code>readToken_eq_excl</code> 方法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">readToken_question</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> next <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> next2 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>questionMark<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ??</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>next2 <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>equalsTo<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ??=</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishOp</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>assign<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishOp</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>nullishCoalescing<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ??</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
        next <span class="token operator">===</span> charCodes<span class="token punctuation">.</span>dot <span class="token operator">&amp;&amp;</span>
        <span class="token operator">!</span><span class="token punctuation">(</span>next2 <span class="token operator">&gt;=</span> charCodes<span class="token punctuation">.</span>digit0 <span class="token operator">&amp;&amp;</span> next2 <span class="token operator">&lt;=</span> charCodes<span class="token punctuation">.</span>digit9<span class="token punctuation">)</span> <span class="token comment">// ?.</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// '.' not followed by a number</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishToken</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>questionDot<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pos<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishToken</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>question<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ?</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><code>readToken_lt_gt</code> 方法可以识别 4 种 token: <code>?</code>、<code>??</code>、<code>??=</code>、<code>?.</code>。</p></li></ul> <h4 id="词法错误"><a href="#词法错误" class="header-anchor">#</a> 词法错误</h4> <ul><li><p>词法错误发生的时机</p> <p><code>Tokenizer</code> 使用继承自 <code>babel/packages/babel-parser/src/parser/error.js</code> 的 <code>raise()</code> 方法抛出词法分析中扫描到的错误。</p> <p><code>Tokenizer</code> 中抛出词法错误的时机有如下几种场景:</p> <ul><li><p>严格模式中发现错误</p> <p>严格模式（<code>&quot;use strict;&quot;</code>）下有一系列的限制条件，<code>Tokenizer</code> 在分析过程中，会尝试发现这些错误并抛出。</p> <ul><li>禁止出现 <code>0</code> 开头的数字，如 <code>&quot;use strict&quot;; 010;</code>，在词法分析阶段就会发现并抛出该错误，但允许 <code>\\0</code> 开头的数字</li> <li>禁止出现八进制数字</li></ul></li> <li><p>扫描到的疑似词法单元不满足格式要求</p> <p>比如块级注释 <code>/* */</code> 缺乏闭合标签、hashbang 注释 <code>#!</code> 匹配到了不合适的字符如 <code>#2</code>、正则表达式缺乏闭合标签等。</p></li> <li><p>缺乏必要的 Babel 插件引入</p> <p>对于某些特殊词法单元，需要显示引入对应的插件才会开启支持，否则会抛出错误。</p> <p><code>Tokenizer</code> 在解析时，出现过多次对 <code>recordAndTuple</code> 插件的引入要求。</p> <ul><li><code>#{</code> 语法要求引入 <code>recordAndTuple</code> 插件且 <code>syntaxType</code> 配置项设置为 <code>hash</code></li> <li><code>{|</code> 和 <code>|}</code> 语法要求引入 <code>recordAndTuple</code> 插件且 <code>syntaxType</code> 配置项设置为 <code>bar</code></li></ul></li> <li><p>未知的词法单元，也就是常见的 <code>UnexpectedToken</code></p> <p>如果 Babel 定义的词法单元都没有被识别出的话，就会抛出 <code>UnexpectedToken</code> 类型的错误，文案描述为 <code>&quot;Unexpected character ...&quot;</code>。</p> <p>比如，源码中出现了一个不属于任何词法单元类型的字符时，会抛出 <code>UnexpectedToken</code> 的错误:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> · <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在词法解析时就会抛出错误: <code>Unexpected character '·'.</code>，因为 <code>·</code> 并不是一个合法的词法单元字符。</p></li></ul></li> <li><p>词法错误列表</p> <p>在词法分析时，是能够发现源码中的一些问题的，比如括号缺少闭合标签等。</p> <p>这里列举了 Babel 在词法分析阶段能够发现的错误:</p> <blockquote><p>错误描述定义在文件 <code>babel/packages/babel-parser/src/parser/error-message.js</code></p></blockquote> <ul><li><p><code>RecordExpressionBarIncorrectStartSyntaxType</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Record expressions starting with <span class="token string">'{|'</span> are only allowed when the <span class="token string">'syntaxType'</span> option of the <span class="token string">'recordAndTuple'</span> plugin is <span class="token builtin class-name">set</span> to <span class="token string">'bar'</span><span class="token builtin class-name">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>{|</code> 语法要求引入 <code>recordAndTuple</code> 插件且 <code>syntaxType</code> 配置项设置为 <code>bar</code>。</p></li> <li><p><code>InvalidOrUnexpectedToken</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Unexpected character <span class="token string">'%0'</span><span class="token builtin class-name">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>出现了非法的 token 字符。</p></li> <li><p><code>UnterminatedRegExp</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Unterminated regular expression.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>未闭合的正则表达式。</p></li> <li><p><code>DuplicateRegExpFlags</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Duplicate regular expression flag.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>重复的正则 flag。</p></li> <li><p><code>MalformedRegExpFlags</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Invalid regular expression flag.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>非法的正则 flag</p></li> <li><p><code>UnexpectedNumericSeparator</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>A numeric separator is only allowed between two digits.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>1_a
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SyntaxError: unknown: A numeric separator is only allowed between two digits. <span class="token punctuation">(</span><span class="token number">1</span>:1<span class="token punctuation">)</span>

<span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">|</span> 1_a
    <span class="token operator">|</span>  ^
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p><code>NumericSeparatorInEscapeSequence</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Numeric separators are not allowed inside unicode escape sequences or hex escape sequences.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>InvalidDigit</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Expected number <span class="token keyword">in</span> radix %0.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>InvalidDecimal</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Invalid decimal.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>NumberIdentifier</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Identifier directly after number.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>无效的小数。</p></li> <li><p><code>InvalidNumber</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Invalid number.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>非法数字。</p></li> <li><p><code>ZeroDigitNumericSeparator</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Numeric separator can not be used after leading <span class="token number">0</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>InvalidOrMissingExponent</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Floating-point numbers require a valid exponent after the <span class="token string">'e'</span><span class="token builtin class-name">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>InvalidBigIntLiteral</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Invalid BigIntLiteral.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>非法的大数字面量。</p></li> <li><p><code>InvalidCodePoint</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Code point out of bounds.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>UnterminatedString</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Unterminated string constant.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>未闭合的字符串。</p></li> <li><p><code>InvalidEscapeSequence</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Bad character escape sequence.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>MissingUnicodeEscape</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Expecting Unicode escape sequence <span class="token punctuation">\</span><span class="token punctuation">\</span>uXXXX.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>EscapedCharNotAnIdentifier</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Invalid Unicode escape.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>InvalidEscapedReservedWord</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Escape sequence <span class="token keyword">in</span> keyword %0.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul></li></ul></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><!----> <div class="meta-item update-time"><span class="label">Last update:</span> <span class="info">June 2, 2022 15:23</span></div> <div class="meta-item contributors"><span class="label">Contributors: </span> <span class="info"><span title="email: antfootmail@gmail.com" class="contributor">
          hoperyy
        </span> <!----></span></div></footer> <!----> <!----> <!----> <div class="content__page-bottom"></div></main> <!----></div><div class="global-ui"><!----><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="Close" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>Description</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        Install <span></span></button> <button class="cancel-button">
        Cancel
      </button></div></div></div></div><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button class="pswp__button pswp__button--close"></button> <button class="pswp__button pswp__button--share"></button> <button class="pswp__button pswp__button--fs"></button> <button class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button class="pswp__button pswp__button--arrow--left"></button> <button class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/books/deep-in-babel/assets/js/app.8134f3c5.js" defer></script><script src="/books/deep-in-babel/assets/js/vendors~layout-Layout.df4812ba.js" defer></script><script src="/books/deep-in-babel/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.ebefd1c7.js" defer></script><script src="/books/deep-in-babel/assets/js/page--340e5eca.a6e344ee.js" defer></script><script src="/books/deep-in-babel/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.33005620.js" defer></script>
  </body>
</html>
