<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>6.2.3 提案特性转换插件 | 《深入理解 Babel》 · 刘远洋</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="manifest" href="/books/deep-in-babel/manifest.webmanifest" crossorigin="use-credentials">
    <meta name="description" content="Deep In Babel">
    <meta property="og:url" content="/books/deep-in-babel/06.Babel%E5%86%85%E7%BD%AEPlugin(2)/">
    <meta property="og:site_name" content="《深入理解 Babel》 · 刘远洋">
    <meta property="og:title" content="6.2.3 提案特性转换插件">
    <meta property="og:description" content="6.2.3 提案特性转换插件 截至本书编写时，Babel 有 24 个内置的提案特性转换插件。 提案特性转换插件，就是对 ECMAScript 的提案语法进行语法和转译支持，这些插件可能同时有语法开关和代码转译的功能。 babel-plugin-proposal-async-generator-functions; 作用; 会被转译为： 目标节点; Func">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="《深入理解 Babel》 · 刘远洋">
    <meta name="theme-color" content="#46bd87">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    
    <link rel="preload" href="/books/deep-in-babel/assets/css/0.styles.33c62197.css" as="style"><link rel="preload" href="/books/deep-in-babel/assets/js/app.cf7dfda5.js" as="script"><link rel="preload" href="/books/deep-in-babel/assets/js/vendors~layout-Layout.df4812ba.js" as="script"><link rel="preload" href="/books/deep-in-babel/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.ebefd1c7.js" as="script"><link rel="preload" href="/books/deep-in-babel/assets/js/page-623提案特性转换插件.bf976d3f.js" as="script"><link rel="preload" href="/books/deep-in-babel/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.33005620.js" as="script"><link rel="prefetch" href="/books/deep-in-babel/assets/js/26.db6b8dab.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/layout-Blog.b0c6dcb7.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/layout-Layout.54347a9b.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/layout-NotFound.846facba.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/layout-Slide.88fa1023.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/page--0246c2a4.6fc70613.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/page--340e5eca.a730b9bb.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/page--4fdeacc4.c00307c6.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/page--6723acaa.da12b506.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/page--67cf3cc0.893b3df1.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/page--6b62a710.7be9a5e7.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/page--8fcba694.88b7d9f8.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/page--9bf3e428.77356007.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/page--aec4dcea.a56b2898.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/page--c3b426fa.730ee973.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/page--d99aed8e.42dad467.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/page-82core-js.5a5c231a.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/page-83regenerator-runtime.e55dbd6e.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/page-前言.e6d514e0.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/page-语法分析和语义分析.fac0347e.js"><link rel="prefetch" href="/books/deep-in-babel/assets/js/vendors~photo-swipe.ed4bf049.js">
    <link rel="stylesheet" href="/books/deep-in-babel/assets/css/0.styles.33c62197.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/books/deep-in-babel/" class="home-link router-link-active"><!----> <!----> <span class="site-name can-hide">《深入理解 Babel》 · 刘远洋</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">Theme Color:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://notelyio.com/home" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  撰写工具 · Notely
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/hoperyy" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  hoperyy
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/hoperyy/deep-in-babel" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  deep-in-babel
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div></nav> <!----> <!----> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!----> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="https://notelyio.com/home" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  撰写工具 · Notely
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/hoperyy" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  hoperyy
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/hoperyy/deep-in-babel" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  deep-in-babel
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><a href="/books/deep-in-babel/00.%E5%89%8D%E8%A8%80/" class="sidebar-link">第 0 章 - 前言</a></li><li><a href="/books/deep-in-babel/01.%E6%A6%82%E8%BF%B0/" class="sidebar-link">第 1 章 - 概述</a></li><li><a href="/books/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86(1)/" class="sidebar-link">第 2 章 - 转译原理 (1)</a></li><li><a href="/books/deep-in-babel/02.%E8%BD%AC%E8%AF%91%E5%8E%9F%E7%90%86(2)/" class="sidebar-link">第 2 章 - 转译原理 (2)</a></li><li><a href="/books/deep-in-babel/03.Babel%E8%8A%82%E7%82%B9/" class="sidebar-link">第 3 章 - Babel 节点</a></li><li><a href="/books/deep-in-babel/04.Babel%E5%B7%A5%E5%85%B7%E9%9B%86/" class="sidebar-link">第 4 章 - Babel 工具集</a></li><li><a href="/books/deep-in-babel/05.Babel%E6%8F%92%E4%BB%B6%E7%BC%96%E5%86%99/" class="sidebar-link">第 5 章 - Babel 插件编写</a></li><li><a href="/books/deep-in-babel/06.Babel%E5%86%85%E7%BD%AEPlugin(1)/" class="sidebar-link">第 6 章 - Babel 内置 Plugin (1)</a></li><li><a href="/books/deep-in-babel/06.Babel%E5%86%85%E7%BD%AEPlugin(2)/" aria-current="page" class="active sidebar-link">第 6 章 - Babel 内置 Plugin (2)</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/books/deep-in-babel/07.Babel%E5%86%85%E7%BD%AEPreset/" class="sidebar-link">第 7 章 - Babel 内置 Preset</a></li><li><a href="/books/deep-in-babel/08.runtime(1)/" class="sidebar-link">第 8 章 - runtime (1)</a></li><li><a href="/books/deep-in-babel/08.runtime(2)/" class="sidebar-link">第 8 章 - runtime (2)</a></li><li><a href="/books/deep-in-babel/08.runtime(3)/" class="sidebar-link">第 8 章 - runtime (3)</a></li><li><a href="/books/deep-in-babel/09.Babel%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/" class="sidebar-link">第 9 章 - Babel 项目管理</a></li><li><a href="/books/deep-in-babel/10.%E8%BD%AC%E8%AF%91%E5%99%A8%E5%AF%B9%E6%AF%94/" class="sidebar-link">第 10 章 - 转译器对比</a></li></ul> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb disable"><!----></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">6.2.3 提案特性转换插件</span></h1> <div class="page-info"><!----> <!----><!----><!----><!----><!----><span aria-label="Reading Time⌛" data-balloon-pos="down" class="reading-time-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon timer-icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z" fill="currentColor"></path></svg> <span>About 11 min</span> <meta property="timeRequired" content="PT11M"></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/books/deep-in-babel/06.Babel%E5%86%85%E7%BD%AEPlugin(2)/#_6-2-3-提案特性转换插件" class="anchor-link heading3"><div>6.2.3 提案特性转换插件</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h3 id="_6-2-3-提案特性转换插件"><a href="#_6-2-3-提案特性转换插件" class="header-anchor">#</a> 6.2.3 提案特性转换插件</h3> <p>截至本书编写时，Babel 有 24 个内置的提案特性转换插件。</p> <p>提案特性转换插件，就是对 ECMAScript 的提案语法进行语法和转译支持，这些插件可能同时有语法开关和代码转译的功能。</p> <ul><li><p>babel-plugin-proposal-async-generator-functions</p> <ul><li><p>作用</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">agf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>会被转译为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 各种函数定义</span>

<span class="token keyword">function</span> <span class="token function">agf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">_agf</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">_agf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _agf <span class="token operator">=</span> <span class="token function">_wrapAsyncGenerator</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">yield</span> <span class="token function">_awaitAsyncGenerator</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">_agf</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li> <li><p>目标节点</p> <p><code>Function</code>: 函数。</p></li> <li><p>原理</p> <p>针对带有 <code>async</code> 标记的函数处理。</p> <p>转换函数内部的 <code>await for...of</code> 语句，转为 <code>generator</code>写法。</p> <p>然后转换上述过程产生的 <code>yield</code> 标记的语句。</p> <p>TODO</p></li></ul></li> <li><p>babel-plugin-proposal-class-properties</p> <ul><li><p>作用</p> <p>转换 class 中的原型和静态属性/方法。</p> <p>下例来自 Babel 官网。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Bork</span> <span class="token punctuation">{</span>
    <span class="token comment">// Property initializer syntax</span>
    instanceProperty <span class="token operator">=</span> <span class="token string">&quot;bork&quot;</span><span class="token punctuation">;</span>
    <span class="token function-variable function">boundFunction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>instanceProperty<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// Static class properties</span>
    <span class="token keyword">static</span> staticProperty <span class="token operator">=</span> <span class="token string">&quot;babelIsCool&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token function-variable function">staticFunction</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Bork<span class="token punctuation">.</span>staticProperty<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>会被转译为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 定义 obj 对象的 key 属性值为 value</span>
<span class="token keyword">function</span> <span class="token function">_defineProperty</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> value<span class="token punctuation">,</span> <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">writable</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> 
        obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span> 
    <span class="token punctuation">}</span> 
    
    <span class="token keyword">return</span> obj<span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Bork</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">_defineProperty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&quot;instanceProperty&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bork&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">_defineProperty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&quot;boundFunction&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>instanceProperty<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">_defineProperty</span><span class="token punctuation">(</span>Bork<span class="token punctuation">,</span> <span class="token string">&quot;staticProperty&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;babelIsCool&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">_defineProperty</span><span class="token punctuation">(</span>Bork<span class="token punctuation">,</span> <span class="token string">&quot;staticFunction&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Bork<span class="token punctuation">.</span>staticProperty<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div></li> <li><p>目标节点</p> <ul><li><code>classProperties</code>: TODO</li> <li><code>classPrivateProperties</code>: TODO</li> <li><code>classPrivateMethods</code>: TODO</li></ul></li> <li><p>原理</p> <p>TODO</p></li></ul></li> <li><p>babel-plugin-proposal-class-static-block</p> <ul><li><p>作用</p> <p>转换 class 类中的静态 block。</p> <p>下例来自 Babel 官网：</p> <blockquote><p>下例的转换需要在该插件前引入插件 babel-plugin-proposal-class-properties，也就是支持对 class 属性的语法支持和代码转换。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">C</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> #x <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> y<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token function">doSomethingWith</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token string">&quot;unknown&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>会被转译为（以下代码简化了一些逻辑，非真实转换的结果）：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">C</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token constant">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 检查 C 被调用的方式是否是 new C() 的形式，而非普通函数调用</span>
    <span class="token function">_classCallCheck</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token constant">C</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> _x <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">writable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">42</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// _defineProperty 的功能类似设置 C.y = undefined</span>
<span class="token function">_defineProperty</span><span class="token punctuation">(</span><span class="token constant">C</span><span class="token punctuation">,</span> <span class="token string">&quot;y&quot;</span><span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> _ <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">writable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token constant">C</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token function">doSomethingWith</span><span class="token punctuation">(</span>_x<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>_unused<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token constant">C</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token string">&quot;unknown&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div></li> <li><p>目标节点</p> <p><code>Class</code>: 类节点</p></li> <li><p>原理</p> <p>该插件源码部分只处理 static block 部分的代码，上述转译后的代码包括插件 babel-plugin-proposal-class-properties 的转译结果。</p> <p>和 babel-plugin-proposal-class-static-block 相关的转译后代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> _x <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">writable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">42</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> _ <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">writable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token constant">C</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token function">doSomethingWith</span><span class="token punctuation">(</span>_x<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>_unused<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token constant">C</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token string">&quot;unknown&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>插件内部将 static block 内的代码放入了一个新的立即执行函数体内。</p></li></ul></li> <li><p>babel-plugin-proposal-decorators</p> <ul><li><p>作用</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>@annotation
<span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">annotation</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    target<span class="token punctuation">.</span>annotated <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>会被转译为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 其他函数定义</span>

<span class="token keyword">let</span> MyClass <span class="token operator">=</span> <span class="token function">_decorate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>annotation<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">_initialize</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
        <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">_initialize</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token constant">F</span><span class="token operator">:</span> MyClass<span class="token punctuation">,</span>
        <span class="token literal-property property">d</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">annotation</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    target<span class="token punctuation">.</span>annotated <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></li> <li><p>目标节点</p> <p>TODO</p></li> <li><p>原理</p> <p>TODO</p></li></ul></li> <li><p>babel-plugin-proposal-do-expressions</p> <ul><li><p>作用</p> <p>会开启对 <code>doExpressions</code> 语法的支持。</p> <p>在转换时，该插件会转为三目运算符。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">do</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">(</span><span class="token string">&quot;big&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token punctuation">(</span><span class="token string">&quot;small&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>会被转译为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> x <span class="token operator">&gt;</span> <span class="token number">10</span> <span class="token operator">?</span> <span class="token string">&quot;big&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;small&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>目标节点</p> <p><code>DoExpression</code>: <code>do</code> 表达式。</p></li> <li><p>原理</p> <p>在进入 <code>DoExpression</code> 节点的 <code>exit</code> 阶段时，获取 <code>do { ... }</code> 的 <code>{ ... }</code> 部分代码，并根据以下情况做不同转换：</p> <ul><li><p><code>{ ... }</code> 含有至少一行代码</p> <p>会使用 <code>path.replaceExpressionWithStatements(body)</code> 替换 <code>DoExpression</code> 节点，将块作用域内部的代码转为表达式，内部调用链路是：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// babel/packages/babel-traverse/src/path/replacement.ts
replaceExpressionWithStatements 

--&gt; 

// babel/packages/babel-types/src/converters/toSequenceExpression.ts
t.toSequenceExpression 

--&gt; 

// babel/packages/babel-types/src/converters/gatherSequenceExpressions.ts
gatherSequenceExpressions
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>各个方法内部有众多的判断逻辑，在此案例下，当块作用域内部的代码是<code>if</code>表达式时，会转为三目运算表达式。</p></li> <li><p><code>{}</code>没有代码</p> <p>会直接生成 <code>void 0</code>。</p> <p>如：<code>let a = do {}</code> 会被转译为 <code>var a = undefined</code>。</p></li></ul></li></ul></li> <li><p>babel-plugin-proposal-dynamic-import</p> <ul><li><p>作用</p> <p>支持动态import语法，并对其转译。</p></li> <li><p>目标节点</p> <p>基于 <code>babel-plugin-transform-modules-commonjs</code>、<code>babel-plugin-transform-modules-amd</code>、<code>babel-plugin-transform-modules-systemjs</code> 做转译，所以目标节点为三者之一的目标节点。</p></li> <li><p>原理</p> <p>TODO</p></li></ul></li> <li><p>babel-plugin-proposal-export-default-from</p> <ul><li><p>作用</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> v <span class="token keyword">from</span> <span class="token string">&quot;mod&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>会被转译为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> _v <span class="token keyword">from</span> <span class="token string">&quot;mod&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> _v <span class="token keyword">as</span> v <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>目标节点</p></li> <li><p>原理</p></li></ul></li> <li><p>babel-plugin-proposal-export-namespace-from</p> <ul><li><p>作用</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">as</span> ns <span class="token keyword">from</span> <span class="token string">&quot;mod&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>会被转译为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> _ns <span class="token keyword">from</span> <span class="token string">&quot;mod&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> _ns <span class="token keyword">as</span> ns <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>目标节点</p> <p>ExportNamedDeclaration</p></li> <li><p>原理</p> <p>TODO</p></li></ul></li> <li><p>babel-plugin-proposal-function-bind</p> <ul><li><p>作用</p> <p>开启对<code>functionBind</code>语法的支持，并执行代码转换。</p> <p><code>functionBind</code>，顾名思义，就是 <code>fn.bind(context)</code> 的变种写法。</p> <ul><li><p>案例1</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">obj</span><span class="token operator">:</span><span class="token operator">:</span>func
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>会被转译为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> _context<span class="token punctuation">;</span>
<span class="token punctuation">(</span>_context <span class="token operator">=</span> obj<span class="token punctuation">,</span> func<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>_context<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>案例2</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">:</span><span class="token operator">:</span>obj<span class="token punctuation">.</span>func
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>会被转译为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> _context<span class="token punctuation">;</span>
<span class="token punctuation">(</span>_context <span class="token operator">=</span> obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">func</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>_context<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>案例3</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">obj</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">func</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>会被转译为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> _context<span class="token punctuation">;</span>
<span class="token punctuation">(</span>_context <span class="token operator">=</span> obj<span class="token punctuation">,</span> func<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>_context<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>案例4</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">:</span><span class="token operator">:</span>obj<span class="token punctuation">.</span><span class="token function">func</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>会被转译为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> _context<span class="token punctuation">;</span>
<span class="token punctuation">(</span>_context <span class="token operator">=</span> obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">func</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>_context<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul></li> <li><p>目标节点</p> <ul><li><code>CallExpression</code>: 函数调用表达式</li> <li><code>BindExpression</code>: <code>bind</code> 表达式，如 <code>obj::func</code></li></ul></li> <li><p>原理</p> <p>插件内部实现上，针对 <code>BindExpression</code>、<code>CallExpression</code> 节点分别处理。</p> <p>从转译产物也可以看到，主要是生成新的 <code>func.bind</code> 函数调用节点，完成对当前节点的替换。</p></li></ul></li> <li><p>babel-plugin-proposal-function-sent</p> <ul><li><p>作用</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Sent&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">.</span>sent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Yield&quot;</span><span class="token punctuation">,</span> <span class="token keyword">yield</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> iterator <span class="token operator">=</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Logs &quot;Sent 1&quot;</span>
iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Logs &quot;Yield 2&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>会被转译为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">_skipFirstGeneratorNext</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        <span class="token keyword">var</span> it <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token keyword">return</span> it<span class="token punctuation">;</span> 
    <span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> _generator <span class="token operator">=</span> <span class="token function">_skipFirstGeneratorNext</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> _functionSent <span class="token operator">=</span> <span class="token keyword">yield</span><span class="token punctuation">;</span>

        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Sent&quot;</span><span class="token punctuation">,</span> _functionSent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Yield&quot;</span><span class="token punctuation">,</span> _functionSent <span class="token operator">=</span> <span class="token keyword">yield</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">_generator</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> iterator <span class="token operator">=</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Logs &quot;Sent 1&quot;</span>

iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Logs &quot;Yield 2&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div></li> <li><p>目标节点</p> <p><code>MetaProperty</code>: 元属性。</p></li> <li><p>原理</p> <p>TODO</p></li></ul></li> <li><p>babel-plugin-proposal-json-strings</p> <ul><li><p>作用</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> ex <span class="token operator">=</span> &quot;before
after&quot;<span class="token punctuation">;</span>
<span class="token comment">// ^ There's a U+2028 char between 'before' and 'after'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>会被转译为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> ex <span class="token operator">=</span> <span class="token string">&quot;before\u2028after&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// ^ There's a U+2028 char between 'before' and 'after'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>目标节点</p> <ul><li><code>DirectiveLiteral</code></li> <li><code>StringLiteral</code></li></ul></li> <li><p>原理</p> <p>TODO</p></li></ul></li> <li><p>babel-plugin-proposal-logical-assignment-operators</p> <ul><li><p>作用</p> <p>转换逻辑运算符（<code>&amp;&amp;</code>，<code>||</code>，<code>??</code>）和复制表达式组成的复合赋值运算符。</p> <p>以下是转换的几个案例：</p> <ul><li><p><code>a ||= b;</code> 会被转译为 <code>a || (a = b);</code></p></li> <li><p><code>a &amp;&amp;= b;</code> 会被转译为 <code>a &amp;&amp; (a = b);</code></p></li> <li><p><code>obj.a.b ||= c;</code></p> <p>会被转译为</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> _obj$a<span class="token punctuation">;</span>

<span class="token punctuation">(</span>_obj$a <span class="token operator">=</span> obj<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span>b <span class="token operator">||</span> <span class="token punctuation">(</span>_obj$a<span class="token punctuation">.</span>b <span class="token operator">=</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p><code>obj.a.b &amp;&amp;= c;</code></p> <p>会被转译为</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> _obj$a<span class="token punctuation">;</span>

<span class="token punctuation">(</span>_obj$a <span class="token operator">=</span> obj<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span>b <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>_obj$a<span class="token punctuation">.</span>b <span class="token operator">=</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul></li> <li><p>目标节点</p> <p><code>AssignmentExpression</code>: 赋值表达式。</p></li> <li><p>原理</p> <p>该插件源码的逻辑：</p> <ul><li><p>解析 <code>AssignmentExpression</code> 节点，并拆解出 <code>left/operator/right</code>部分</p> <p>对于 <code>a &amp;&amp;= b</code> 这样的表达式，<code>operator</code> 值为 <code>&amp;&amp;=</code>，插件内部会取出 <code>&amp;&amp;</code> 做下一步的处理。</p></li> <li><p>判断 <code>left</code> 节点是否是对象成员表达式，如果是，复制 <code>left</code> 节点为 <code>lhs</code>，对 <code>lhs</code> 节点进行调整</p></li> <li><p>当前 <code>AssignmentExpression</code> 节点被替换为逻辑表达式 <code>logicalExpression</code>。</p></li></ul></li></ul></li> <li><p>babel-plugin-proposal-nullish-coalescing-operator</p> <ul><li><p>作用</p> <p>转换空值处理操作符(Nullish coalescing operator)。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> foo <span class="token operator">=</span> object<span class="token punctuation">.</span>foo <span class="token operator">??</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>会被转译为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> _object$foo<span class="token punctuation">;</span>
<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token punctuation">(</span>_object$foo <span class="token operator">=</span> object<span class="token punctuation">.</span>foo<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> _object$foo <span class="token operator">!==</span> <span class="token keyword">void</span> <span class="token number">0</span> <span class="token operator">?</span> _object$foo <span class="token operator">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>空值合并操作符（<code>??</code>）是一个逻辑操作符，当左侧的操作数严格等于 <code>null</code> 或者 <code>undefined</code> 时，返回其右侧操作数，否则返回左侧操作数。</p> <p>与逻辑或操作符（<code>||</code>）不同，逻辑或操作符会在左侧操作数为假值（<code>falsy</code>）时返回右侧操作数。也就是说，如果使用 <code>||</code> 来为某些变量设置默认值并不演进，比如遇到假值（<code>''</code> 或 <code>0</code>）时。</p></li> <li><p>目标节点</p> <p><code>LogicalExpression</code>: 逻辑运算表达式。</p></li> <li><p>原理</p> <p>针对 <code>node.operator === '??'</code> 的逻辑运算表达式。</p> <p><code>function (a, x = a.b ?? c) {}</code> 会被转译为 <code>function (a, x = (() =&gt; a.b ?? c)() ){}</code>，也就是将 <code>a.b ?? c</code> 置于立即执行函数（IIFE）中，有效避免了作用域污染的问题。</p> <p>插件其余逻辑就是将 <code>??</code> 转为三元运算符 <code>? :</code>。</p></li></ul></li> <li><p>babel-plugin-proposal-numeric-separator</p> <ul><li><p>作用</p> <p>数字分隔符。它可以在数字间创建可视化分隔符（<code>_</code>）来分割数字，提高数字的可读性。用于数字式的表达式：整数（integer）、大数（bigint）、浮点数（floating-point）、小数（fractional）、指数（exponent parts）。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token number">1_000_000_000</span> <span class="token comment">// 十进制数</span>
<span class="token number">0b1010_0100</span> <span class="token comment">// 二进制数</span>
<span class="token number">101_123_34.11</span> <span class="token comment">// 浮点数</span>
<span class="token number">0.000_001</span> <span class="token comment">// 小数部分</span>
<span class="token number">1e10_000</span> <span class="token comment">// 指数部分</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>下述代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> budget <span class="token operator">=</span> <span class="token number">1_000_000_000_000</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> nibbles <span class="token operator">=</span> <span class="token number">0b1010_0001_1000_0101</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> message <span class="token operator">=</span> <span class="token number">0xa0_b0_c0</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>会被转译为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> budget <span class="token operator">=</span> <span class="token number">1000000000000</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> nibbles <span class="token operator">=</span> <span class="token number">0b1010000110000101</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> message <span class="token operator">=</span> <span class="token number">0xa0b0c0</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>目标节点</p> <ul><li><code>NumericLiteral</code>: 数字字面量</li> <li><code>BigIntLiteral</code>: <code>bigInt</code> 字面量</li></ul></li> <li><p>原理</p> <p>语法方面，该插件开启了 <code>numericSeparator</code> 的语法支持。</p> <p>转换方面，源码非常简单：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">remover</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> node <span class="token punctuation">}</span><span class="token operator">:</span> NodePath<span class="token operator">&lt;</span>BigIntLiteral <span class="token operator">|</span> NumericLiteral<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> extra <span class="token punctuation">}</span> <span class="token operator">=</span> node<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>extra<span class="token operator">?.</span>raw<span class="token operator">?.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        extra<span class="token punctuation">.</span>raw <span class="token operator">=</span> extra<span class="token punctuation">.</span>raw<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">_</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 省略了无关代码</span>
<span class="token literal-property property">visitor</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">NumericLiteral</span><span class="token operator">:</span> remover<span class="token punctuation">,</span>
    <span class="token literal-property property">BigIntLiteral</span><span class="token operator">:</span> remover<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>当遍历到相关节点时，将 <code>_</code> 替换为空字符即可。</p></li></ul></li> <li><p>babel-plugin-proposal-object-rest-spread</p> <ul><li><p>作用</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token operator">...</span>z <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { a: 3, b: 4 }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>会被转译为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> _x$y$a$b <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">4</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
        x<span class="token punctuation">,</span>
        y
    <span class="token punctuation">}</span> <span class="token operator">=</span> _x$y$a$b<span class="token punctuation">,</span>
    z <span class="token operator">=</span> <span class="token function">_objectWithoutProperties</span><span class="token punctuation">(</span>_x$y$a$b<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;y&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { a: 3, b: 4 }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></li> <li><p>目标节点</p> <p>TODO</p></li> <li><p>原理</p> <p>TODO</p></li></ul></li> <li><p>babel-plugin-proposal-optional-catch-binding</p> <ul><li><p>作用</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
    <span class="token function">doSomthing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>会被转译为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>_unused<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">doSomthing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>目标节点</p> <p><code>CatchClause</code>: <code>catch</code> 从句。</p></li> <li><p>原理</p> <p><code>CatchClause</code> 节点可以对应 <code>catch { ... }</code>、<code>catch(...) { ... }</code> 两种写法，所以需排除后者写法（通过判断 <code>path.node.param</code> 是否为真值）。</p> <p>在解析为 <code>CatchClause</code> 节点时，会携带 <code>param</code> 属性，这里将<code>param</code> 的值设置为 <code>_unused</code> 即可。</p></li></ul></li> <li><p>babel-plugin-proposal-optional-chaining</p> <ul><li><p>作用</p> <p>转换可选链。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> result <span class="token operator">=</span> a<span class="token operator">?.</span>b<span class="token operator">?.</span>c<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>会被转译为（转换后的代码做了格式化处理，便于阅读）：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> _a<span class="token punctuation">,</span> _a$b<span class="token punctuation">;</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> 
    <span class="token punctuation">(</span>_a <span class="token operator">=</span> a<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> _a <span class="token operator">===</span> <span class="token keyword">void</span> <span class="token number">0</span> 

    <span class="token operator">?</span> 

    <span class="token keyword">void</span> <span class="token number">0</span> 

    <span class="token operator">:</span> 

    <span class="token punctuation">(</span>_a$b <span class="token operator">=</span> _a<span class="token punctuation">.</span>b<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> _a$b <span class="token operator">===</span> <span class="token keyword">void</span> <span class="token number">0</span> 

    <span class="token operator">?</span> 
    
    <span class="token keyword">void</span> <span class="token number">0</span> 

    <span class="token operator">:</span> 

    _a$b<span class="token punctuation">.</span>c<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></li> <li><p>目标节点</p> <ul><li><code>OptionalCallExpression</code>: 可选链执行方法表达式，如 <code>f?.()()</code></li> <li><code>OptionalMemberExpression</code>: 可选链表达式，如 <code>a?.b?.c</code></li></ul></li> <li><p>原理</p> <p>从转换产物可以看到，与 <code>||</code> 可能判断 <code>null/undefined/0</code> 等不同，<code>a?.b</code> 在实现上是判断 <code>a</code> 的值是否严格等于 <code>null</code> 和 <code>undefined</code> 两个值。</p> <p>对于<code>OptionalCallExpression</code>节点：</p> <p><code>f?.()()</code></p> <p>转换结果是：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> _f<span class="token punctuation">;</span>

<span class="token punctuation">(</span>_f <span class="token operator">=</span> f<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> _f <span class="token operator">===</span> <span class="token keyword">void</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token keyword">void</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token function">_f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>判断 <code>f</code> 是否是 <code>null</code> 或 <code>undefined</code>，若是，返回 <code>undefined</code> 作为表达式的值，否则正常执行。</p></li></ul></li> <li><p>babel-plugin-proposal-partial-application</p> <ul><li><p>作用</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">)</span>           <span class="token comment">// partial application from left</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>           <span class="token comment">// partial application from right</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">)</span>        <span class="token comment">// partial application for any arg</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>会被转译为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> _x<span class="token punctuation">,</span>
    _f<span class="token punctuation">;</span>

_f <span class="token operator">=</span> f<span class="token punctuation">,</span>
_x <span class="token operator">=</span> x<span class="token punctuation">,</span> 

<span class="token comment">// f(x, ?)</span>
<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token parameter">_argPlaceholder</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">_f</span><span class="token punctuation">(</span>_x<span class="token punctuation">,</span> _argPlaceholder<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// f(?, x)</span>
<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token parameter">_argPlaceholder</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">_f</span><span class="token punctuation">(</span>_argPlaceholder<span class="token punctuation">,</span> _x<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// f(x, ?)</span>
<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token parameter">_argPlaceholder<span class="token punctuation">,</span> _argPlaceholder2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">_f</span><span class="token punctuation">(</span>_argPlaceholder<span class="token punctuation">,</span> _x<span class="token punctuation">,</span> _argPlaceholder2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>o<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">)</span>         <span class="token comment">// partial application from left</span>
o<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>         <span class="token comment">// partial application from right</span>
o<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">)</span>      <span class="token comment">// partial application for any arg</span>
<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token punctuation">)</span>        <span class="token comment">// partial application allowed for call on |SuperProperty|</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>会被转译为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> _x<span class="token punctuation">,</span> 
    _o$f<span class="token punctuation">,</span> 
    _o<span class="token punctuation">;</span>

_o <span class="token operator">=</span> o<span class="token punctuation">,</span> 
_o$f <span class="token operator">=</span> _o<span class="token punctuation">.</span>f<span class="token punctuation">,</span> 
_x <span class="token operator">=</span> x<span class="token punctuation">,</span> 

<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token parameter">_argPlaceholder</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">_o$f</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>_o<span class="token punctuation">,</span> _x<span class="token punctuation">,</span> _argPlaceholder<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>目标节点</p> <p><code>CallExpression</code>: 函数调用节点。</p></li> <li><p>原理</p> <p>如果函数调用时，没有描述 <code>ArgumentPlaceholder</code>，也就是 <code>?</code>，不做处理。</p> <p>处理时判断当前节点是 <code>o.f()</code> 还是 <code>f()</code> 形式的调用，分别处理。</p> <p>二者的最终处理逻辑类似，都是为 <code>f</code> 创建一个新的函数，并提供占位的参数变量。对于 <code>o.f()</code> 的调用形式，还需通过 <code>call</code> 绑定 <code>this</code> 上下文。</p></li></ul></li> <li><p>babel-plugin-proposal-pipeline-operator</p> <ul><li><p>作用</p> <p>管道运算符 <code>|&gt;</code> 本质上是带有单个参数的函数调用中的一个有用的语法糖。换句话说，<code>sqrt(64)</code> 等价于 <code>64 |&gt; sqrt</code>。</p> <p>当把多个函数连接在一起时，这样可以提供更好的可读性：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">doubleSay</span> <span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> str <span class="token operator">+</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">+</span> str<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">capitalize</span> <span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> str<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">exclaim</span> <span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> str <span class="token operator">+</span> <span class="token string">'!'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>下面的调用是等价的:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">exclaim</span><span class="token punctuation">(</span><span class="token function">capitalize</span><span class="token punctuation">(</span><span class="token function">doubleSay</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
result <span class="token comment">//=&gt; &quot;Hello, hello!&quot;</span>

<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span>
    <span class="token operator">|</span><span class="token operator">&gt;</span> doubleSay
    <span class="token operator">|</span><span class="token operator">&gt;</span> capitalize
    <span class="token operator">|</span><span class="token operator">&gt;</span> exclaim<span class="token punctuation">;</span>

result <span class="token comment">//=&gt; &quot;Hello, hello!&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>目标节点</p> <p>TODO</p></li> <li><p>原理</p> <p>TODO</p></li></ul></li> <li><p>babel-plugin-proposal-private-methods</p> <ul><li><p>作用</p> <p>配合babel-plugin-proposal-class-properties使用。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{</span>
    #xValue <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">get</span> <span class="token function">#x</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#xValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">set</span> <span class="token function">#x</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>#xValue <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>会被转译为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> _xValue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> _x <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _x<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">get</span><span class="token operator">:</span> _get_x<span class="token punctuation">,</span>
            <span class="token literal-property property">set</span><span class="token operator">:</span> _set_x
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        _xValue<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">writable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">_get_x</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">_classPrivateFieldGet</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> _xValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">_set_x</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">_classPrivateFieldSet</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> _xValue<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div></li> <li><p>目标节点</p> <p>TODO</p></li> <li><p>作用</p> <p>TODO</p></li></ul></li> <li><p>babel-plugin-proposal-private-property-in-object</p> <ul><li><p>作用</p> <p>配合 <code>babel-plugin-proposal-class-properties</code> 一起使用。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
    #bar <span class="token operator">=</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">;</span>

    <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> #bar <span class="token keyword">in</span> obj<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>会被转译为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> _bar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _bar<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">writable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;bar&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> _bar<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li><p>目标节点</p></li> <li><p>原理</p></li></ul></li> <li><p>babel-plugin-proposal-record-and-tuple</p> <ul><li><p>作用</p> <p>转换 <code>Record</code> 和 <code>Tuple</code> 类型。</p> <p>在介绍 <code>babel-plugin-syntax-record-and-tuple</code> 时，提到过，<code>Record</code> 类似对象，<code>Tuple</code> 类似数组，其成员必须是非引用类型，它们可以通过成员值是否一致判断相等性。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>#<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
#<span class="token punctuation">{</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token string">'2'</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>被转译为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">Tuple</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Record</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token string">'2'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>目标节点</p> <ul><li><code>RecordExpression</code>: Record表达式</li> <li><code>TupleExpression</code>: Tuple表达式</li></ul></li> <li><p>原理</p> <p>插件逻辑比较简单，直接用 <code>builtIn</code> 式的函数 <code>Tuple()</code>、<code>Record()</code> 替换原来的代码。</p></li></ul></li> <li><p>babel-plugin-proposal-throw-expressions</p> <ul><li><p>作用</p> <p>开启 <code>throwExpressions</code> 语法支持，且做代码转换。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span>param <span class="token operator">=</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;required!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> test <span class="token operator">=</span> param <span class="token operator">===</span> <span class="token boolean">true</span> <span class="token operator">||</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Falsy!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>会被转译为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span> <span class="token function-variable function">param</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> e<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;param required!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 默认参数值是立即执行函数</span>
    <span class="token keyword">const</span> test <span class="token operator">=</span> param <span class="token operator">===</span> <span class="token boolean">true</span> <span class="token operator">||</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> e<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Falsy!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 右侧是立即执行函数</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>上述函数的作用是，如果执行 <code>test</code> 函数：</p> <ul><li><code>test()</code>: 会直接抛出 <code>&quot;param required&quot;</code> 错误</li> <li><code>test(false)</code>: 会直接抛出 <code>&quot;Falsy&quot;</code> 错误</li> <li><code>test(true)</code>: 会无抛错运行</li></ul></li> <li><p>目标节点</p> <p><code>UnaryExpression</code>: 一元表达式。</p></li> <li><p>原理</p> <p>识别一元表达式，并过滤 <code>path.operator</code> 值为非 <code>throw</code> 的节点。</p> <p>之后创建普通函数 <code>function(e) { throw e }</code> 节点，最终创建一个函数执行节点 <code>callExpression</code>，执行的参数是 <code>throw</code> 后面的表达式。</p></li></ul></li> <li><p>babel-plugin-proposal-unicode-property-regex</p> <p>TODO</p></li></ul></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><!----> <!----> <!----></footer> <!----> <!----> <!----> <div class="content__page-bottom"></div></main> <!----></div><div class="global-ui"><!----><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="Close" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>Description</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        Install <span></span></button> <button class="cancel-button">
        Cancel
      </button></div></div></div></div><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button class="pswp__button pswp__button--close"></button> <button class="pswp__button pswp__button--share"></button> <button class="pswp__button pswp__button--fs"></button> <button class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button class="pswp__button pswp__button--arrow--left"></button> <button class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/books/deep-in-babel/assets/js/app.cf7dfda5.js" defer></script><script src="/books/deep-in-babel/assets/js/vendors~layout-Layout.df4812ba.js" defer></script><script src="/books/deep-in-babel/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.ebefd1c7.js" defer></script><script src="/books/deep-in-babel/assets/js/page-623提案特性转换插件.bf976d3f.js" defer></script><script src="/books/deep-in-babel/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.33005620.js" defer></script>
  </body>
</html>
